<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src\site\apt/development\execution-framework.apt at 03 Mar 2019
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Allan Thrane Andersen" />
    <meta name="Date-Revision-yyyymmdd" content="20190303" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Pineapple API project &#x2013; Execution framework reference</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
    <!-- Google Analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28287414-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Pineapple API project</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="../../../index.html" title="Pineapple Home">Pineapple Home</a><span class="divider">/</span></li>
      <li class=""><a href="../../index.html" title="Pineapple modules">Pineapple modules</a><span class="divider">/</span></li>
      <li class=""><a href="../index.html" title="Pineapple API project">Pineapple API project</a><span class="divider">/</span></li>
    <li class="active ">Execution framework reference</li>
        <li id="publishDate" class="pull-right">Last Published: 03 Mar 2019</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Project Overview</li>
    <li><a href="../../../index.html" title="Home"><span class="none"></span>Home</a></li>
    <li><a href="../../../usage/installation.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li><a href="../../../usage/index.html" title="For Users"><span class="none"></span>For Users</a></li>
    <li><a href="../../../development/index.html" title="For Developers"><span class="none"></span>For Developers</a></li>
    <li><a href="../../../usage/terms.html" title="Terms and Conditions"><span class="none"></span>Terms and Conditions</a></li>
      <li class="nav-header">Clients</li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-standalone-web-client/index.html" title="Standalone Web Application"><span class="none"></span>Standalone Web Application</a></li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/index.html" title="Deployable Web Application"><span class="none"></span>Deployable Web Application</a></li>
    <li><a href="../../../pineapple-applications/pineapple-maven-plugin/index.html" title="Maven Plugin"><span class="none"></span>Maven Plugin</a></li>
      <li class="nav-header">Plugins</li>
    <li><a href="../../../pineapple-plugins/pineapple-agent-plugin/index.html" title="Agent"><span class="none"></span>Agent</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-composite-execution-plugin/index.html" title="Composite Execution"><span class="none"></span>Composite Execution</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-ssh-plugin/index.html" title="SSH"><span class="none"></span>SSH</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-docker-plugin/index.html" title="Docker"><span class="none"></span>Docker</a></li>
    <li><a href="../../../pineapple-modules/pineapple-infrastructure-test-plugin/index.html" title="Infrastructure Test"><span class="none"></span>Infrastructure Test</a></li>
      <li class="nav-header">API's</li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/usage/rest.html" title="REST"><span class="none"></span>REST</a></li>
    <li><a href="../../../development/plugin-framework.html" title="Plugin Framework"><span class="none"></span>Plugin Framework</a></li>
      <li class="nav-header">Additional Information</li>
    <li><a href="http://pineapplesoftware.blogspot.com" class="externalLink" title="The Pineapple Project Blog"><span class="none"></span>The Pineapple Project Blog</a></li>
    <li><a href="http://exceptiontrail.blogspot.com" class="externalLink" title="Pineapple Exception Trail Blog"><span class="none"></span>Pineapple Exception Trail Blog</a></li>
      <li class="nav-header">Project Tools</li>
    <li><a href="https://bintray.com/pineapple/maven/com.alpha.pineapple" class="externalLink" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="https://github.com/athrane/pineapple" class="externalLink" title="Source Code"><span class="none"></span>Source Code</a></li>
    <li><a href="https://github.com/athrane/pineapple/issues" class="externalLink" title="Issue Tracker"><span class="none"></span>Issue Tracker</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
</ul>
          <hr />
          <div id="poweredBy">
    <script type="text/javascript">asyncJs( 'https://apis.google.com/js/plusone.js' )</script>
    <div class="g-plusone" data-href="https://pineapple.dev.java.net" data-size="tall" ></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<div class="section">
<h2><a name="Execution_framework_reference"></a>Execution framework reference</h2>
<ul>
<li><a href="#Introduction">Introduction</a></li>
<li><a href="#Execution_result">Execution result</a>
<ul>
<li><a href="#Start_a_new_execution">Start a new execution</a></li>
<li><a href="#Composite_result_hierarchies">Composite result hierarchies</a></li>
<li><a href="#Execution_state">Execution state</a></li>
<li><a href="#Setting_execution_state">Setting execution state</a></li>
<li><a href="#Computing_the_execution_state">Computing the execution state</a></li></ul></li>
<li><a href="#Continuation_policy">Continuation policy</a></li>
<li><a href="#Result_listener">Result listener</a></li>
<li><a href="#Result_repository">Result repository</a></li>
<li><a href="#Result_factory">Result factory</a>
<ul>
<li><a href="#Creating_a_result_using_the_factory">Creating a result using the factory</a></li></ul></li>
<li><a href="#Exceptions">Exceptions</a></li></ul>
<div class="section">
<h3><a name="Introduction"></a>Introduction</h3>
<p>Pineapple defines an framework for monitoring and controlling the execution of operations. The purpose of the framework is to:</p>
<ul>
<li>Control the execution of operations.</li>
<li>Gather runtime information about the execution of operations and commands.</li>
<li>Deliver the information to clients in real time.</li></ul></div>
<div class="section">
<h3><a name="Execution_result"></a>Execution result</h3>
<p>The core class in the framework is the <tt>ExecutionResultImpl</tt> class which implements the <tt>ExecutionResult</tt> interface. The class is used by Pineapple to capture runtime information about and control the execution of operations. </p>
<div class="section">
<h4><a name="Start_a_new_execution"></a>Start a new execution</h4>
<p>A new execution can be create in three different ways:</p>
<ul>
<li><a href="#Starting_a_new_execution_using_the_result_class_directly">Starting a new execution using the result class directly</a></li>
<li><a href="#Creating_new_execution_using_the_factory">Creating new execution using the factory</a></li>
<li><a href="#Starting_a_new_execution_using_the_result_repository">Starting a new execution using the result repository</a></li></ul>
<div class="section">
<h5><a name="Starting_a_new_execution_using_the_result_class_directly"></a>Starting a new execution using the result class directly</h5>
<p>To start a new execution which should tracked by execution results, create an instance by invoked the <tt>new</tt> operator:</p>
<div class="source"><pre class="prettyprint linenums">  ExecutionResult rootResult = new ExecutionResultImpl(&quot;some description&quot;);     
</pre></div>
<p>The semantics of invoking the constructor <tt>ExecutionResultImpl( String description )</tt> is:</p>
<ol style="list-style-type: decimal">
<li>Creates a new execution result with <i>running</i> state.</li>
<li>The internal stop watch is running for the execution result.</li>
<li>The execution result has the description &quot;some description&quot;.</li>
<li>The parent result is null for the new execution result. </li></ol></div>
<div class="section">
<h5><a name="Starting_a_new_execution_using_the_result_repository"></a>Starting a new execution using the result repository</h5>
<p>To start a new execution which should tracked by execution results, invoke the <tt>startNewExecution(String description)</tt> on a result repository to create a root result: </p>
<div class="source"><pre class="prettyprint linenums">  ExecutionResult rootResult = resultRepository.startNewExecution( &quot;some description&quot; );        
</pre></div>
<p>The semantics of the <tt>startNewExecution( description )</tt> is:</p>
<ol style="list-style-type: decimal">
<li>Creates a new execution result with <i>running</i> state.</li>
<li>The internal stop watch is running for the execution result.</li>
<li>The execution result has the description &quot;some description&quot;.</li>
<li>The parent result is null for the new execution result. </li></ol></div></div>
<div class="section">
<h4><a name="Composite_result_hierarchies"></a>Composite result hierarchies</h4>
<p>Branching of the execution path can be tracked by adding a child result to an existing execution result:</p>
<div class="source"><pre class="prettyprint linenums">  ExecutionResult modelResult = rootResult.addChild( &quot;some description&quot; );      
</pre></div>
<p>The semantics of the <tt>addChild( description )</tt> method is: </p>
<ol style="list-style-type: decimal">
<li>Creates a new execution result with <i>running</i> state.</li>
<li>The internal stop watch is running for the execution result.</li>
<li>The execution result has the description &quot;some description&quot;.</li>
<li>The child result is added as a child result to the <tt>rootResult</tt> on which the <tt>addChild(..)</tt> method was invoked. </li>
<li>The <tt>rootResult</tt> is added as parent result to the child result.</li></ol>
<p>TODO: clarify what happens if a child is added to a non-running result?</p></div>
<div class="section">
<h4><a name="Execution_state"></a>Execution state</h4>
<p>A execution result contains an state variable which defines the runtime state of the application whose execution is documented by the result.</p>
<div class="section">
<h5><a name="The_legal_states"></a>The legal states</h5>
<p>The legal states are:</p>
<ul>
<li><i>executing</i> - signals that the tracked application part is executing.</li>
<li><i>success</i> - signals that execution is completed and it was a success.</li>
<li><i>failure</i> - signals that execution is completed and it failed due to some criteria defined by the application.</li>
<li><i>error</i> - signals that execution is completed and it terminated with an unexpected exception.</li>
<li><i>computed</i> - signals that execution is completed and that the state should be computed based on the results of its child results.</li>
<li><i>interrupted</i> - signals the execution was interrupted (either cancelled of aborted due to failure)</li></ul>
<p>The legal states is defined as an <tt>enum</tt> named <tt>com.alpha.pineapple.execution.ExecutionResult.ExecutionState</tt> which is used to set and query about the states of execution results when using the framework: </p>
<div class="source"><pre class="prettyprint linenums">public interface ExecutionResult {

  /**
   * Defines the execution state of a execution result.
   */
  enum ExecutionState {
    COMPUTED,   // completed execution state is computed from children
    SUCCESS,    // completed execution, execution was successful
    FAILURE,    // completed execution, execution resulted in failure
    ERROR,      // completed execution, execution encountered an unexpected error
    EXECUTING,  // execution is in progress
    INTERRUPTED // completed execution, execution was interrupted (either cancelled of aborted due to failure)
  }
  
  // remaining interface definition here..
}
</pre></div></div>
<div class="section">
<h5><a name="The_initial_state_is_executing"></a>The initial state is <i>executing</i></h5>
<p>When an execution result is created the state is set to <i>executing</i>. This applies for root and child results.</p></div></div>
<div class="section">
<h4><a name="Setting_execution_state"></a>Setting execution state</h4>
<p>When the execution (or the application part which is tracked by an execution result) is complete the execution result needs to be updated to reflect the outcome of the execution. Set the state using the methods:</p>
<ul>
<li><tt>CompleteAsSuccessful(..)</tt></li>
<li><tt>CompleteAsFailure(..)</tt></li>
<li><tt>CompleteAsError(..)</tt></li>
<li><tt>CompleteAsComputed(..)</tt></li>
<li><tt>CompleteAsInterrupted(..)</tt></li></ul>
<p>..which add one or more messages using a message source and sets the state. Usage of the different methods are described in the following sections.</p>
<p>Finally the state can be set using the method <tt>setState(...)</tt>, but using this method has the disadvantage that messages needs to be added afterwards</p>
<div class="section">
<h5><a name="Setting_the_state_as_success"></a>Setting the state as success </h5>
<p>The <i>success</i> state is used to capture the successful execution of some code. An example could the successful execution of an test command where the assertion of the expected and actual values succeeded. An example of a test command which uses the <i>success</i> and <i>failure</i> state to report the outcome of the test can be found here: <a href="../../pineapple-commands-api/examples/simple-command-with-execution-result.html">How-to: Write a simple test command whose outcome is reported using the execution framework.</a> </p>
<p>The state of the execution result object is set using the <tt>completeAsSuccessful(..)</tt> method:</p>
<div class="source"><pre class="prettyprint linenums">  // assert
  if (ip.equalsIgnoreCase( actualIP )) {
    // set successful result                    
    Object[] args = { this.hostname, this.ip };                 
    executionResult.completeAsSuccessful(messageSource, &quot;trnc.succeed&quot;, args);                                          
    return;                             
  }
        
  // else set failed result
</pre></div>
<p>The semantics of the <tt>completeAsSuccessful(MessageSource messageSource, String key, Object[] args)</tt> is:</p>
<ol style="list-style-type: decimal">
<li>The message key defined by <tt>key</tt> is resolved from the message source object <tt>messageSource</tt> with the <tt>args</tt> arguments which is substituted into the resolved message.</li>
<li>The resolved message is stored in the execution result using the message key <tt>Message</tt>.</li>
<li>The state is set to <i>success</i>. </li></ol></div>
<div class="section">
<h5><a name="Setting_the_state_as_failure"></a>Setting the state as failure</h5>
<p>The <i>success</i> state is used to capture the unsuccessful execution of some code. An example could the unsuccessful execution of an test command where the assertion of the expected and actual values failed. An example of a test command which uses the <i>success</i> and <i>failure</i> state to report the outcome of the test can be found here: <a href="../../pineapple-commands-api/examples/simple-command-with-execution-result.html">How-to: Write a simple test command whose outcome is reported using the execution framework.</a></p>
<p>The state of the execution result object is set using the <tt>completeAsFailure(..)</tt> method:</p>
<div class="source"><pre class="prettyprint linenums">  // assert
  if (ip.equalsIgnoreCase( actualIP )) {
    // set successful result                    
    return;                             
  }
    
  // set failed result
  Object[] args = { this.hostname, this.ip.toString(), this.actualIP.toString() };            
  executionResult.completeAsFailure(messageSource, &quot;trnc.failed&quot;, args);
</pre></div>
<p>The semantics of the <tt>completeAsFailure(MessageSource messageSource, String key, Object[] args)</tt> is:</p>
<ol style="list-style-type: decimal">
<li>The message key defined by <tt>key</tt> is resolved from the message source object <tt>messageSource</tt> with the <tt>args</tt> arguments which is substituted into the resolved message.</li>
<li>The resolved message is stored in the execution result using the message key <tt>Error Message</tt>.</li>
<li>The state is set to <i>failure</i>. </li></ol></div>
<div class="section">
<h5><a name="Setting_the_state_as_error"></a>Setting the state as error</h5>
<p>The <i>error</i> state is used to capture unexpected exceptions in logic/code whose execution is documented by execution results. An example of a test command which uses the <i>error</i> state to report errors during execution of the test can be found here: <a href="../../pineapple-commands-api/examples/simple-command-with-execution-result.html">How-to: Write a simple test command whose outcome is reported using the execution framework.</a> </p>
<p>If exceptions is caught by a <tt>try/catch</tt> block then the error state can set be using the <tt>completeAsError(..)</tt> method: </p>
<div class="source"><pre class="prettyprint linenums">  ExecutionResult myResult = ...        
  // some logic 
  
  try {          
    // some logic                                       
    // set result as successful, failed or compute it                                                           
  } catch (Exception e) {                             
    myResult.completeAsError(messageSource, &quot;dmtd.error&quot;, null, e);
  }
</pre></div>
<p>The semantics of the <tt>completeAsError(MessageSource messageSource, String key, Object[] args, Exception e)</tt> is:</p>
<ol style="list-style-type: decimal">
<li>The message key defined by <tt>key</tt> is resolved from the message source object <tt>messageSource</tt> with the <tt>args</tt> arguments which is substituted into the resolved message.</li>
<li>The resolved message is stored in the execution result using the message key <tt>Error Message</tt>.</li>
<li>The stack trace of the exception defined by argument <tt>e</tt> is extracted and stored in the execution result using the message key <tt>Stack Trace</tt>.</li>
<li>The state is set to <i>error</i>. </li></ol>
<p>The execution can alos be completed with an error using an exception is input:</p>
<div class="source"><pre class="prettyprint linenums">  ExecutionResult myResult = ...        
  // some logic 
  
  try {          
    // some logic                                       
    // set result as successful, failed or compute it                                                           
  } catch (Exception e) {                             
    myResult.completeAsError(e);
  }
</pre></div>
<p>The semantics of the <tt>completeAsError(Exception e)</tt> is:</p>
<ol style="list-style-type: decimal">
<li>The message is read from the exception using <tt>Exception.getMessage()</tt> and stored in the execution result using the message key <tt>Error Message</tt>.</li>
<li>The stack trace of the exception defined is extracted and stored in the execution result using the message key <tt>Stack Trace</tt>.</li>
<li>The state is set to <i>error</i>. </li></ol></div>
<div class="section">
<h5><a name="Setting_the_state_as_computed"></a>Setting the state as computed</h5>
<p>Logic whose state should be computed based on the results of its child results should implement it this way:</p>
<div class="source"><pre class="prettyprint linenums">  Object[] args = { type };
  myResult.completeAsComputed(messageSource, &quot;dmtd.completed&quot;, args);           
</pre></div>
<p>The semantics of the <tt>completeAsComputed(MessageSource messageSource, String key, Object[] args)</tt> is:</p>
<ol style="list-style-type: decimal">
<li>The message key defined by <tt>key</tt> is resolved from the message source object <tt>messageSource</tt> with the <tt>args</tt> arguments which is substituted into the resolved message.</li>
<li>The resolved message is stored in the execution result using the message key <tt>Message</tt>.</li>
<li>The state is set to computed and the execution result will compute the execution state as described in XXXX.</li></ol></div>
<div class="section">
<h5><a name="Setting_the_state_as_computed.2C_advanced_version"></a>Setting the state as computed, advanced version</h5>
<p>There is an more advanced way to set the state as computed which will produce different messages depending on the whether computed state is</p>
<ul>
<li><i>success</i> </li>
<li><i>failure</i> or <i>error</i></li></ul>
<p>The advanced method is invoked this way: </p>
<div class="source"><pre class="prettyprint linenums">  Object[] successfulArgs = { type };
  Object[] failedArgs = { type2 };
  myResult.completeAsComputed(messageSource, &quot;xyz.completed&quot;, successfulArgs, &quot;xyz.failed&quot;, failedArgs);                                      
</pre></div>
<p>The semantics of the <tt>completeAsComputed(MessageSource messageSource, String successfulKey, Object[] successfulArgs, String failedKey, Object[] failedArgs)</tt> is:</p>
<ol style="list-style-type: decimal">
<li>The state is set to computed and the execution result will compute the execution state as described in XXXX. </li>
<li>If the computed state is <i>success</i> then:
<ol style="list-style-type: decimal">
<li>The message key defined by <tt>successfulKey</tt> is resolved from the message source object <tt>messageSource</tt> with the <tt>successfulArgs</tt> arguments which is substituted into the resolved message.</li>
<li>The resolved message is stored in the execution result using the message key <tt>Message</tt>.</li></ol></li>
<li>Else:
<ol style="list-style-type: decimal">
<li>If the array <tt>failedArgs</tt> is null, then a new extended <tt>failedArgs</tt> array of size 2 is created. Otherwise a new extended <tt>failedArgs&gt;&gt; array is created which is the size of &lt;&lt;&lt;failedArgs</tt> + 2. </li>
<li>If the array <tt>failedArgs</tt> is null, then a new message argument array of size 2 is created. Otherwise a new message argument array is created which is the size of <tt>failedArgs</tt> + 2. </li>
<li>The number of failed children is added at index 0 in the extended <tt>failedArgs</tt> array. </li>
<li>The number of children terminated with an error is added at index 1 in the extended <tt>failedArgs</tt> array. </li>
<li>The message key defined by <tt>failedKey</tt> is resolved from the message source object <tt>messageSource</tt> with the extended <tt>failedArgs</tt> array whose content is substituted into the resolved message.</li>
<li>The resolved message is stored in the execution result using the message key <tt>Message</tt>.</li></ol></li></ol>
<p>Using the advance version requires that the failed message is defined with at least two arguments:</p>
<div class="source"><pre class="prettyprint linenums">tdc.failed=XYZ failed, because [{0}] child executions failed and [{1}] child executions terminated with an error.
</pre></div>
<p>It is possible to invoke the method with null argument lists: </p>
<div class="source"><pre class="prettyprint linenums">  myResult.completeAsComputed(messageSource, &quot;xyz.completed&quot;, null, &quot;xyz.failed&quot;, null );                                     
</pre></div>
<p>..but the requirement for the failed message is the same.</p></div>
<div class="section">
<h5><a name="Setting_the_state_as_interrupted"></a>Setting the state as interrupted</h5>
<p>TODO: write...</p></div></div>
<div class="section">
<h4><a name="Computing_the_execution_state"></a>Computing the execution state</h4>
<div class="section">
<h5><a name="Algorithm_for_computing_the_execution_state"></a>Algorithm for computing the execution state</h5>
<p>Input to the state computation:</p>
<ul>
<li>The <i>input state</i> which is the state of the node it self. </li></ul>
<p>The algorithm is:</p>
<ol style="list-style-type: decimal">
<li>Count the number children which have state <i>success</i>, <i>failure</i>, <i>error</i>, <i>executing</i> and <i>interrupted</i>.</li>
<li>Force all <i>executing</i> children to execution state <i>error</i>.</li>
<li>Add a message with the message key <i>Composite Execution Result</i> which describes the number of children, how many succeeded, how many failed, how many terminated with an error and how many was interrupted.</li>
<li>If <i>input state</i> for the current result is <i>error</i> then the state is set to <i>error</i> and the computation is complete.</li>
<li>If the number of children with errors &gt; 0 then state is set to <i>error</i> and the computation is complete. </li>
<li>If <i>input state</i> for the current result is <i>interrupted</i> then the state is set to <i>interrupted</i> and the computation is complete.</li>
<li>If the number of children which where interrupted &gt; 0 then state is set to <i>interrupted</i> and the computation is complete. </li>
<li>If <i>input state</i> for the current result is <i>failure</i> then the state is set to <i>failure</i> and the computation is complete.</li>
<li>If the number of children with failure &gt; 0 then state is set to <i>failure</i> and the computation is complete. </li>
<li>The state is set to <i>success</i> and the computation is complete. </li></ol>
<p>Comments regarding the <i>input state</i> and the algorithm:</p>
<ul>
<li>Resolution of the state is based on the priority, that <i>error</i> takes precedence over <i>interrupted</i> which takes precedence over <i>failure</i> which takes precedence over <i>success</i>.</li>
<li>If the <i>input state</i> is computed then algorithm will only compute from the state of the children. If the node doesn't have any children then then we have a <i>success</i>.</li></ul></div>
<div class="section">
<h5><a name="a..child_error_is_propagated_to_parent_result_with_computed_state"></a>..child error is propagated to parent result with computed state </h5></div>
<div class="section">
<h5><a name="a..child_failure_is_propagated_to_parent_result_with_computed_state"></a>..child failure is propagated to parent result with computed state</h5></div>
<div class="section">
<h5><a name="a..child_success_doesn.27t_override_parent_error"></a>..child success doesn't override parent error</h5></div>
<div class="section">
<h5><a name="a..child_success_doesn.27t_override_parent_failure"></a>..child success doesn't override parent failure</h5></div>
<div class="section">
<h5><a name="a..child_success_doesn.27t_override_parent_failure"></a>..child success doesn't override parent failure</h5></div>
<div class="section">
<h5><a name="a..forcing_a_running_child_to_error"></a>..forcing a running child to error </h5>
<p>..state of running children is forced to error, because of the programming bug that the parent state is attempted to be set before the child state is set.</p></div></div>
<div class="section">
<h4><a name="State_is_propagated_to_parent_node"></a>State is propagated to parent node</h4>
<p>..when state is set then parent is inspected..</p>
<p>.. if parent isn't running (i.e. have already be set) then parent state is updated by setting the parent state <i>computed</i> to trigger a recomputation of the parent state..</p></div>
<div class="section">
<h4><a name="Result_contains_an_stop_watch"></a>Result contains an stop watch</h4>
<p>..starts when execution result is created</p>
<p>.. stops when state is changed from initial running state to something else </p>
<p>..cannot be restarted. </p></div>
<div class="section">
<h4><a name="Facility_for_storing_messages"></a>Facility for storing messages</h4>
<p>..messages can be stored used the <tt>addMessage</tt> method</p>
<p>..default names: </p>
<ul>
<li>Message</li>
<li>Stack Trace </li>
<li>Error Message</li>
<li>Composite Execution Result</li></ul>
<p>The default names are defined as constants on the <tt>ExecutionResult</tt> interface:</p>
<div class="source"><pre class="prettyprint linenums">public interface ExecutionResult {

        public final String MSG_MESSAGE = &quot;Message&quot;;
        public final String MSG_ERROR_MESSAGE = &quot;Error Message&quot;;        
        public final String MSG_STACKTRACE = &quot;Stack Trace&quot;;
        public final String MSG_COMPOSITE = &quot;Composite Execution Result&quot;;
        
        // remaining interface definition goes here..
}       
</pre></div>
<p>Example of storing a message using one of the constants:</p>
<div class="source"><pre class="prettyprint linenums">
        ....
</pre></div></div></div>
<div class="section">
<h3><a name="Continuation_policy"></a>Continuation policy</h3>
<p>A result is created with a continuation policy which defines how the execution should react to events regarding the interruption of the execution. The continuation policy supports these event:</p>
<ul>
<li>Execution is aborted when an failure or error occurs.</li>
<li>Execution is interrupted by external party, e.g. the human user.</li></ul>
<div class="section">
<h4><a name="Creation_of_the_continuation_policy"></a>Creation of the continuation policy</h4>
<p>The continuation policy is created when a root result is created. The continuation is global/shared for the root result and all child results in an execution.</p>
<p>The continuation policy is created with the directive:</p>
<ul>
<li><i>Continue execution on failure or error</i>. This is the default behavior of Pineapple prior to the introduction of support for continuation policy. </li></ul>
<p>Pineapple sets this value based on the content of models. Pineapple uses the content of models to directs it runtime behavior to support the continuation policy.</p></div>
<div class="section">
<h4><a name="Getting_the_policy"></a>Getting the policy </h4>
<p>The result continuation policy can be obtained from a result using the method:</p>
<div class="source"><pre class="prettyprint linenums">  ContinuationPolicy policy = result.getContinuationPolicy();
</pre></div></div>
<div class="section">
<h4><a name="Modify_the_initial_policy_directive"></a>Modify the initial policy directive </h4>
<p>The directive can be modified:</p>
<div class="source"><pre class="prettyprint linenums">  ContinuationPolicy policy = result.getContinuationPolicy();
  policy.disableContinueOnFailure();
</pre></div>
<p>or (to confirm the default value):</p>
<div class="source"><pre class="prettyprint linenums">  ContinuationPolicy policy = result.getContinuationPolicy();
  policy.enableContinueOnFailure();
</pre></div>
<p>The API is designed in such a way that the directive can only be changed once.</p></div>
<div class="section">
<h4><a name="Reporting_an_error.2C_failure_or_interruption_in_a_cooperative_fashion"></a>Reporting an error, failure or interruption in a cooperative fashion</h4>
<p>If the continuation directive is disabled and an error, failure or interruption is registered by the framework then it will capture the &quot;failed&quot; result and throw an exception to signal that the execution should be aborted.</p>
<p>The prerequisite is to disable the continuation directive:</p>
<div class="source"><pre class="prettyprint linenums">  ContinuationPolicy policy = result.getContinuationPolicy();
  policy.disableContinueOnFailure();
</pre></div>
<p>..then an execution (or part of it) is completed by setting the state of an result:</p>
<div class="source"><pre class="prettyprint linenums">  // create child result
  ExecutionResult childResult = rootResult.addChild( &quot;some child description&quot;);

  // complete 
  childResult.completeAsError(messageSource, &quot;dmtd.error&quot;, null, e);
</pre></div>
<p>The framework implements the algorithm to signal that execution should be aborted:</p>
<ol style="list-style-type: decimal">
<li>If the result completed with error, failure or interruption (either directly or computed into one of these states) then the result will be captured internally by the execution framework.</li>
<li>The state of the continuation policy will be updated with the captured result: 
<div class="source"><pre class="prettyprint linenums">  policy.setFailedResult(failedResult);
</pre></div></li>
<li>If attempt is made to create a new child result then the framework will throw the runtime exception <tt>InterruptedExecutionException</tt>. </li></ol>
<p>Users of the framework should take note when this exception is thrown and in a <i>friendly cooperative</i> approach:</p>
<ul>
<li>Restrain from creating more child results.</li>
<li>Complete all executing results. </li>
<li>Exit execution of whatever is going on.</li></ul></div>
<div class="section">
<h4><a name="Querying_the_continuation_policy_for_friendly_cooperation"></a>Querying the continuation policy for friendly cooperation</h4>
<p>To avoid the presence of <tt>InterruptedExecutionException</tt> the continuation policy can be queried as to whether the execution should be aborted or continue:</p>
<div class="source"><pre class="prettyprint linenums">  // query whether execution should continue
  if(!policy.continueExecution()) return;
  
  // continue execution 
</pre></div></div></div>
<div class="section">
<h3><a name="Result_listener"></a>Result listener</h3>
<p>Interested parties can implement the <tt>ResultListener</tt> interface and then register them self as an observer at the core component. </p>
<p>The core component implements the <i>observer</i> pattern to provide a facility for clients to be notified in real time of how the execution of an operation proceeds. </p>
<p>The core component has the role of <i>subject</i> in the observer pattern. To support the role, it provides the <tt>addListener( ResultListener listener )</tt> method which should be used by observers to register themselves. The core component contain logic which notifies all registered observers during execution of an operation.</p>
<p>Clients should implement objects with the role of <i>observer</i> and register them with the core component to be notified of how the execution an operation proceeds. </p>
<p>An observer must implement the <tt>com.alpha.pineapple.execution.ResultListener</tt> interface:</p>
<div class="source"><pre class="prettyprint linenums">public interface ResultListener {

  void notify(ExecutionResultNotification notification);
}
</pre></div>
<div class="section">
<h4><a name="Notification_of_observers"></a>Notification of observers</h4>
<p>Each time an execution result object changes it state, all registered observers are notified of the change. The notification is implemented by invoking <tt>notify(ExecutionResultNotification notification)</tt> on the each registered observer.</p>
<p>The argument is a notification object which contains:</p>
<ul>
<li>Execution result object which have changed state. </li>
<li>The new recorded state of the execution result object.</li></ul>
<p>To capture the state when listeners are notified the state is recorded separately in the notification. Since the state of an execution result is mutable, the recorded state in the notification might not match the state of the execution result since its state can have changed since the creation of the notification and the notification of the observers.</p>
<p>An observer can query the the execution result about its new state and additional info. </p></div></div>
<div class="section">
<h3><a name="Result_repository"></a>Result repository</h3>
<p>..container for listeners </p>
<p>..container controlling execution of operations. </p></div>
<div class="section">
<h3><a name="Result_factory"></a>Result factory</h3>
<p>The <tt>ExecutionResultFactory</tt> interface defines an interface for creation of execution results objects.</p>
<p>The Spring application context for the API project contains a bean named <tt>executionResultFactory</tt> which implements the <tt>ExecutionResultFactory</tt> interface. The bean is implemented by the <tt>DefaultExecutionResultFactoryImpl</tt> class. </p>
<div class="section">
<h4><a name="Creating_new_execution_using_the_factory"></a>Creating new execution using the factory</h4>
<p>Inject the result factory using Spring:</p>
<div class="source"><pre class="prettyprint linenums">  @Resource
  ExecutionResultFactory executionResultFactory;
</pre></div>
<p>A result instance can be created using the factory</p>
<div class="source"><pre class="prettyprint linenums">  ExecutionResult result = executionResultFactory.startExecution(&quot;Some description&quot;);
</pre></div>
<p>The semantics of the <tt>startExecution(String description)</tt> is:</p>
<ol style="list-style-type: decimal">
<li>Creates a new execution result with <i>running</i> state.</li>
<li>The internal stop watch is running for the execution result.</li>
<li>The execution result has the description &quot;some description&quot;.</li>
<li>The parent result is null for the new execution result. </li></ol></div></div>
<div class="section">
<h3><a name="Exceptions"></a>Exceptions</h3>
<p>The exception class <tt>ExecutionResultException</tt> can be used to signal an error during execution of execution result by encapsulating the result..</p></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
Copyright (C) 2007-2017 Allan Thrane Andersen. All Rights Reserved.
        </div>
      </div>
    </footer>
  </body>
</html>

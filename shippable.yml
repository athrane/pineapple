
language: java	

env:
- secure: Vx0Eaosf/cCgmxLQNpsAaEkbMM7fhmNDA2x8aVSzDMwstothq306Pt2KSUocmPdvml/NlxALPi+Amgh4M8JXYVSQbKVRGncOFn+YHaE0UgjSsYsyBq1NbRq8ibSCSM8e4fvcru9Ykp47XD98ooHokkN+DCE4eYNwsG2XRoS72zHYEh5ghWJH6/PvweFApSLYvOu56Z3cDxbqjs6HwAB0KWuiMiygDdmLLo7GL43cIZg8h2fl8QNMeuTdn8cxETMgppiyDvWywVy66oNwsEeX79PmKlE84kF53H6tZ+vHoEth1ENlboYIqDChesmlctowJqysesK/2KO1zIN8YcDC6Q==

jdk:
  - openjdk8
  - oraclejdk8
   
before_install:

build:
  ci:
  - mkdir -p ~/.m2  
  - shippable_retry curl -O -L https://dl.bintray.com/pineapple/generic/pineapple-3rdparty-maven-dependencies-1.10.0.tar
  - tar xfv pineapple-3rdparty-maven-dependencies-1.10.0.tar
  - mv repository ~/.m2/
  - shippable_retry mvn --quiet install

  on_success:
  - echo "<settings><servers><server><id>bintray-pineapple-maven</id>
               <username>einheriii</username>
               <password>${BINTRAY_PASSWORD}</password>
           </server></servers></settings>" > ~/.m2/settings.xml     
  - mvn --quiet deploy 
  
  post_ci:
  - mkdir -p $SHIPPABLE_BUILD_DIR/dockersrc  
  - cp $SHIPPABLE_BUILD_DIR/applications/pineapple-web-application/pineapple-standalone-web-client/target/pineapple-standalone-web-client-*.zip $SHIPPABLE_BUILD_DIR/dockersrc  
  - cp $SHIPPABLE_BUILD_DIR/src/ci/Dockerfile $SHIPPABLE_BUILD_DIR/dockersrc
  - ls -la $SHIPPABLE_BUILD_DIR/dockersrc
  - cd $SHIPPABLE_BUILD_DIR/dockersrc
  - pwd
  - docker build -t pineapple/pineapple:1.10.0 .
  - docker push pineapple/pineapple:1.10.0
  
integrations:
  hub:
    - integrationName: docker
      type: docker 
<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src\site\apt/usage\index.apt at 09 Jun 2019
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Allan Thrane Andersen" />
    <meta name="Date-Revision-yyyymmdd" content="20190609" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Pineapple composite execution plugin &#x2013; Usage</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
    <!-- Google Analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28287414-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Pineapple composite execution plugin</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="../../../index.html" title="Pineapple Home">Pineapple Home</a><span class="divider">/</span></li>
      <li class=""><a href="../../index.html" title="Pineapple plugin projects">Pineapple plugin projects</a><span class="divider">/</span></li>
      <li class=""><a href="../index.html" title="Pineapple composite execution plugin">Pineapple composite execution plugin</a><span class="divider">/</span></li>
    <li class="active ">Usage</li>
        <li id="publishDate" class="pull-right">Last Published: 09 Jun 2019</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Project Overview</li>
    <li><a href="../../../index.html" title="Home"><span class="none"></span>Home</a></li>
    <li><a href="../../../usage/installation.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li><a href="../../../usage/index.html" title="For Users"><span class="none"></span>For Users</a></li>
    <li><a href="../../../development/index.html" title="For Developers"><span class="none"></span>For Developers</a></li>
    <li><a href="../../../usage/terms.html" title="Terms and Conditions"><span class="none"></span>Terms and Conditions</a></li>
      <li class="nav-header">Clients</li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-standalone-web-client/index.html" title="Standalone Web Application"><span class="none"></span>Standalone Web Application</a></li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/index.html" title="Deployable Web Application"><span class="none"></span>Deployable Web Application</a></li>
    <li><a href="../../../pineapple-applications/pineapple-maven-plugin/index.html" title="Maven Plugin"><span class="none"></span>Maven Plugin</a></li>
      <li class="nav-header">Plugins</li>
    <li><a href="../../../pineapple-plugins/pineapple-agent-plugin/index.html" title="Agent"><span class="none"></span>Agent</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-composite-execution-plugin/index.html" title="Composite Execution"><span class="none"></span>Composite Execution</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-ssh-plugin/index.html" title="SSH"><span class="none"></span>SSH</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-git-plugin/index.html" title="Git"><span class="none"></span>Git</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-docker-plugin/index.html" title="Docker"><span class="none"></span>Docker</a></li>
    <li><a href="../../../pineapple-modules/pineapple-infrastructure-test-plugin/index.html" title="Infrastructure Test"><span class="none"></span>Infrastructure Test</a></li>
      <li class="nav-header">API's</li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/usage/rest.html" title="REST"><span class="none"></span>REST</a></li>
    <li><a href="../../../development/plugin-framework.html" title="Plugin Framework"><span class="none"></span>Plugin Framework</a></li>
      <li class="nav-header">Additional Information</li>
    <li><a href="http://pineapplesoftware.blogspot.com" class="externalLink" title="The Pineapple Project Blog"><span class="none"></span>The Pineapple Project Blog</a></li>
    <li><a href="http://exceptiontrail.blogspot.com" class="externalLink" title="Pineapple Exception Trail Blog"><span class="none"></span>Pineapple Exception Trail Blog</a></li>
      <li class="nav-header">Project Tools</li>
    <li><a href="https://bintray.com/pineapple/maven/com.alpha.pineapple" class="externalLink" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="https://github.com/athrane/pineapple" class="externalLink" title="Source Code"><span class="none"></span>Source Code</a></li>
    <li><a href="https://github.com/athrane/pineapple/issues" class="externalLink" title="Issue Tracker"><span class="none"></span>Issue Tracker</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
</ul>
          <hr />
          <div id="poweredBy">
    <script type="text/javascript">asyncJs( 'https://apis.google.com/js/plusone.js' )</script>
    <div class="g-plusone" data-href="https://pineapple.java.net" data-size="tall" ></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<div class="section">
<h2><a name="Introduction"></a>Introduction</h2>
<div class="section">
<h3><a name="Overview"></a>Overview</h3>
<div class="section">
<h4><a name="Invoking_the_plugin"></a>Invoking the plugin</h4>
<p>The plugin is invoked by the core component when the core component is used by one of the Pineapple clients. To trigger invocation by the core component the plugin needs to be configured. </p></div>
<div class="section">
<h4><a name="Configuration"></a>Configuration</h4><img src="../images/configure-plugin.jpg" alt="" />
<p>Two steps are needed to configure the plugin:</p>
<ol style="list-style-type: decimal">
<li><a href="#Define_resource">Define resource:</a> Define resource which enables usage of the the plugin. The resource enables usage by definition of a mapping between the resource ID (e.g. some user defined key referenced from models) and the plugin ID (e.g. the Java package name which implements the plugin: <tt>com.alpha.pineapple.plugin.composite.execution</tt>). <b>Please notice:</b> if you use Pineapple with the <a href="../../../usage/default-configuration.html">default configuration</a> then this step isn't required since the composite execution plugin will be configured for usage in all environments out-of-the-box. </li>
<li><a href="#Define_the_module_model">Define the module model</a> and add content to the model by defining a list of composite modules. The composite modules are processed in sequence when the plugin is invoked with the model. The model is defined using the <a href="#The_composite_execution_plugin_schema">The composite execution plugin schema</a>.</li></ol>
<p>For more info about configuration of plugins:</p>
<ul>
<li>For info about <b>resources</b> and <b>credentials</b> read the <a href="../../../usage/configuration-environment.html">Environment configuration</a> document.</li>
<li>For info about <b>modules</b> and <b>module models</b> read the <a href="../../../usage/configuration-modules.html">Modules configuration</a> document.</li></ul></div>
<div class="section">
<h4><a name="Supported_operations_by_the_plugin"></a>Supported operations by the plugin </h4>
<p>The plugin supports any operations.</p></div>
<div class="section">
<h4><a name="Execution_of_an_operation"></a>Execution of an operation</h4>
<p>When the plugin is invoked with an operation (e.g. <i>deploy-configuration</i>) and a module model which defines a list of composite modules then the plugin will:</p>
<ul>
<li>Iterate over the list of composite modules and for each:
<ul>
<li>Invoke the module with same operation (e.g. <i>deploy-configuration</i>) and environment that the composite execution plugin was invoked with.</li></ul></li></ul></div></div>
<div class="section">
<h3><a name="Define_resource">Define resource</a></h3>
<p>The purpose of defining a resource for this plugin is to define a mapping between the resource ID and the plugin ID. The resource ID is the user defined key which is referenced from module models which are targeting the resource. The plugin ID is the Java package name which implements the plugin: <tt>com.alpha.pineapple.plugin.composite.execution</tt>.</p>
<div class="section">
<h4><a name="Considerations_for_defining_resources_for_this_plugin"></a>Considerations for defining resources for this plugin </h4>
<p>The purpose of this plugin is to increase the general usability of Pineapple versus most of the other plugins whose purpose are to manage or test IT resources. The next section will illustrate the generic way of configuring the plugin, but considering the purpose, the generic way isn't the ideal way to configure the plugin. <b>The ideal way to configure the plugin is to define it in the wild card environment. This will enable its functionality for all environments</b>. This way of configuring the plugin will be described at the end of the section. </p></div>
<div class="section">
<h4><a name="Generic_configuration_of_the_plugin"></a>Generic configuration of the plugin</h4>
<p>To define a new resource, add a <tt>resource</tt> element to the target environment in the configuration file <tt>${pineapple.home.dir}/conf/resources.xml</tt>:</p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration xmlns=&quot;http://pineapple.dev.java.net/ns/environment_1_0&quot; 
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
  
  &lt;environments&gt;
    &lt;environment id=&quot;local-environment&quot; &gt;
      &lt;resources&gt;
        &lt;resource id=&quot;composite-execution&quot; plugin-id=&quot;com.alpha.pineapple.plugin.composite.execution&quot; /&gt;                  
      &lt;/resources&gt;
    &lt;/environment&gt;                                                              
  &lt;/environments&gt;
&lt;/configuration&gt;        
</pre></div>
<p>For all the details about configuration of environments and resources, please visit the <a href="../../../usage/configuration-environment.html">Environment Configuration Reference</a>. </p>
<p>The semantics of the resource element is:</p></div>
<div class="section">
<h4><a name="The_id_attribute"></a>The <tt>id</tt> attribute</h4>
<p>Identifies the resource uniquely in the current environment. This ID is referenced from models which intends to use the plugin. </p></div>
<div class="section">
<h4><a name="The_plugin-id_element"></a>The <tt>plugin-id</tt> element</h4>
<p>The plugin ID defines the name of the Java package which implements the plugin. The plugin ID for this plugin is: <tt>com.alpha.pineapple.plugin.composite.execution</tt>.</p></div>
<div class="section">
<h4><a name="The_property_attributes.28s.29"></a>The <tt>property</tt> attributes(s)</h4>
<p>There are no mandatory properties used by the plugin. </p></div>
<div class="section">
<h4><a name="Ideal_configuration_of_the_plugin"></a>Ideal configuration of the plugin</h4>
<p>Since the plugin provides general functionality for Pineapple it should be configured for usage in all environments. To avoid configuring it for every single environment, define it once in the wild card environment (e.g. &quot;*&quot;) :</p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration xmlns=&quot;http://pineapple.dev.java.net/ns/environment_1_0&quot; 
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
  
  &lt;environments&gt;
    &lt;environment id=&quot;*&quot; &gt;
      &lt;resources&gt;
        &lt;resource id=&quot;composite-execution&quot; plugin-id=&quot;com.alpha.pineapple.plugin.composite.execution&quot; /&gt;                  
      &lt;/resources&gt;
    &lt;/environment&gt;                                                              
  &lt;/environments&gt;
&lt;/configuration&gt;        
</pre></div>
<p>Then the plugin is ready to be used from any models which targets any environment. Models can use the plugin with the target-resource name <tt>composite-execution</tt>.</p></div></div>
<div class="section">
<h3><a name="Define_the_module_model">Define the module model</a></h3><img src="../images/module-directory-layout.jpg" alt="" />
<p>A <b><a href="../../../usage/configuration-modules.html">module</a></b> defines the input used by Pineapple to execute operations. A module is defined by a directory layout. Part of a module is the <b>model(s)</b> which defines what happens when the module is invoked. A model is put together by one or more sub models from different plugins. Each plugin defines its own schema for its particular model </p>
<div class="section">
<h4><a name="The_composite_execution_plugin_schema">The composite execution plugin schema</a> </h4>
<p>This plugin defines a schema named <b>The composite execution plugin schema</b> which defines the <tt>http://pineapple.dev.java.net/ns/plugin/composite_execution_1_0</tt> namespace. For more information about where the schema can be found, refer to the <a href="../../../usage/schemas-plugins.html">Schema locations for plugins page.</a> </p></div>
<div class="section">
<h4><a name="Name_and_location_of_the_the_module_model_file"></a>Name and location of the the module model file </h4>
<p>The list of composite models which should be executed when the plugin is invoked are defined in the module model files which are located at <tt>${module-dir}/models/${environment}.xml</tt> where:</p>
<ul>
<li><tt>${module-dir}</tt> is the module root directory which identifies the module with a unique name and version. </li>
<li><tt>${environment}.xml</tt> is a module model file for a target environment, with <tt>${environment}</tt> substituted with the environment name, e.g. <tt>local-environment.xml</tt> for an environment named <tt>local-environment</tt>. </li></ul>
<p>If the model file doesn't exist for an environment where the composite execution should be run, then create the model file and name it after the target environment, e.g. <tt>local-environment.xml</tt> for an environment named <tt>local-environment</tt>.</p>
<p>Even if the plugin is configured in wild card environment, then a specific name for the model is required. The wild card environment can't be used as a target environment. Consider it a meta environment from which all other environments inherits resource configurations. </p></div>
<div class="section">
<h4><a name="The_module_model_configuration_schema"></a>The module model configuration schema</h4>
<p>Module model files are defined using the <b>module model configuration schema</b> which defines the <tt>http://pineapple.dev.java.net/ns/module_model_1_0</tt> namespace. Since module model files contain elements from multiple namespace all the elements and attributes should be qualified. The header and root element should be defined as (look in the <a href="../../../usage/configuration-modules.html">Modules configuration</a> document for more details):</p>
<p>This example shows definition of the minimal model file for <tt>local-environment:</tt> </p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;mmd:models xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xmlns:mmd=&quot;http://pineapple.dev.java.net/ns/module_model_1_0&quot; /&gt;
</pre></div></div>
<div class="section">
<h4><a name="Adding_the_plugin_schema_to_the_model"></a>Adding the plugin schema to the model</h4>
<p>The next step is to include the <a href="#The_composite_execution_plugin_schema">The composite execution plugin schema</a> to get access to the entities defined by the schema:</p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;mmd:models xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xmlns:mmd=&quot;http://pineapple.dev.java.net/ns/module_model_1_0&quot;                 
  xmlns:cep=&quot;http://pineapple.dev.java.net/ns/plugin/composite_execution_1_0&quot; /&gt;
</pre></div>
<p>Now we have a minimal module model file with three namespaces:</p>
<ul>
<li><b>xs:</b> The basic XMLSchema schema which is only used in the root element of the document.</li>
<li><b>mmd:</b> The module model schema which is used to define the skeleton of a model file.</li>
<li><b>cep:</b> The composite execution plugin schema which is used to define composite executions of Pineapple modules.</li></ul></div>
<div class="section">
<h4><a name="Defining_the_model_which_targets_resources"></a>Defining the model which targets resources</h4>
<p>Add a new <tt>model</tt> with a <tt>target-resource</tt> attribute. The value of the <tt>target-resource</tt> should match the id of the resource which was defined previously in the section <a href="#Define_resource">Define resource</a>, e.g. <tt>composite-execution</tt>:</p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;mmd:models xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xmlns:mmd=&quot;http://pineapple.dev.java.net/ns/module_model_1_0&quot;                 
  xmlns:cep=&quot;http://pineapple.dev.java.net/ns/plugin/composite_execution_1_0&quot; /&gt;
  
  &lt;mmd:model target-resource=&quot;composite-execution&quot;&gt;             
    &lt;mmd:content /&gt;                             
  &lt;/mmd:model&gt;
&lt;/mmd:models&gt;    
</pre></div>
<p>Add content to the model which uses the plugin through the <tt>composite-execution</tt> reference:</p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;mmd:models xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xmlns:mmd=&quot;http://pineapple.dev.java.net/ns/module_model_1_0&quot;                 
  xmlns:cep=&quot;http://pineapple.dev.java.net/ns/plugin/composite_execution_1_0&quot; /&gt;
  
  &lt;mmd:model target-resource=&quot;composite-execution&quot;&gt;             
    &lt;mmd:content&gt;
      &lt;cep:composite-execution&gt;
      &lt;/cep:composite-execution&gt;      
    &lt;/mmd:content&gt;                                                                                                                                                                              
  &lt;/mmd:model&gt;
&lt;/mmd:models&gt;    
</pre></div></div></div>
<div class="section">
<h3><a name="Define_composite_execution_of_modules_in_the_module_model">Define composite execution of modules in the module model</a> </h3>
<p>Define a sequence of composite modules which should be executed when Pineapple is invoked with the model:</p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;mmd:models xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xmlns:mmd=&quot;http://pineapple.dev.java.net/ns/module_model_1_0&quot;                 
  xmlns:cep=&quot;http://pineapple.dev.java.net/ns/plugin/composite_execution_1_0&quot; /&gt;
  
  &lt;mmd:model target-resource=&quot;composite-execution&quot;&gt;             
    &lt;mmd:content&gt;
      &lt;cep:composite-execution&gt;
        &lt;cep:module name=&quot;100-ssh-configure-os-yum-centos64&quot; /&gt;
        &lt;cep:module name=&quot;101-ssh-configure-os-linux64&quot; /&gt;                              
      &lt;/cep:composite-execution&gt;      
    &lt;/mmd:content&gt;
  &lt;/mmd:model&gt;
&lt;/mmd:models&gt;    
</pre></div>
<div class="section">
<h4><a name="Adding_composite_modules"></a>Adding composite modules </h4>
<p>The modules added to the model are called <i>composite modules</i> since they define the parts in the greater whole.</p>
<p>The composite modules must be existing modules which reside in the same module directory as the composite execution module.</p>
<p>A composite module is added through the definition of a single element which defines the name of the composite:</p></div>
<div class="section">
<h4><a name="module_element"></a><tt>module</tt> element </h4>
<p>Defines a composite module which is part of the composite execution.</p>
<p>the element has a single attribute:</p>
<div class="section">
<h5><a name="name_attribute"></a><tt>name</tt> attribute </h5>
<p>Mandatory attribute, which defines the name of a composite module. </p></div></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
Copyright (C) 2007-2019 Allan Thrane Andersen. All Rights Reserved.
        </div>
      </div>
    </footer>
  </body>
</html>

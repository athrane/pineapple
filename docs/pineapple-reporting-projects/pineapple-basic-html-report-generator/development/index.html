<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src\site\apt/development\index.apt at 09 Jun 2019
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Allan Thrane Andersen" />
    <meta name="Date-Revision-yyyymmdd" content="20190609" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Pineapple basic HTML report generator &#x2013; Development documentation</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
    <!-- Google Analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28287414-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Pineapple basic HTML report generator</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="../../../index.html" title="Pineapple Home">Pineapple Home</a><span class="divider">/</span></li>
      <li class=""><a href="../../index.html" title="Pineapple reporting projects">Pineapple reporting projects</a><span class="divider">/</span></li>
      <li class=""><a href="../index.html" title="Pineapple basic HTML report generator">Pineapple basic HTML report generator</a><span class="divider">/</span></li>
    <li class="active ">Development documentation</li>
        <li id="publishDate" class="pull-right">Last Published: 09 Jun 2019</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Project Overview</li>
    <li><a href="../../../index.html" title="Home"><span class="none"></span>Home</a></li>
    <li><a href="../../../usage/installation.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li><a href="../../../usage/index.html" title="For Users"><span class="none"></span>For Users</a></li>
    <li><a href="../../../development/index.html" title="For Developers"><span class="none"></span>For Developers</a></li>
    <li><a href="../../../usage/terms.html" title="Terms and Conditions"><span class="none"></span>Terms and Conditions</a></li>
      <li class="nav-header">Clients</li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-standalone-web-client/index.html" title="Standalone Web Application"><span class="none"></span>Standalone Web Application</a></li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/index.html" title="Deployable Web Application"><span class="none"></span>Deployable Web Application</a></li>
    <li><a href="../../../pineapple-applications/pineapple-maven-plugin/index.html" title="Maven Plugin"><span class="none"></span>Maven Plugin</a></li>
      <li class="nav-header">Plugins</li>
    <li><a href="../../../pineapple-plugins/pineapple-agent-plugin/index.html" title="Agent"><span class="none"></span>Agent</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-composite-execution-plugin/index.html" title="Composite Execution"><span class="none"></span>Composite Execution</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-ssh-plugin/index.html" title="SSH"><span class="none"></span>SSH</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-git-plugin/index.html" title="Git"><span class="none"></span>Git</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-docker-plugin/index.html" title="Docker"><span class="none"></span>Docker</a></li>
    <li><a href="../../../pineapple-modules/pineapple-infrastructure-test-plugin/index.html" title="Infrastructure Test"><span class="none"></span>Infrastructure Test</a></li>
      <li class="nav-header">API's</li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/usage/rest.html" title="REST"><span class="none"></span>REST</a></li>
    <li><a href="../../../development/plugin-framework.html" title="Plugin Framework"><span class="none"></span>Plugin Framework</a></li>
      <li class="nav-header">Additional Information</li>
    <li><a href="http://pineapplesoftware.blogspot.com" class="externalLink" title="The Pineapple Project Blog"><span class="none"></span>The Pineapple Project Blog</a></li>
    <li><a href="http://exceptiontrail.blogspot.com" class="externalLink" title="Pineapple Exception Trail Blog"><span class="none"></span>Pineapple Exception Trail Blog</a></li>
      <li class="nav-header">Project Tools</li>
    <li><a href="https://bintray.com/pineapple/maven/com.alpha.pineapple" class="externalLink" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="https://github.com/athrane/pineapple" class="externalLink" title="Source Code"><span class="none"></span>Source Code</a></li>
    <li><a href="https://github.com/athrane/pineapple/issues" class="externalLink" title="Issue Tracker"><span class="none"></span>Issue Tracker</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
</ul>
          <hr />
          <div id="poweredBy">
    <script type="text/javascript">asyncJs( 'https://apis.google.com/js/plusone.js' )</script>
    <div class="g-plusone" data-href="https://athrane.github.io/pineapple/pineapple-reporting-projects/pineapple-basic-html-report-generator/" data-size="tall" ></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<div class="section">
<h2><a name="Development_documentation"></a>Development documentation</h2>
<div class="section">
<h3><a name="Schema_location"></a>Schema location</h3>
<p>The generator defines a schema named <b>Basic HTML report schema</b> which is used internally by the generator to serialize the output of an operation to a XML file. The schema defines the namespace <tt>http://pineapple.dev.java.net/ns/report/basic_html_1_0</tt>. </p>
<p>The schema can be found at these locations:</p>
<ul>
<li>At the root of the jar file produce by the <tt>pineapple-basic-html-report-generator</tt>.</li>
<li>At the project website at: <tt>http://pineapple.dev.java.net/ns/report/basic_html_1_0</tt>.</li>
<li>At the root of the jar file produced by the <tt>pineapple-basic-html-report-generator</tt> project.</li></ul>
<div class="section">
<h4><a name="Adding_the_schemas_to_the_main_project_web_site"></a>Adding the schemas to the main project web site</h4>
<p>During the <tt>site</tt> phase (of the Maven build) the schema is copied to the main site in the <tt>pineapple-project</tt>. The schema is copied to the directory <tt>/ns/report</tt>. The copy operation is implemented in the <tt>pom.xml</tt> for the <tt>pineapple-basic-html-report-generator</tt> project </p></div></div>
<div class="section">
<h3><a name="Generation_of_classes_from_XML_schemas"></a>Generation of classes from XML schemas</h3>
<p>The project uses JAXB through the Maven plugin <tt>cxf-xjc-plugin</tt> to generate classes from XML schema. </p>
<div class="section">
<h4><a name="Customized_package_names"></a>Customized package names</h4>
<p>The generated classes are mapped into the package <tt>com.alpha.pineapple.model.report.basichtml</tt> using the JAXB bindings file at: src/main/resources/bindings.xjb.</p></div>
<div class="section">
<h4><a name="Customized_type_names"></a>Customized type names</h4>
<p>The JAXB bindings file also defines mappings of Schema type into Java types. The applied rule is to remove the postfixed <tt>Type</tt> from the Schema type in the corresponding Java types, i.e. from the schema type named <tt>NiceType</tt> a Java type named <tt>Nice</tt> is generated by JAXB. </p></div></div>
<div class="section">
<h3><a name="Internal_configuration"></a>Internal configuration</h3>
<div class="section">
<h4><a name="Logging"></a>Logging</h4>
<p>The report generator uses log4j for logging. Each pineapple client must provide a Log4j configuration which is accessible at runtime as a result of the build process.</p>
<p>The report generator does not provide a Log4j configuration as part of its production build. A log4j configuration file is defined in the project in the directory <tt>src/test/resources/log4.properties</tt> for testing. </p>
<p>The test configuration configures Log4j to write to the log file to <tt>${user.home}/.pineapple/logs/pineapple.log</tt>.</p></div>
<div class="section">
<h4><a name="XSLT_file_for_HTML_file_generation"></a>XSLT file for HTML file generation</h4>
<p>The report generator uses a XSLT file which to transform the generated XML report file into a HTML file. The XLST file is located in <tt>src/main/resources/com.alpha.pineapple.report.basichtml.xsl</tt>. </p></div>
<div class="section">
<h4><a name="Spring_configuration_file"></a>Spring configuration file </h4>
<p>The report generator contains a configuration file which defines a Spring application context. The Spring application context defines dependency injection of objects as part of initialization of the report generator. The file is located in <tt>src/main/resources/com.alpha.pineapple.report.basichtml-config.xml</tt>. </p></div>
<div class="section">
<h4><a name="Internationalization_.28I18N.29_configuration_file"></a>Internationalization (I18N) configuration file </h4>
<p>The report generator uses internationalization. Messages used by classes in the project are located in the file <tt>src/main/resources/com.alpha.pineapple.report.basichtml-messages.properties</tt>. </p></div></div>
<div class="section">
<h3><a name="Implementation"></a>Implementation</h3>
<div class="section">
<h4><a name="Report_generator_class"></a>Report generator class</h4>
<p>The package <tt>com.alpha.pineapple.report.basichtml</tt> is the root package of the report generator and contains the report generator class named <tt>BasicHtmlReportGeneratorImpl</tt>. </p>
<div class="section">
<h5><a name="Implemented_as_an_ResultListener"></a>Implemented as an <tt>ResultListener</tt> </h5>
<p>The class implements the <tt>com.alpha.pineapple.execution.ResultListener</tt> interface which listens to events from execution results during execution of an Pineapple operation. When the state of root execution result is changed from running to some completed state, the generator creates the report.</p></div>
<div class="section">
<h5><a name="Implements_the_ReportGeneratorInfo_interface"></a>Implements the <tt>ReportGeneratorInfo</tt> interface</h5>
<p>The generator implements the <tt>com.alpha.pineapple.report.basichtml.ReportGeneratorInfo</tt> interface which provides info how the report generation process whent. </p></div>
<div class="section">
<h5><a name="The_report_generation_process"></a>The report generation process </h5>
<p>The algorithm for generating a reports is:</p>
<ol style="list-style-type: decimal">
<li>When <tt>notifyOfResultStateChange(...)</tt> is invoked, it is validated that the received event is from the root execution result and its stateis changed from running. If this is the case then report generation process is started. Otherwise the generator exits. </li>
<li>An new report instance directory is created.</li>
<li>The tree with the received root execution result as root, is mapped into a tree consisting of report result objects of the type <tt>com.alpha.pineapple.model.report.basichtml.ExecutionResultType</tt> using the mapper object.</li>
<li>The tree of report result objects is marshalled into an XML file using JAXB. </li>
<li>Using the XML file as input, an HTML file is created using the XLST transformer. </li></ol></div>
<div class="section">
<h5><a name="Creating_report_generator_instances"></a>Creating report generator instances</h5>
<p>Instances are created by using the factory methods:</p>
<ul>
<li><tt>BasicHtmlReportGeneratorImpl.getInstance(File reportDirectory)</tt></li>
<li><tt>BasicHtmlReportGeneratorImpl.getInstance()</tt>.</li>
<li>Looking up the bean named <tt>reportGenerator</tt> in the Spring configuration file. If the report directory isn't initialized afterwards by invoking <tt>ReportGeneratorInfo.setReportDirectory</tt> then the generator will create reports at the default location.</li></ul></div>
<div class="section">
<h5><a name="Customizing_the_location_of_the_reports"></a>Customizing the location of the reports </h5>
<p>The location of reports is configurable as an argument to the factory method <tt>BasicHtmlReportGeneratorImpl.getInstance(File reportDirectory)</tt>. The <tt>reportDirectory</tt> parameter defines a the root directory where the generator will generate reports.</p>
<p>Alternatively, the report generator implements the interface <tt>ReportGeneratorInfo</tt> which contains the method <tt>setReportDirectory(..)</tt> which can be used to set the root directory. </p>
<p>At runtime the the generator will add a new sub directory each time the generator is invoked. The created directory is named <tt>report-TIMESTAMP</tt> where TIMESTAMP is a time stamp with the format YYYY-MM-DD-HHMMSS. The time stamp marks the time when the generator starts to create the report. The two report files named <tt>basic-report.xml</tt> and <tt>basic-report.html</tt> are created in the directory. </p>
<p>If no location is defined, i.e. the no-arg factory method <tt>BasicHtmlReportGeneratorImpl.getInstance()</tt> is used, or the generator is looked up from the Spring context, the generator will generate reports in the root directory: <tt>${user.home}/.pineapple/reports/</tt> </p></div></div>
<div class="section">
<h4><a name="JAXB_namespace_mapper_class"></a>JAXB namespace mapper class</h4>
<p>The class <tt>ReportNamespaceMapper</tt> implements the <tt>com.sun.xml.bind.marshaller.NamespacePrefixMapper</tt> interface. The class maps entities from <b>Basic HTML report schema</b> namespace with a prefix during JAXB marshalling. The class defines the mapping:</p>
<ul>
<li><tt>http://pineapple.dev.java.net/ns/report/basic_html_1_0</tt> is mapped to <tt>rbh</tt>.</li></ul></div>
<div class="section">
<h4><a name="Handling_invalid_XML_control_codes"></a>Handling invalid XML control codes</h4>
<p>The XLST transformer can't handle invalid XML chars.</p>
<p>To removed all invalid XML chars then then all text is escaped to XML 1.0 and then unescaped again mediately. The purpose of the unescaping is to let JAXB and the XSLT transformer handling the escaping of XML. </p></div>
<div class="section">
<h4><a name="Model_helper_class"></a>Model helper class</h4>
<p>The class <tt>com.alpha.pineapple.report.basichtml.model.MapperImpl</tt> which implements the interface <tt>Mapper</tt> implements mapping between <tt>ExecutionResult</tt> objects and schema generated classes. The class is used by the generator to produce the object graph which is marshalled into the XML file.</p>
<div class="section">
<h5><a name="Mapping_execution_results_into_report_results"></a>Mapping execution results into report results</h5>
<p>The execution results which is mapped by the mapper object is processed differently based on their position in the result object graph:</p>
<ul>
<li>The <b>root execution result</b> is mapped into the root report result object and added directly to the report object. This report result object is tagged with the type <tt>operation</tt>.</li>
<li>The <b>execution result objects at level 1</b> is mapped into a report result objects and added directly to the root report object. These report result object are tagged with the type <tt>model</tt>.</li>
<li>The <b>execution result objects at level 2+</b> is mapped into a report result objects and added directly to their parent report object. These report result object are tagged with the type <tt>default</tt>.</li></ul></div>
<div class="section">
<h5><a name="Generating_unique_id_for_HTML_anchors"></a>Generating unique id for HTML anchors</h5>
<p>The mapper object adds a unique id to each report result object. These id's are implemented as integers and stored in the <tt>reportId</tt> attribute on a report result object. The id's are used to generate HTML anchors in the HTML report file.</p></div></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
Copyright (C) 2007-2019 Allan Thrane Andersen. All Rights Reserved.
        </div>
      </div>
    </footer>
  </body>
</html>

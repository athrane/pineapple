<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src\site\apt/usage\index.apt at 03 Mar 2019
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Allan Thrane Andersen" />
    <meta name="Date-Revision-yyyymmdd" content="20190303" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Pineapple Git plugin &#x2013; Usage</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
    <!-- Google Analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28287414-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Pineapple Git plugin</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="../../../index.html" title="Pineapple Home">Pineapple Home</a><span class="divider">/</span></li>
      <li class=""><a href="../../index.html" title="Pineapple plugin projects">Pineapple plugin projects</a><span class="divider">/</span></li>
      <li class=""><a href="../index.html" title="Pineapple Git plugin">Pineapple Git plugin</a><span class="divider">/</span></li>
    <li class="active ">Usage</li>
        <li id="publishDate" class="pull-right">Last Published: 03 Mar 2019</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Project Overview</li>
    <li><a href="../../../index.html" title="Home"><span class="none"></span>Home</a></li>
    <li><a href="../../../usage/installation.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li><a href="../../../usage/index.html" title="For Users"><span class="none"></span>For Users</a></li>
    <li><a href="../../../development/index.html" title="For Developers"><span class="none"></span>For Developers</a></li>
    <li><a href="../../../usage/terms.html" title="Terms and Conditions"><span class="none"></span>Terms and Conditions</a></li>
      <li class="nav-header">Clients</li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-standalone-web-client/index.html" title="Standalone Web Application"><span class="none"></span>Standalone Web Application</a></li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/index.html" title="Deployable Web Application"><span class="none"></span>Deployable Web Application</a></li>
    <li><a href="../../../pineapple-applications/pineapple-maven-plugin/index.html" title="Maven Plugin"><span class="none"></span>Maven Plugin</a></li>
      <li class="nav-header">Plugins</li>
    <li><a href="../../../pineapple-plugins/pineapple-agent-plugin/index.html" title="Agent"><span class="none"></span>Agent</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-composite-execution-plugin/index.html" title="Composite Execution"><span class="none"></span>Composite Execution</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-ssh-plugin/index.html" title="SSH"><span class="none"></span>SSH</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-docker-plugin/index.html" title="Docker"><span class="none"></span>Docker</a></li>
    <li><a href="../../../pineapple-modules/pineapple-infrastructure-test-plugin/index.html" title="Infrastructure Test"><span class="none"></span>Infrastructure Test</a></li>
      <li class="nav-header">API's</li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/usage/rest.html" title="REST"><span class="none"></span>REST</a></li>
    <li><a href="../../../development/plugin-framework.html" title="Plugin Framework"><span class="none"></span>Plugin Framework</a></li>
      <li class="nav-header">Additional Information</li>
    <li><a href="http://pineapplesoftware.blogspot.com" class="externalLink" title="The Pineapple Project Blog"><span class="none"></span>The Pineapple Project Blog</a></li>
    <li><a href="http://exceptiontrail.blogspot.com" class="externalLink" title="Pineapple Exception Trail Blog"><span class="none"></span>Pineapple Exception Trail Blog</a></li>
      <li class="nav-header">Project Tools</li>
    <li><a href="https://bintray.com/pineapple/maven/com.alpha.pineapple" class="externalLink" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="https://github.com/athrane/pineapple" class="externalLink" title="Source Code"><span class="none"></span>Source Code</a></li>
    <li><a href="https://github.com/athrane/pineapple/issues" class="externalLink" title="Issue Tracker"><span class="none"></span>Issue Tracker</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
</ul>
          <hr />
          <div id="poweredBy">
    <script type="text/javascript">asyncJs( 'https://apis.google.com/js/plusone.js' )</script>
    <div class="g-plusone" data-href="https://pineapple.java.net" data-size="tall" ></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<div class="section">
<h2><a name="Introduction"></a>Introduction</h2>
<div class="section">
<h3><a name="Overview"></a>Overview</h3>
<div class="section">
<h4><a name="Invoking_the_plugin"></a>Invoking the plugin</h4>
<p>The plugin is invoked by when the core component is used by one of the Pineapple clients. To trigger invocation by the core component the plugin needs to be configured. </p></div>
<div class="section">
<h4><a name="Configuration"></a>Configuration</h4><img src="../images/configure-plugin.jpg" alt="" />
<p>Two steps are needed to configure the plugin:</p>
<ol style="list-style-type: decimal">
<li><a href="#Define_resource">Define resource:</a> Define resource which enables usage of the the plugin. The resource enables usage by:
<ul>
<li>Definition of connectivity information used by the Docker plugin to connect to the remote Docker daemon modeled by the resource.</li>
<li>Definition of a mapping between the resource ID (e.g. some user defined key referenced from models) and the plugin ID (e.g. the Java package name which implements the plugin: <tt>com.alpha.pineapple.plugin.git</tt>.</li></ul></li>
<li><a href="#Define_the_module_model">Define the module model</a> and add content to the model by defining a set of directives which are executed at the targeted resource(s). The directives are executed in sequence when the plugin is invoked with the model. The model is defined using the <a href="#The_docker_plugin_schema">The Docker plugin schema</a>.</li></ol>
<p>For more info about configuration of plugins:</p>
<ul>
<li>For info about <b>resources</b> and <b>credentials</b> read the <a href="../../../usage/configuration-environment.html">Environment configuration</a> document.</li>
<li>For info about <b>modules</b> and <b>module models</b> read the <a href="../../../usage/configuration-modules.html">Modules configuration</a> document.</li></ul></div>
<div class="section">
<h4><a name="Supported_operations_by_the_plugin"></a>Supported operations by the plugin </h4>
<p>The plugin supports the operations:</p>
<ul>
<li><b>test</b></li>
<li><b>create-report</b> </li>
<li><b>deploy-configuration</b> </li>
<li><b>undeploy-configuration</b> </li></ul>
<p>For more information about the default operations, refer to the <a href="../../../usage/operations.html">Operation and workflow reference.</a></p></div>
<div class="section">
<h4><a name="Execution_of_the_test_operation"></a>Execution of the test operation</h4>
<p>When invoked with this operation the plugin will traverse the module model and validate that the Docker entities (e.g. images and containers) defined in the model exists at the targeted Docker host:</p>
<ul>
<li><b>Container</b>: For each named container element defined in the model, the corresponding container is tested in the Docker host. If no container exist with designated name then the test case for the container fails. The <i>actual</i> runtime state of the container is validated against the <i>expected</i> runtime state defined in the model.</li></ul></div>
<div class="section">
<h4><a name="Execution_of_the_create-report_operation"></a>Execution of the create-report operation</h4>
<p>When invoked with this operation the plugin will ignore the module model, but create a report that lists all defined images and containers at the targeted Docker host.</p></div>
<div class="section">
<h4><a name="Execution_of_the_deploy-configuration_operation"></a>Execution of the deploy-configuration operation</h4>
<p>When invoked with this operation the plugin will traverse the module model and create all the Docker entities (e.g. images and containers) defined in the model:</p>
<ul>
<li><b>Container</b>: A named container is created from every container element defined in the model. If the container exists then the container creation is skipped and marked as successful - because the goal of ensuring existence of the named container is achieved. Since Docker doesn't support update of existing containers, then any existing container isn't updated to match the container configuration defined in the model.</li>
<li><b>Image</b>: An image is pulled for every image element defined in the model. If the image exists in the Docker host then the image creation is skipped and marked as successful - because the goal of ensuring availability of the image in the Docker host is achieved. The consequence is that the image isn't updated even if a newer version exists in the used repository.</li>
<li><b>Tagged image</b>: A tagged image is created for every tagged image element defined in the model. If the tagged image exists in the Docker host then the image tagging is skipped and marked as successful - because the goal of ensuring availability of the image in the Docker host is achieved. The consequence is that the image isn't updated even if a newer version of the source image exists in the used repository.</li>
<li><b>Image from Dockerfile</b>: An image is created for every image-from-Dockerfile element defined in the model. If the image exists in the Docker host then the image creation is skipped and marked as successful - because the goal of ensuring availability of the image in the Docker host is achieved. The consequence is that the image isn't updated even if the Dockerfile is updated or a newer version exists of the source image used by the Dockerfile.</li></ul>
<p>The result of this operation should be that the subsequent execution of the <b>test</b> operation should result in a 100% success (Otherwise you have found a bug in the plugin). </p></div>
<div class="section">
<h4><a name="Execution_of_the_undeploy-configuration_operation"></a>Execution of the undeploy-configuration operation</h4>
<p>When invoked with this operation the plugin will traverse the module model and delete all the Docker entities (e.g. images and containers) defined in the model at the target Docker host: </p>
<ul>
<li><b>Container</b>: For each named container element defined in the model, the corresponding container is deleted in the Docker host. If no container exist with designated name then the deletion is skipped and marked as successful - because the goal of ensuring that the named container doens't exist is achieved. If the targeted container is running then it stopped prior to deletion. If the targeted container is paused, then it is unpaused (i.e. started) and then stopped prior to deletion. </li>
<li><b>Image</b>: For each image element defined in the model, the corresponding image is deleted in the Docker host. If no image exist with designated name then the deletion is skipped and marked as successful - because the goal of ensuring that the image doens't exist is achieved. If one or more containers exists, which are based on the image targeted for deletion, then the deletion fails.</li>
<li><b>Tagged image</b>: Same semantics as supported for image.</li>
<li><b>Image from Dockerfile</b>: Same semantics as supported for image.</li></ul>
<p>The result of this operation should be that the subsequent execution of the <b>test</b> operation should result in a lot of failures since none of the resources should exist. </p></div></div>
<div class="section">
<h3><a name="Define_resource">Define resource</a></h3>
<p>The purpose of defining a resource for this plugin is twofold:</p>
<ul>
<li>Define a mapping between the resource ID and the plugin ID. The resource ID is the user defined key which is referenced from module models which are targeting the resource. The plugin ID is the Java package name which implements the plugin: <tt>com.alpha.pineapple.plugin.git</tt>.</li>
<li>Define connectivity information used by the Docker plugin to connect to the remote Docker daemon.</li></ul>
<p>To define a new resource, add a <tt>resource</tt> element to the target environment in the configuration file <tt>${pineapple.home.dir}/conf/resources.xml</tt>:</p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration xmlns=&quot;http://pineapple.dev.java.net/ns/environment_1_0&quot; 
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
  
  &lt;environments&gt;
    &lt;environment id=&quot;linux-vagrant&quot; &gt;
      &lt;resources&gt;
        &lt;resource id=&quot;git-node&quot; plugin-id=&quot;com.alpha.pineapple.plugin.git&quot; /&gt;
          &lt;property value=&quot;192.168.34.10&quot; key=&quot;host&quot;/&gt;
          &lt;property value=&quot;8082&quot; key=&quot;port&quot;/&gt;                   
          &lt;property value=&quot;1000&quot; key=&quot;timeout&quot;/&gt;                                                                
        &lt;/resource&gt;
      &lt;/resources&gt;
    &lt;/environment&gt;                                                              
  &lt;/environments&gt;
&lt;/configuration&gt;        
</pre></div>
<p>For all the details about configuration of environments and resources, please visit the <a href="../../../usage/configuration-environment.html">Environment Configuration Reference</a>. </p>
<p>The semantics of the resource element is:</p>
<div class="section">
<h4><a name="The_id_attribute"></a>The <tt>id</tt> attribute</h4>
<p>Identifies the resource uniquely in the current environment. This ID is referenced from models which intends to use the plugin. </p></div>
<div class="section">
<h4><a name="The_plugin-id_element"></a>The <tt>plugin-id</tt> element</h4>
<p>The plugin ID defines the name of the Java package which implements the plugin. The plugin ID for this plugin is: <tt>com.alpha.pineapple.plugin.git</tt>.</p></div>
<div class="section">
<h4><a name="The_property_attributes.28s.29"></a>The <tt>property</tt> attributes(s)</h4>
<p>Mandatory properties used by the plugin:</p>
<ul>
<li><tt>host</tt> - Host name of the remote Docker daemon whose REST services are invoked to execute commands.</li>
<li><tt>port</tt> - Port number on the remote Docker daemon.</li>
<li><tt>timeout</tt> - Connection timeout in milli seconds.</li></ul></div></div>
<div class="section">
<h3><a name="Define_the_module_model">Define the module model</a></h3><img src="../images/module-directory-layout.jpg" alt="" />
<p>A <b><a href="../../../usage/configuration-modules.html">module</a></b> defines the input used by Pineapple to execute operations. A module is defined by a directory layout. Part of a module is the <b>model(s)</b> which defines what happens when the module is invoked. A model is put together by one or more sub models from different plugins. Each plugin defines its own schema for its particular model </p>
<div class="section">
<h4><a name="The_Git_plugin_schema">The Git plugin schema</a> </h4>
<p>This plugin defines a schema named <b>The Git plugin schema</b> which defines the <tt>http://pineapple.dev.java.net/ns/plugin/git_1_0</tt> namespace. For more information about where the schema can be found, refer to the <a href="../../../usage/schemas-plugins.html">Schema locations for plugins page.</a> </p></div>
<div class="section">
<h4><a name="Name_and_location_of_the_the_module_model_file"></a>Name and location of the the module model file </h4>
<p>The list of commands which should be executed when the plugin is invoked are defined in the module model files which are located at <tt>${module-dir}/models/${environment}.xml</tt> where:</p>
<ul>
<li><tt>${module-dir}</tt> is the module root directory which identifies the module with a unique name and version. </li>
<li><tt>${environment}.xml</tt> is a module model file for a target environment, with <tt>${environment}</tt> substituted with the environment name, e.g. <tt>linux-vagrant.xml</tt> for an environment named <tt>linux-vagrant</tt>. </li></ul>
<p>If the model file doesn't exist for an environment where the agent should be used, then create the model file and name it after the target environment, e.g. <tt>linux-vagrant.xml</tt> for an environment named <tt>linux-vagrant</tt>.</p></div>
<div class="section">
<h4><a name="The_module_model_configuration_schema"></a>The module model configuration schema</h4>
<p>Module model files are defined using the <b>module model configuration schema</b> which defines the <tt>http://pineapple.dev.java.net/ns/module_model_1_0</tt> namespace. Since module model files contain elements from multiple namespace all the elements and attributes should be qualified. The header and root element should be defined as (look in the <a href="../../../usage/configuration-modules.html">Modules configuration</a> document for more details):</p>
<p>This example shows definition of the minimal model file for <tt>linux-vagrant</tt>: </p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;mmd:models xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xmlns:mmd=&quot;http://pineapple.dev.java.net/ns/module_model_1_0&quot; /&gt;
</pre></div></div>
<div class="section">
<h4><a name="Adding_the_plugin_schema_to_the_model"></a>Adding the plugin schema to the model</h4>
<p>The next step is to include the <a href="#The_docker_plugin_schema">The Docker plugin schema</a> to get access to the entities defined by the schema:</p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;mmd:models xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xmlns:mmd=&quot;http://pineapple.dev.java.net/ns/module_model_1_0&quot;                 
  xmlns:gp=&quot;http://pineapple.dev.java.net/ns/plugin/git_1_0&quot; /&gt;
</pre></div>
<p>Now we have a minimal module model file with three namespaces:</p>
<ul>
<li><b>xs:</b> The basic XMLSchema schema which is only used in the root element of the document.</li>
<li><b>mmd:</b> The module model schema which is used to define the skeleton of a model file.</li>
<li><b>gp:</b> The Git plugin schema which is used to define Git resources.</li></ul></div>
<div class="section">
<h4><a name="Defining_the_model_which_targets_resources"></a>Defining the model which targets resources</h4>
<p>Add a new <tt>model</tt> stanza with a <tt>target-resource</tt> attribute. The value of the <tt>target-resource</tt> should match the id of the resource which was defined previously in the section <a href="#Define_resource">Define resource</a>, e.g. <tt>git-node</tt>:</p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;mmd:models xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xmlns:mmd=&quot;http://pineapple.dev.java.net/ns/module_model_1_0&quot;                 
  xmlns:gp=&quot;http://pineapple.dev.java.net/ns/plugin/git_1_0&quot; /&gt;
  
  &lt;mmd:model target-resource=&quot;git-node&quot;&gt;                
    &lt;mmd:content /&gt;                             
  &lt;/mmd:model&gt;
&lt;/mmd:models&gt;    
</pre></div>
<p>Add content to the model which uses the plugin through the <tt>git-node</tt> reference:</p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;mmd:models xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xmlns:mmd=&quot;http://pineapple.dev.java.net/ns/module_model_1_0&quot;                 
  xmlns:gp=&quot;http://pineapple.dev.java.net/ns/plugin/git_1_0&quot; /&gt;
  
  &lt;mmd:model target-resource=&quot;git-node&quot;&gt;                
    &lt;mmd:content&gt;
      &lt;gp:docker&gt;
      &lt;/gp:docker&gt;                      
    &lt;/mmd:content&gt;                                                                                                                                                                              
  &lt;/mmd:model&gt;
&lt;/mmd:models&gt;    
</pre></div></div></div>
<div class="section">
<h3><a name="Define_Git_entities_the_module_model">Define Git entities the module model</a> </h3>
<p>Define a sequence of entities which should be processed when Pineapple is invoked with the model:</p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;mmd:models xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xmlns:mmd=&quot;http://pineapple.dev.java.net/ns/module_model_1_0&quot;                 
  xmlns:gp=&quot;http://pineapple.dev.java.net/ns/plugin/git_1_0&quot; /&gt;
  
  &lt;mmd:model target-resource=&quot;git-node&quot;&gt;                
    &lt;mmd:content&gt;
      &lt;gp:git&gt;
        &lt;gp:clone uri=&quot;athrane/pineapple&quot; branch=&quot;HEAD&quot; destination=&quot;...&quot; /&gt;
      &lt;/gp:git&gt;                 
    &lt;/mmd:content&gt;
  &lt;/mmd:model&gt;
&lt;/mmd:models&gt;    
</pre></div>
<div class="section">
<h4><a name="Clone_repository"></a>Clone repository</h4>
<p>Clones a remote Git repository. A clone operation is defined through a Git clone tag:</p>
<div class="source"><pre class="prettyprint linenums">  &lt;gp:clone uri=&quot;athrane/pineapple&quot; branch=&quot;HEAD&quot; destination=&quot;...&quot;  /&gt;
</pre></div>
<p>Operation semantics:</p>
<ul>
<li><b>deploy-configuration</b>: Clone remote repository. The image is created by pulling it from the used registry. If an image already exists in the Docker host then the image creation is skipped and marked as successful, the consequence is that the image isn't updated even if a newer version exists at the used repository.</li>
<li><b>undeploy-configuration</b>: Delete Docker image. If no image exist with designated name then the deletion is skipped and marked as successful. If one or more containers exists, which are based on the image targeted for deletion, then the deletion fails.</li>
<li><b>create-report</b>: Creates report which lists ....</li>
<li><b>test</b>: Test the local repository is identical to the remote repository. []</li></ul>
<p>The semantics of the attributes are:</p>
<div class="section">
<h5><a name="uri_attribute"></a><tt>uri</tt> attribute </h5>
<p>Mandatory attribute. Defines the remote repository which is cloned.</p>
<p>Example of official repository name is <i>ubuntu</i> which holds Ubuntu images.</p></div>
<div class="section">
<h5><a name="branch_attribute"></a><tt>branch</tt> attribute </h5>
<p>Optional attribute. Defines the image tag. Default value is <i>HEAD</i>.</p>
<p>Example of image tags are: HEAD and 12.10.</p></div>
<div class="section">
<h5><a name="destination_attribute"></a><tt>destination</tt> attribute </h5>
<p>Mandatory attribute. Defines the local destination where the cloned repository is stored.</p>
<p>Example of official repository name is <i>ubuntu</i> which holds Ubuntu images.</p></div></div>
<div class="section">
<h4><a name="Log"></a>Log</h4>
<p>TODO: write....</p></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
Copyright (C) 2007-2017 Allan Thrane Andersen. All Rights Reserved.
        </div>
      </div>
    </footer>
  </body>
</html>

<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 12 Sep 2018
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Allan Thrane Andersen" />
    <meta name="Date-Revision-yyyymmdd" content="20180912" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Pineapple Project - Pineapple Continuous Integration</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

    
              <!-- Google Analytics -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28287414-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Pineapple Project</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="../index.html" title="Pineapple Home">
        Pineapple Home</a>
        </li>
      <li class="divider ">/</li>
        <li class="">Pineapple Continuous Integration</li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 12 Sep 2018</li> 
            
                            </ul>
      </div>

                  
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Project Overview</li>
                                
      <li>
    
                          <a href="../index.html" title="Home">
          <i class="none"></i>
        Home</a>
            </li>
                  
      <li>
    
                          <a href="../usage/installation.html" title="Installation">
          <i class="none"></i>
        Installation</a>
            </li>
                  
      <li>
    
                          <a href="../usage/index.html" title="For Users">
          <i class="none"></i>
        For Users</a>
            </li>
                  
      <li>
    
                          <a href="../development/index.html" title="For Developers">
          <i class="none"></i>
        For Developers</a>
            </li>
                  
      <li>
    
                          <a href="../usage/terms.html" title="Terms and Conditions">
          <i class="none"></i>
        Terms and Conditions</a>
            </li>
                              <li class="nav-header">Clients</li>
                                
      <li>
    
                          <a href="../pineapple-applications/pineapple-web-application/pineapple-standalone-web-client/index.html" title="Standalone Web Application">
          <i class="none"></i>
        Standalone Web Application</a>
            </li>
                  
      <li>
    
                          <a href="../pineapple-applications/pineapple-web-application/pineapple-web-application-war/index.html" title="Deployable Web Application">
          <i class="none"></i>
        Deployable Web Application</a>
            </li>
                  
      <li>
    
                          <a href="../pineapple-applications/pineapple-maven-plugin/index.html" title="Maven Plugin">
          <i class="none"></i>
        Maven Plugin</a>
            </li>
                              <li class="nav-header">Plugins</li>
                                
      <li>
    
                          <a href="../pineapple-plugins/pineapple-agent-plugin/index.html" title="Agent">
          <i class="none"></i>
        Agent</a>
            </li>
                  
      <li>
    
                          <a href="../pineapple-plugins/pineapple-composite-execution-plugin/index.html" title="Composite Execution">
          <i class="none"></i>
        Composite Execution</a>
            </li>
                  
      <li>
    
                          <a href="../pineapple-plugins/pineapple-ssh-plugin/index.html" title="SSH">
          <i class="none"></i>
        SSH</a>
            </li>
                  
      <li>
    
                          <a href="../pineapple-plugins/pineapple-docker-plugin/index.html" title="Docker">
          <i class="none"></i>
        Docker</a>
            </li>
                  
      <li>
    
                          <a href="../pineapple-modules/pineapple-infrastructure-test-plugin/index.html" title="Infrastructure Test">
          <i class="none"></i>
        Infrastructure Test</a>
            </li>
                              <li class="nav-header">API's</li>
                                
      <li>
    
                          <a href="../pineapple-applications/pineapple-web-application/pineapple-web-application-war/usage/rest.html" title="REST">
          <i class="none"></i>
        REST</a>
            </li>
                  
      <li>
    
                          <a href="../development/plugin-framework.html" title="Plugin Framework">
          <i class="none"></i>
        Plugin Framework</a>
            </li>
                              <li class="nav-header">Additional Information</li>
                                
      <li>
    
                          <a href="http://pineapplesoftware.blogspot.com" class="externalLink" title="The Pineapple Project Blog">
          <i class="none"></i>
        The Pineapple Project Blog</a>
            </li>
                  
      <li>
    
                          <a href="http://exceptiontrail.blogspot.com" class="externalLink" title="Pineapple Exception Trail Blog">
          <i class="none"></i>
        Pineapple Exception Trail Blog</a>
            </li>
                              <li class="nav-header">Project Tools</li>
                                
      <li>
    
                          <a href="https://bintray.com/pineapple/maven/com.alpha.pineapple" class="externalLink" title="Downloads">
          <i class="none"></i>
        Downloads</a>
            </li>
                  
      <li>
    
                          <a href="https://github.com/athrane/pineapple" class="externalLink" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
                  
      <li>
    
                          <a href="https://github.com/athrane/pineapple/issues" class="externalLink" title="Issue Tracker">
          <i class="none"></i>
        Issue Tracker</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                        
      <li>
    
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="https://athrane.github.io/pineapple/" data-size="tall" ></div>

                   <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                        
        <div id="bodyColumn"  class="span10" >
                                  
            <!-- NOTE: For help with the syntax of this file, see: --><!-- http://maven.apache.org/guides/mini/guide-apt-format.html --><div class="section">
<h2>Pineapple Continuous Integration<a name="Pineapple_Continuous_Integration"></a></h2>
<p>This page describes the design of the test infrastructure and continuous integration setup used to test the Pineapple project.</p>
<div class="section">
<h3>Used Components<a name="Used_Components"></a></h3>
<p>The continuous integration setup for Pineapple consists of the components:</p>
<ul>
<li><b>JUnit</b> will be used as test framework. At some point, it must be determined whether JUnit is suitable for implementation of larger scale system tests which involves multiple servers, Pineapple instances, agents and plugins.</li>
<li><b>Jenkins</b> is used as continuous integration server.</li>
<li><b>Artifactory</b> is used as a repository manager for management of binary artifacts.</li>
<li><b>VirtualBox</b> is used to provide virtualized servers to conduct tests on. VirtualBox is chosen due to its integration with Vagrant.</li>
<li><b>Vagrant</b> is used to provision virtual server instances.</li>
<li><b>Docker</b> is used to provision Docker containers within virtual server instances.</li>
<li><b>Pineapple</b> is used to build the setup.</li></ul></div>
<div class="section">
<h3>Setup<a name="Setup"></a></h3>
<p>The setup consists of a host machine where VirtualBox, Vagrant and Pineapple are installed. VirtualBox is used as hypervisor. Vargrant is used to define and managed virtual machines. Pineapple is used to do the initial build of the build the setup.</p><img src="../images/pineapple-ci-server.png" alt="" />
<div class="section">
<h4>Virtual machines <a name="Virtual_machines"></a></h4>
<p>Two virtual machines are hosted on VirtualBox: </p>
<ul>
<li>The build server VM</li>
<li>The test containers VM</li></ul></div>
<div class="section">
<h4>The build server VM <a name="The_build_server_VM"></a></h4>
<p>The purpose of the VM is to run a Docker host which contains Docker containers with the CI tools, e.g. Jenkins and Artifactory. The tools are setup through the creation of these Docker images:</p>
<ul>
<li>The CI container (named &quot;ci&quot;) based on the official Jenkins Docker image. These software components and tools are installed on the &quot;ci&quot; container:
<ul>
<li>Java Virtual Machine (JDK). </li>
<li>Continuous integration server (Jenkins). </li>
<li>Maven. </li></ul></li>
<li>The repository container (named &quot;repo&quot;) based on the official Artifactory Docker image.</li></ul></div>
<div class="section">
<h4>The test containers VM <a name="The_test_containers_VM"></a></h4>
<p>The purpose of the VM is to run a Docker host which contains Docker containers created by individual test cases and to allow for easy clean up of dangling container used by test cases. </p></div></div>
<div class="section">
<h3>Pineapple module and environment configuration<a name="Pineapple_module_and_environment_configuration"></a></h3>
<div class="section">
<h4>Module<a name="Module"></a></h4>
<p>The setup is defined in the example module named <i>xx-pineapple-dev-docker-install-ci-linux64</i>. The module creates the setup through these steps:</p>
<ul>
<li>Installs Docker on both VMs</li>
<li>Installs Artifactory on the build server VM</li>
<li>Installs Jenkins on the build server VM</li>
<li>Initializes Artifactory by uploading the system configuration and 3rd party artifacts.</li></ul></div>
<div class="section">
<h4>Environment configuration<a name="Environment_configuration"></a></h4>
<p>The environment used to install the setup is named <i>linux-pineapple-ci</i>.</p>
<p>The environment contains the definition of the resources:</p>
<ul>
<li><tt>ssh-ci-node1</tt> which defines SSH access to the build server VM at 192.168.99.10:22</li>
<li><tt>ssh-ci-node2</tt> which defines SSH access to the test containers VM at 192.168.99.11:22</li>
<li><tt>docker-ci-node1</tt> which defines access to the Docker host at the build server VM at 192.168.99.10:8082</li>
<li><tt>docker-ci-node2</tt> which defines access to the Docker host at the build server VM at 192.168.99.11:8082</li></ul>
<p>The environment, resources and credentials are created as part of the default configuration. </p></div></div>
<div class="section">
<h3>Build server VM configuration <a name="Build_server_VM_configuration"></a></h3>
<div class="section">
<h4>Operating System<a name="Operating_System"></a></h4>
<p>CentOS 7.1 is used as operating system.</p></div>
<div class="section">
<h4>Memory<a name="Memory"></a></h4>
<p>The VM is configured with 2048 MB.</p></div>
<div class="section">
<h4>CPU <a name="CPU"></a></h4>
<p>The VM is configured with 2x CPUs.</p></div>
<div class="section">
<h4>Network<a name="Network"></a></h4>
<p>A VirtualBox host-only network is configured with IP address: 192.168.99.10</p></div>
<div class="section">
<h4>Services<a name="Services"></a></h4>
<p>The SSH daemon is started and listens on 0.0.0.0:22.</p>
<p>The Docker daemon is running on 0.0.0.0:8082.</p></div>
<div class="section">
<h4>Users <a name="Users"></a></h4>
<p>The user <tt>vagrant</tt> exists and have privileges for SUDO without the requirement for entering the password. This is the default Vagrant user and it is used out of convenience. </p></div>
<div class="section">
<h4>Shared Folders<a name="Shared_Folders"></a></h4>
<p>The shared standard shared folder configured by vagrant <tt>/vagrant</tt> is configured.</p></div></div>
<div class="section">
<h3>Test containers VM configuration <a name="Test_containers_VM_configuration"></a></h3>
<div class="section">
<h4>Operating System<a name="Operating_System"></a></h4>
<p>CentOS 7.1 is used as operating system.</p></div>
<div class="section">
<h4>Memory<a name="Memory"></a></h4>
<p>The VM is configured with 2048 MB.</p></div>
<div class="section">
<h4>CPU <a name="CPU"></a></h4>
<p>The VM is configured with 2x CPUs.</p></div>
<div class="section">
<h4>Network<a name="Network"></a></h4>
<p>A VirtualBox host-only network is configured with IP address: 192.168.99.11</p></div>
<div class="section">
<h4>Services<a name="Services"></a></h4>
<p>The SSH daemon is started and listens on 0.0.0.0:22.</p>
<p>The Docker daemon is running on 0.0.0.0:8082.</p></div>
<div class="section">
<h4>Users <a name="Users"></a></h4>
<p>The user <tt>vagrant</tt> exists and have privileges for SUDO without the requirement for entering the password. This is the default Vagrant user and it is used out of convenience. </p></div>
<div class="section">
<h4>Shared Folders<a name="Shared_Folders"></a></h4>
<p>The shared standard shared folder configured by vagrant <tt>/vagrant</tt> is configured.</p></div></div>
<div class="section">
<h3>Build server software components<a name="Build_server_software_components"></a></h3>
<div class="section">
<h4>Docker<a name="Docker"></a></h4>
<p>Docker is installed as an OS service.</p>
<p>Docker listens on http://192.168.99.10:8082</p>
<div class="section">
<h5>Docker installation<a name="Docker_installation"></a></h5>
<p>The installation consists of these steps:</p>
<ul>
<li><b>Create Docker user</b>. A custom docker user is created and added to the sudoers file.</li>
<li><b>Update YUM</b>. Update YUM packages.</li>
<li><b>Add Docker YUM repository</b>. Configure the Docker YUM repository with YUM.</li>
<li><b>Install Docker</b>. Docker is installed as a systemctrl service. The Docker daemon is configured using the configuration file <tt>etc/docker/daemon.json</tt> which defines the API to listen on <tt>/var/run/docker.sock/</tt> and <tt>[::]:8082</tt>. </li>
<li>The installation is validated.</li></ul>
<p>Docker is configured to:</p>
<ul>
<li>Listen for local connections by the <tt>root</tt> user.</li>
<li>Listen on 0.0.0.0:8082 to support remote usage of the REST API.</li></ul>
<p>The Docker daemon configuration file <tt>daemon.json</tt> is installed in <tt>/etc/docker/daemon.json</tt>. The file configures the daemon to:</p>
<ul>
<li>Listen for local connections by the <tt>root</tt> user.</li>
<li>Listen on 0.0.0.0:8082 to support remote usage of the REST API.</li></ul>
<p>The file contains:</p>
<div class="source">
<pre>{
        &quot;hosts&quot;: [ &quot;unix:///var/run/docker.sock&quot;,
        &quot;tcp://0.0.0.0:8082&quot; ]  
}
</pre></div></div></div></div>
<div class="section">
<h3>Build server Docker images <a name="Build_server_Docker_images"></a></h3>
<div class="section">
<h4>CI container (&quot;ci&quot;)<a name="CI_container_ci"></a></h4>
<div class="section">
<h5>Docker image <a name="Docker_image"></a></h5>
<p>The image for the CI container is based on the official Jenkins Docker image.</p>
<p>The Jenkins image is extended to support configuration of Jenkins with the Pineapple configurations and build jobs. The extension is implemented through definition of a new docker image named <tt>pineapple/ci:1.0</tt>. The dockerfile for the CI container is located in <i>xx-pineapple-dev-docker-install-ci-linux64/dockersrc/ci</i></p>
<p>The dockerfile copies the Jenkins configuration files to the Jenkins staging directory <tt>/usr/share/jenkins/ref/</tt>. When <tt>jenkins.sh</tt> is run (as part of starting a container) then the files are copied to the <tt>/var/jenkins_home</tt> volume used by the jenkins container.</p></div>
<div class="section">
<h5>Docker container <a name="Docker_container"></a></h5>
<p>The CI container is named &quot;ci&quot;.</p>
<p>The CI container defines a network link to the &quot;repo&quot; container: <tt>repo:repository</tt> while defining the DNS name <tt>repository</tt> internally in the CI container. The DNS name is used in the <tt>settings.xml</tt> to access the different repositories.</p></div>
<div class="section">
<h5>JVM<a name="JVM"></a></h5>
<p>The Jenkins image inherits from the <tt>java:8-jdk</tt> docker image which installs the OpenJDK 1.8.0 JDK.</p>
<p>The JDK is installed to allow it to be used by Jenkins for compilation in build jobs. Alternately The Oracle JDK could be used, but it requires a valid Oracle account with user name/password. </p>
<p>JAVA_HOME for this image is <tt>/usr/lib/jvm/java-8-oracle</tt>.</p></div>
<div class="section">
<h5>Jenkins JVM configuration <a name="Jenkins_JVM_configuration"></a></h5>
<p>The main Jenkins configuration file is <tt>/var/jenkins_home/config.xml</tt> is used to define the path to the JDK used for compiling build jobs:</p>
<div class="source">
<pre>  ...
  &lt;jdks&gt;
    &lt;jdk&gt;
      &lt;name&gt;java-1.8.0-openjdk&lt;/name&gt;
      &lt;home&gt;/usr/lib/jvm/java-1.8.0-openjdk-amd64&lt;/home&gt;
      &lt;properties/&gt;
    &lt;/jdk&gt;
  &lt;/jdks&gt;
  ...
</pre></div></div>
<div class="section">
<h5>Jenkins Maven configuration<a name="Jenkins_Maven_configuration"></a></h5>
<p>The Jenkins Maven configuration file <tt>/var/jenkins_home/hudson.tasks.Maven.xml</tt> is used to define the version of Maven to be installed and used by Jenkins for build jobs: </p>
<div class="source">
<pre>&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;hudson.tasks.Maven_-DescriptorImpl&gt;
  &lt;installations&gt;
    &lt;hudson.tasks.Maven_-MavenInstallation&gt;
      &lt;name&gt;maven-3.1.1&lt;/name&gt;
      &lt;properties&gt;
        &lt;hudson.tools.InstallSourceProperty&gt;
          &lt;installers&gt;
            &lt;hudson.tasks.Maven_-MavenInstaller&gt;
              &lt;id&gt;3.1.1&lt;/id&gt;
            &lt;/hudson.tasks.Maven_-MavenInstaller&gt;
          &lt;/installers&gt;
        &lt;/hudson.tools.InstallSourceProperty&gt;
      &lt;/properties&gt;
    &lt;/hudson.tasks.Maven_-MavenInstallation&gt;
  &lt;/installations&gt;
&lt;/hudson.tasks.Maven_-DescriptorImpl&gt;
</pre></div></div>
<div class="section">
<h5>Maven configuration<a name="Maven_configuration"></a></h5>
<p>The standard Maven configuration file <tt>/var/jenkins_home/settings.xml</tt> is used to define the repositories used by Maven to resolve dependencies. The configuration file can be generated by exporting it from Artifactory. </p>
<p>The Maven configuration file is referenced by build jobs:</p>
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;settings xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.1.0 http://maven.apache.org/xsd/settings-1.1.0.xsd&quot; xmlns=&quot;http://maven.apache.org/SETTINGS/1.1.0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
  &lt;servers&gt;
    &lt;server&gt;
      &lt;username&gt;admin&lt;/username&gt;
      &lt;id&gt;central&lt;/id&gt;
    &lt;/server&gt;
    &lt;server&gt;
      &lt;username&gt;admin&lt;/username&gt;
      &lt;id&gt;snapshots&lt;/id&gt;
    &lt;/server&gt;
  &lt;/servers&gt;
  &lt;mirrors&gt;
    &lt;mirror&gt;
      &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
      &lt;name&gt;repo&lt;/name&gt;
      &lt;url&gt;http://repository:8081/artifactory/repo&lt;/url&gt;
      &lt;id&gt;repo&lt;/id&gt;
    &lt;/mirror&gt;
  &lt;/mirrors&gt;
  &lt;profiles&gt;
    &lt;profile&gt;
      &lt;repositories&gt;
        &lt;repository&gt;
          &lt;snapshots&gt;
            &lt;enabled&gt;false&lt;/enabled&gt;
          &lt;/snapshots&gt;
          &lt;id&gt;central&lt;/id&gt;
          &lt;name&gt;libs-release&lt;/name&gt;
          &lt;url&gt;http://repository:8081/artifactory/libs-release&lt;/url&gt;
        &lt;/repository&gt;
        &lt;repository&gt;
          &lt;snapshots /&gt;
          &lt;id&gt;snapshots&lt;/id&gt;
          &lt;name&gt;libs-snapshot&lt;/name&gt;
          &lt;url&gt;http://repository:8081/artifactory/libs-snapshot&lt;/url&gt;
        &lt;/repository&gt;
      &lt;/repositories&gt;
      &lt;pluginRepositories&gt;
        &lt;pluginRepository&gt;
          &lt;snapshots&gt;
            &lt;enabled&gt;false&lt;/enabled&gt;
          &lt;/snapshots&gt;
          &lt;id&gt;central&lt;/id&gt;
          &lt;name&gt;plugins-release&lt;/name&gt;
          &lt;url&gt;http://repository:8081/artifactory/plugins-release&lt;/url&gt;
        &lt;/pluginRepository&gt;
        &lt;pluginRepository&gt;
          &lt;snapshots /&gt;
          &lt;id&gt;snapshots&lt;/id&gt;
          &lt;name&gt;plugins-snapshot&lt;/name&gt;
          &lt;url&gt;http://repository:8081/artifactory/plugins-snapshot&lt;/url&gt;
        &lt;/pluginRepository&gt;
      &lt;/pluginRepositories&gt;
      &lt;id&gt;artifactory&lt;/id&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
  &lt;activeProfiles&gt;
    &lt;activeProfile&gt;artifactory&lt;/activeProfile&gt;
  &lt;/activeProfiles&gt;
&lt;/settings&gt;
</pre></div>
<p>Please notice that the repository is referenced throught the usage of the DNS name <tt>repository</tt> This name is made available to the CI container through network linking when the CI container is created. </p></div>
<div class="section">
<h5>Jenkins build jobs<a name="Jenkins_build_jobs"></a></h5>
<p>Jenkins is configured with these build jobs:</p>
<ul>
<li><i>pineapple-build</i> which builds Pineapple from trunk using the maven commands: <tt>-U clean install -P SkipTests</tt>. Unit tests are disabled through the usage of the <tt>SkipTests</tt> Maven profile. Furthermore, the build is configured to use the Maven configuration file <tt>/var/jenkins_home/settings.xml</tt> </li>
<li><i>pineapple-build-test</i> which builds Pineapple from trunk using the maven commands: <tt>-U clean install -P DoTests</tt>.. Unit tests are enabled through the usage of the <tt>DoTests</tt> Maven profile. Furthermore, the build is configured to use the Maven configuration file <tt>/var/jenkins_home/settings.xml</tt> </li></ul></div>
<div class="section">
<h5>Network access<a name="Network_access"></a></h5>
<p>The Jenkins image exposes TCP port 8080. The CI container binds the port to the Docker host (with no port re-mapping)</p>
<p>Jenkins can be accessed on http://192.168.99.10:8080 </p></div></div>
<div class="section">
<h4>Repository container (&quot;repo&quot;)<a name="Repository_container_repo"></a></h4>
<div class="section">
<h5>Docker image <a name="Docker_image"></a></h5>
<p>The image for the repository container is based on the official Artifactory OSS Docker image. The extension is implemented through definition of a new docker image named <tt>pineapple/repo:1.0</tt>. The dockerfile for the CI container is located in <i>xx-pineapple-dev-docker-install-ci-linux64/dockersrc/repo</i></p>
<p>The image defines the recommended volumes:</p>
<ul>
<li><tt>/artifactory/data</tt></li>
<li><tt>/artifactory/logs</tt></li>
<li><tt>/artifactory/backup</tt></li>
<li><tt>/artifactory/etc</tt></li></ul></div>
<div class="section">
<h5>Docker container <a name="Docker_container"></a></h5>
<p>The repository container is named &quot;repo&quot;.</p></div>
<div class="section">
<h5>Artifactory configuration<a name="Artifactory_configuration"></a></h5>
<p>When the container is started, then the web service <tt>/artifactory/api/system/configuration</tt> is invoked with HTTP GET to trigger initialization of Artifactory.</p>
<p>After the initialization is completed, the web service <tt>/artifactory/api/system/configuration</tt> is invoked with HTTP POST to install the Artifactory system configuration from the file <tt>artifactory.config.xml</tt>: </p>
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;config xmlns=&quot;http://artifactory.jfrog.org/xsd/1.5.3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.jfrog.org/xsd/artifactory-v1_5_3.xsd&quot;&gt;
    &lt;offlineMode&gt;false&lt;/offlineMode&gt;

    ... 

    &lt;localRepository&gt;
        &lt;key&gt;ext-release-local&lt;/key&gt;
        &lt;description&gt;Local repository for third party libraries&lt;/description&gt;
        &lt;includesPattern&gt;**/*&lt;/includesPattern&gt;
        &lt;repoLayoutRef&gt;maven-2-default&lt;/repoLayoutRef&gt;
        &lt;enableNuGetSupport&gt;false&lt;/enableNuGetSupport&gt;
        &lt;enableGemsSupport&gt;false&lt;/enableGemsSupport&gt;
        &lt;blackedOut&gt;false&lt;/blackedOut&gt;
        &lt;handleReleases&gt;true&lt;/handleReleases&gt;
        &lt;handleSnapshots&gt;false&lt;/handleSnapshots&gt;
        &lt;maxUniqueSnapshots&gt;0&lt;/maxUniqueSnapshots&gt;
        &lt;suppressPomConsistencyChecks&gt;false&lt;/suppressPomConsistencyChecks&gt;
        &lt;propertySets/&gt;
        &lt;archiveBrowsingEnabled&gt;false&lt;/archiveBrowsingEnabled&gt;
        &lt;snapshotVersionBehavior&gt;unique&lt;/snapshotVersionBehavior&gt;
        &lt;localRepoChecksumPolicyType&gt;client-checksums&lt;/localRepoChecksumPolicyType&gt;
        &lt;calculateYumMetadata&gt;false&lt;/calculateYumMetadata&gt;
        &lt;yumRootDepth&gt;0&lt;/yumRootDepth&gt;
    &lt;/localRepository&gt;

    ... 
    
    &lt;remoteRepositories&gt;
        &lt;remoteRepository&gt;
            &lt;key&gt;zk-ce&lt;/key&gt;
            &lt;description&gt;ZK CE repository&lt;/description&gt;
            &lt;includesPattern&gt;**/*&lt;/includesPattern&gt;
            &lt;repoLayoutRef&gt;maven-2-default&lt;/repoLayoutRef&gt;
            &lt;enableNuGetSupport&gt;false&lt;/enableNuGetSupport&gt;
            &lt;enableGemsSupport&gt;false&lt;/enableGemsSupport&gt;
            &lt;blackedOut&gt;false&lt;/blackedOut&gt;
            &lt;handleReleases&gt;true&lt;/handleReleases&gt;
            &lt;handleSnapshots&gt;true&lt;/handleSnapshots&gt;
            &lt;maxUniqueSnapshots&gt;0&lt;/maxUniqueSnapshots&gt;
            &lt;suppressPomConsistencyChecks&gt;false&lt;/suppressPomConsistencyChecks&gt;
            &lt;propertySets/&gt;
            &lt;archiveBrowsingEnabled&gt;false&lt;/archiveBrowsingEnabled&gt;
            &lt;url&gt;http://mavensync.zkoss.org/maven2&lt;/url&gt;
            &lt;offline&gt;false&lt;/offline&gt;
            &lt;hardFail&gt;false&lt;/hardFail&gt;
            &lt;storeArtifactsLocally&gt;true&lt;/storeArtifactsLocally&gt;
            &lt;fetchJarsEagerly&gt;false&lt;/fetchJarsEagerly&gt;
            &lt;fetchSourcesEagerly&gt;false&lt;/fetchSourcesEagerly&gt;
            &lt;retrievalCachePeriodSecs&gt;43200&lt;/retrievalCachePeriodSecs&gt;
            &lt;assumedOfflinePeriodSecs&gt;300&lt;/assumedOfflinePeriodSecs&gt;
            &lt;missedRetrievalCachePeriodSecs&gt;7200&lt;/missedRetrievalCachePeriodSecs&gt;
            &lt;remoteRepoChecksumPolicyType&gt;generate-if-absent&lt;/remoteRepoChecksumPolicyType&gt;
            &lt;unusedArtifactsCleanupPeriodHours&gt;0&lt;/unusedArtifactsCleanupPeriodHours&gt;
            &lt;shareConfiguration&gt;false&lt;/shareConfiguration&gt;
            &lt;synchronizeProperties&gt;false&lt;/synchronizeProperties&gt;
            &lt;listRemoteFolderItems&gt;true&lt;/listRemoteFolderItems&gt;
            &lt;rejectInvalidJars&gt;false&lt;/rejectInvalidJars&gt;
            &lt;p2Support&gt;false&lt;/p2Support&gt;
            &lt;p2OriginalUrl&gt;http://mavensync.zkoss.org&lt;/p2OriginalUrl&gt;
            &lt;socketTimeoutMillis&gt;15000&lt;/socketTimeoutMillis&gt;
        &lt;/remoteRepository&gt;
        &lt;remoteRepository&gt;
            &lt;key&gt;zk-ee&lt;/key&gt;
            &lt;description&gt;ZK Enterprise repository&lt;/description&gt;
            &lt;includesPattern&gt;**/*&lt;/includesPattern&gt;
            &lt;repoLayoutRef&gt;maven-2-default&lt;/repoLayoutRef&gt;
            &lt;enableNuGetSupport&gt;false&lt;/enableNuGetSupport&gt;
            &lt;enableGemsSupport&gt;false&lt;/enableGemsSupport&gt;
            &lt;blackedOut&gt;false&lt;/blackedOut&gt;
            &lt;handleReleases&gt;true&lt;/handleReleases&gt;
            &lt;handleSnapshots&gt;true&lt;/handleSnapshots&gt;
            &lt;maxUniqueSnapshots&gt;0&lt;/maxUniqueSnapshots&gt;
            &lt;suppressPomConsistencyChecks&gt;false&lt;/suppressPomConsistencyChecks&gt;
            &lt;propertySets/&gt;
            &lt;archiveBrowsingEnabled&gt;false&lt;/archiveBrowsingEnabled&gt;
            &lt;url&gt;http://mavensync.zkoss.org/zk/ee-eval&lt;/url&gt;
            &lt;offline&gt;false&lt;/offline&gt;
            &lt;hardFail&gt;false&lt;/hardFail&gt;
            &lt;storeArtifactsLocally&gt;true&lt;/storeArtifactsLocally&gt;
            &lt;fetchJarsEagerly&gt;false&lt;/fetchJarsEagerly&gt;
            &lt;fetchSourcesEagerly&gt;false&lt;/fetchSourcesEagerly&gt;
            &lt;retrievalCachePeriodSecs&gt;43200&lt;/retrievalCachePeriodSecs&gt;
            &lt;assumedOfflinePeriodSecs&gt;300&lt;/assumedOfflinePeriodSecs&gt;
            &lt;missedRetrievalCachePeriodSecs&gt;7200&lt;/missedRetrievalCachePeriodSecs&gt;
            &lt;remoteRepoChecksumPolicyType&gt;generate-if-absent&lt;/remoteRepoChecksumPolicyType&gt;
            &lt;unusedArtifactsCleanupPeriodHours&gt;0&lt;/unusedArtifactsCleanupPeriodHours&gt;
            &lt;shareConfiguration&gt;false&lt;/shareConfiguration&gt;
            &lt;synchronizeProperties&gt;false&lt;/synchronizeProperties&gt;
            &lt;listRemoteFolderItems&gt;true&lt;/listRemoteFolderItems&gt;
            &lt;rejectInvalidJars&gt;false&lt;/rejectInvalidJars&gt;
            &lt;p2Support&gt;false&lt;/p2Support&gt;
            &lt;p2OriginalUrl&gt;http://mavensync.zkoss.org&lt;/p2OriginalUrl&gt;
            &lt;socketTimeoutMillis&gt;15000&lt;/socketTimeoutMillis&gt;
        &lt;/remoteRepository&gt;
    &lt;/remoteRepositories&gt;
&lt;/config&gt;
</pre></div>
<p>The system configuration defines:</p>
<ul>
<li>The local repository <tt>ext-release-local</tt> which is used to store Pineapple 3rd party libraries which isn't available in any of the public Maven libraries.</li>
<li>The remote repository <tt>zk-ce</tt> which hold the publicly available ZK artifacts. The repository defines the URL: <tt>http://mavensync.zkoss.org/maven2</tt>. </li>
<li>The remote repository <tt>zk-ee</tt> which hold the ZK enterprise artifacts which requires a ZK enterprise license. The repository defines the URL: <tt>http://mavensync.zkoss.org/zk/ee-eval</tt>. </li></ul>
<p>The source system configuration file <tt>artifactory.config.xml</tt> is generated by configuring Artifactory maually and the exporting the configuration.</p></div>
<div class="section">
<h5>Uploading artifacts to Artifactory<a name="Uploading_artifacts_to_Artifactory"></a></h5>
<p>The web service <tt>/artifactory/ext-release-local/path/to/jar/</tt> is invoked with HTTP POST to install artifacts into the <tt>ext-release-local</tt> repository:</p>
<ul>
<li>The ZK Common library JAR and POM are installed with coordinate: <tt>org.zkoss.common:zcommon:7.0.2</tt></li>
<li>The ZK ZEL library JAR and POM are installed with coordinate: <tt>org.zkoss.common:zel:7.0.2</tt></li>
<li>The ZK library JAR and POM are installed with coordinate: <tt>org.zkoss.zk:zk:7.0.2</tt></li>
<li>The ZK Max library JAR and POM are installed with coordinate: <tt>org.zkoss.zk:zkmax:7.0.2</tt></li>
<li>The ZK Plus library JAR and POM are installed with coordinate: <tt>org.zkoss.zk:zkplus:7.0.2</tt></li>
<li>The ZK Zul library JAR and POM are installed with coordinate: <tt>org.zkoss.zk:zul:7.0.2</tt></li>
<li>The ZK web library JAR and POM are installed with coordinate: <tt>org.zkoss.common:zweb:7.0.2</tt></li>
<li>The ZK Kex library JAR and POM are installed with coordinate: <tt>org.zkoss.common:zkex:7.0.2</tt></li></ul></div>
<div class="section">
<h5>Network access<a name="Network_access"></a></h5>
<p>The Artifactory image exposes TCP port 8081. The repository container binds the port to the Docker host (with no port re-mapping)</p>
<p>Artifactory can be accessed on http://192.168.99.10:8081 </p></div></div></div>
<div class="section">
<h3>Test containers VM<a name="Test_containers_VM"></a></h3>
<div class="section">
<h4>Docker<a name="Docker"></a></h4>
<p>Docker is installed as an OS service.</p>
<p>Docker listens on http://192.168.99.11:8082</p>
<div class="section">
<h5>Docker installation<a name="Docker_installation"></a></h5>
<p>Same configuration as the builder server VM.</p></div></div></div>
<div class="section">
<h3>How to provision the build server <a name="How_to_provision_the_build_server"></a></h3>
<div class="section">
<h4>Install the Software<a name="Install_the_Software"></a></h4>
<p>Install Vagrant and VirtualBox.</p></div>
<div class="section">
<h4>Create Vagrant Project <a name="Create_Vagrant_Project"></a></h4>
<ol style="list-style-type: decimal">
<li>Create Vagrant project directory: <tt>/path/to/work/pineapple-ci</tt> </li>
<li>In the vagrant project directory, create a Vagrant file used to build the CI server. The Vagrant file below is included in the module <i>xx-pineapple-dev-ssh-install-ci-linux64</i>&gt; in the <tt>/vagrant</tt> directory. 
<div class="source">
<pre># -*- mode: ruby -*-
# vi: set ft=ruby :

#BOX_NAME = ENV.fetch(&quot;BOX_NAME&quot;, &quot;bento/centos-7.1&quot;) 
BOX_NAME = ENV.fetch(&quot;BOX_NAME&quot;, &quot;chef/centos-7.0&quot;) 
BOX_IP = ENV.fetch(&quot;BOX_IP&quot;, &quot;192.168.99.10&quot;) 
BOX2_IP = ENV.fetch(&quot;BOX_IP&quot;, &quot;192.168.99.11&quot;) 
BOX_MEM = ENV.fetch(&quot;BOX_MEM&quot;, &quot;2048&quot;) 
BOX_CPUS = ENV.fetch(&quot;BOX_CPUS&quot;, &quot;2&quot;) 

VAGRANTFILE_API_VERSION = &quot;2&quot;

Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|

        # virtual box provider specific settings
        config.vm.provider :virtualbox do |vb|                                  
                vb.customize [&quot;modifyvm&quot;, :id, &quot;--ioapic&quot;, &quot;on&quot;]    
                vb.customize [&quot;modifyvm&quot;, :id, &quot;--memory&quot;, BOX_MEM]    
                vb.customize [&quot;modifyvm&quot;, :id, &quot;--cpus&quot;, BOX_CPUS]      
        end     

        config.vm.define :pineapple_ci do |ci_config|
                ci_config.vm.box = BOX_NAME    
                ci_config.vm.network &quot;private_network&quot;, ip: BOX_IP
        end

        config.vm.define :pineapple_containers do |ci_config|
                ci_config.vm.box = BOX_NAME    
                ci_config.vm.network &quot;private_network&quot;, ip: BOX2_IP
        end
        
end
</pre></div></li></ol></div>
<div class="section">
<h4>Provision the test infrastructure VM's<a name="Provision_the_test_infrastructure_VMs"></a></h4>
<ol style="list-style-type: decimal">
<li>In the vagrant work directory, provision servers: <tt>vagrant up</tt></li></ol></div>
<div class="section">
<h4>Install CI server software<a name="Install_CI_server_software"></a></h4>
<ol style="list-style-type: decimal">
<li>Start Pineapple.</li>
<li>Open the module named <i>xx-pineapple-dev-docker-install-ci-linux64</i></li>
<li>Select the model for the environment <i>linux-pineapple-ci</i>.</li>
<li>Execute the operation <i>deploy</i>.</li></ol></div>
<div class="section">
<h4>Destroy test infrastructure VM's<a name="Destroy_test_infrastructure_VMs"></a></h4>
<ol style="list-style-type: decimal">
<li>In the vagrant work directory, destroy servers: <tt>vagrant destroy -f</tt></li></ol></div></div>
<div class="section">
<h3>Configuration <a name="Configuration"></a></h3>
<div class="section">
<h4>Test setup for the Docker support project<a name="Test_setup_for_the_Docker_support_project"></a></h4>
<p>The Docker support project is tested using the Docker host on the <i>Test containers VM</i>.</p>
<div class="section">
<h5>Requirements to test the Docker support project<a name="Requirements_to_test_the_Docker_support_project"></a></h5>
<p>To test the Docker support project, one Docker host must be provisioned. </p>
<p>The Docker host is provisioned independently of the tests, and the tests assume that the Docker host is available in a well defined state.</p>
<ul>
<li>Expected network configuration.</li>
<li>Expected services are running.</li></ul></div>
<div class="section">
<h5>Network<a name="Network"></a></h5>
<p>The Docker host is listening at 192.168.99.11:8082 </p></div>
<div class="section">
<h5>Security<a name="Security"></a></h5>
<p>Security is currently disabled. </p></div></div>
<div class="section">
<h4>Test setup for the Docker plugin<a name="Test_setup_for_the_Docker_plugin"></a></h4>
<p>TODO: write..</p></div>
<div class="section">
<h4>Test setup for the Weblogic JMX plugin<a name="Test_setup_for_the_Weblogic_JMX_plugin"></a></h4>
<div class="section">
<h5>Requirements to test the WebLogic JMX plugin<a name="Requirements_to_test_the_WebLogic_JMX_plugin"></a></h5>
<p>To test the plugin one virtual server must be provisioned. </p>
<p>The server is provisioned independently of the tests, and the tests assume that the server is available in a well defined state:</p>
<ul>
<li>Expected network configuration.</li>
<li>Expected services are running.</li>
<li>Expected users and directories exists (with the right access rights).</li>
<li>Expected shared directories exists on the host and the guests. </li>
<li>A JVM is installed. </li>
<li>WebLogic is installed.</li></ul></div></div>
<div class="section">
<h4>Test setup for the SSH plugin<a name="Test_setup_for_the_SSH_plugin"></a></h4>
<p>TODO: write..</p>
<div class="section">
<h5>Requirements to test the SSH plugin<a name="Requirements_to_test_the_SSH_plugin"></a></h5>
<p>To test the SSH plugin one virtual server must be provisioned. </p>
<p>The server is provisioned independently of the tests, and the tests assume that the server is available in a well defined state:</p>
<ul>
<li>Expected network configuration.</li>
<li>Expected services are running.</li>
<li>Expected users and directories exists (with the right access rights).</li>
<li>Expected shared directories exists on the host and the guests. </li></ul></div></div>
<div class="section">
<h4>Shared Test Server Configuration - OLD SETUP TO BE REWORKED<a name="Shared_Test_Server_Configuration_-_OLD_SETUP_TO_BE_REWORKED"></a></h4>
<div class="section">
<h5>Shared Folders<a name="Shared_Folders"></a></h5>
<p>The shared folder <tt>/testcases</tt> exists on the guest and it is mapped to the directory <tt>${java.io.tmpdir}/testcases</tt> on the host which is the default directory for directory based JUnit test cases in Pineapple. The default directory for directory based JUnit test cases is defined by the constant <tt>com.alpha.testutils.TestUtilsTestConstants.runtimeDirectory</tt>.</p></div></div>
<div class="section">
<h4>Test Server Configuration for the SSH plugin<a name="Test_Server_Configuration_for_the_SSH_plugin"></a></h4>
<p>Additional configurations to support testing the SSH plugin.</p>
<div class="section">
<h5>Network<a name="Network"></a></h5>
<ul>
<li>SSH Test host:
<ul>
<li>Purpose: Integration test of the SSH Plugin. </li>
<li>IP address: 192.168.100.10</li></ul></li></ul></div></div>
<div class="section">
<h4>Test Server Configuration for the WebLogic JMX plugin<a name="Test_Server_Configuration_for_the_WebLogic_JMX_plugin"></a></h4>
<p>Additional configurations to support testing the WebLogic JMX plugin.</p>
<div class="section">
<h5>Network<a name="Network"></a></h5>
<ul>
<li>WebLogic JMX Test host:
<ul>
<li>Purpose: Integration test of the WebLogic JMX Plugin. </li>
<li>IP address: 192.168.100.11</li></ul></li></ul></div>
<div class="section">
<h5>Users <a name="Users"></a></h5>
<p>A setup must be installed to support usage of WebLogic and the Pineapple agent.</p>
<p>TODO: Describe used user setup.</p></div>
<div class="section">
<h5>Software<a name="Software"></a></h5>
<p>A JVM is installed to support the Pineapple agent and WebLogic.</p>
<p>TODO: Describe JVM in relationship to Pineapple agent and WebLogic requirements.</p>
<p>WebLogic is installed. </p>
<p>TODO: Describe support for multiple WebLogic versions. </p></div>
<div class="section">
<h5>Services<a name="Services"></a></h5>
<p>The Pineapple agent is installed and listens on 0.0.0.0:7099. </p></div></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2018.
          All Rights Reserved.      
                    
      </div>

                          
        
                </div>
    </footer>
  </body>
</html>

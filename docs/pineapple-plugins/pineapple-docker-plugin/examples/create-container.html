<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src\site\apt/examples\create-container.apt at 22 Dec 2018
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Allan Thrane Andersen" />
    <meta name="Date-Revision-yyyymmdd" content="20181222" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Pineapple Docker plugin &#x2013; How-to: Create Docker container</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
    <!-- Google Analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28287414-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Pineapple Docker plugin</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="../../../index.html" title="Pineapple Home">Pineapple Home</a><span class="divider">/</span></li>
      <li class=""><a href="../../index.html" title="Pineapple plugin projects">Pineapple plugin projects</a><span class="divider">/</span></li>
      <li class=""><a href="../index.html" title="Pineapple Docker plugin">Pineapple Docker plugin</a><span class="divider">/</span></li>
    <li class="active ">How-to: Create Docker container</li>
        <li id="publishDate" class="pull-right">Last Published: 22 Dec 2018</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Project Overview</li>
    <li><a href="../../../index.html" title="Home"><span class="none"></span>Home</a></li>
    <li><a href="../../../usage/installation.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li><a href="../../../usage/index.html" title="For Users"><span class="none"></span>For Users</a></li>
    <li><a href="../../../development/index.html" title="For Developers"><span class="none"></span>For Developers</a></li>
    <li><a href="../../../usage/terms.html" title="Terms and Conditions"><span class="none"></span>Terms and Conditions</a></li>
      <li class="nav-header">Clients</li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-standalone-web-client/index.html" title="Standalone Web Application"><span class="none"></span>Standalone Web Application</a></li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/index.html" title="Deployable Web Application"><span class="none"></span>Deployable Web Application</a></li>
    <li><a href="../../../pineapple-applications/pineapple-maven-plugin/index.html" title="Maven Plugin"><span class="none"></span>Maven Plugin</a></li>
      <li class="nav-header">Plugins</li>
    <li><a href="../../../pineapple-plugins/pineapple-agent-plugin/index.html" title="Agent"><span class="none"></span>Agent</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-composite-execution-plugin/index.html" title="Composite Execution"><span class="none"></span>Composite Execution</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-ssh-plugin/index.html" title="SSH"><span class="none"></span>SSH</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-docker-plugin/index.html" title="Docker"><span class="none"></span>Docker</a></li>
    <li><a href="../../../pineapple-modules/pineapple-infrastructure-test-plugin/index.html" title="Infrastructure Test"><span class="none"></span>Infrastructure Test</a></li>
      <li class="nav-header">API's</li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/usage/rest.html" title="REST"><span class="none"></span>REST</a></li>
    <li><a href="../../../development/plugin-framework.html" title="Plugin Framework"><span class="none"></span>Plugin Framework</a></li>
      <li class="nav-header">Additional Information</li>
    <li><a href="http://pineapplesoftware.blogspot.com" class="externalLink" title="The Pineapple Project Blog"><span class="none"></span>The Pineapple Project Blog</a></li>
    <li><a href="http://exceptiontrail.blogspot.com" class="externalLink" title="Pineapple Exception Trail Blog"><span class="none"></span>Pineapple Exception Trail Blog</a></li>
      <li class="nav-header">Project Tools</li>
    <li><a href="https://bintray.com/pineapple/maven/com.alpha.pineapple" class="externalLink" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="https://github.com/athrane/pineapple" class="externalLink" title="Source Code"><span class="none"></span>Source Code</a></li>
    <li><a href="https://github.com/athrane/pineapple/issues" class="externalLink" title="Issue Tracker"><span class="none"></span>Issue Tracker</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
</ul>
          <hr />
          <div id="poweredBy">
    <script type="text/javascript">asyncJs( 'https://apis.google.com/js/plusone.js' )</script>
    <div class="g-plusone" data-href="https://pineapple.java.net" data-size="tall" ></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<div class="section">
<h2><a name="How-to:_Create_Docker_container"></a>How-to: Create Docker container</h2>
<div class="section">
<h3><a name="Overview"></a>Overview</h3>
<p>This example illustrates how the Docker plugin can be used to create a Docker container.</p>
<div class="section">
<h4><a name="Part_of_the_default_configuration"></a>Part of the default configuration</h4>
<p>This example named <tt>docker-002-container-centos</tt>, including all configuration files, is included in the <a href="../../../usage/default-configuration.html">default configuration</a> which is created by Pineapple, so there is no need to create it by hand. </p></div>
<div class="section">
<h4><a name="Installation_of_Docker"></a>Installation of Docker</h4>
<p>This example requires the presence of a Docker daemon. The example <a href="../../pineapple-ssh-plugin/examples/install-docker-latest-centos7-vagrant.html">How-to: Install latest Docker version in a Vagrant box with CentOS 7.0 using SSH.</a> describes how Pineapple can be used to install Docker on a Vagrant box for the purpose of the example.</p>
<p>For the remaining part of this example is assumed that Docker is installed using the above example. The assumed configuration is:</p>
<ul>
<li>The Vagrant box is running CentOS 7.0 and has IP address 192.168.34.10. </li>
<li>The Docker daemon is accessible at 192.168.34.10:8082. </li></ul>
<p>This is relevant since Pineapple will access the Docker daemon to create the container.</p></div></div>
<div class="section">
<h3><a name="Define_the_module"></a>Define the module </h3>
<p>Pineapple's unit of work is modules. A module is a self contained unit which can contain models, scripts and binaries. Models serves to specify test cases, deployment of applications, configuration of devices or execution of scripts. </p>
<p>The default directory for modules is <tt>${user.home}/.pineapple/modules</tt> so we will create a module named <tt>docker-002-container-centos</tt> there. The module for this example will end up with the structure:</p>
<div class="source"><pre class="prettyprint linenums">docker-002-container-centos
 |
 +--- models     
       +--- linux-vagrant.xml 
</pre></div></div>
<div class="section">
<h3><a name="Define_the_module_model"></a>Define the module model</h3>
<p>The model file for definition of the image and the container:</p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;mmd:models xmlns:mmd=&quot;http://pineapple.dev.java.net/ns/module_model_1_0&quot;       
    xmlns:dkp=&quot;http://pineapple.dev.java.net/ns/plugin/docker_1_0&quot; &gt;
    &lt;mmd:model target-resource=&quot;docker-node&quot; 
        target-operation=&quot;deploy-configuration&quot; description=&quot;Define Docker image: centos:latest&quot; &gt;
        &lt;mmd:content&gt;
            &lt;dkp:docker&gt;
              &lt;dkp:image repository=&quot;centos&quot; tag=&quot;latest&quot; /&gt;            
            &lt;/dkp:docker&gt;                       
        &lt;/mmd:content&gt;
    &lt;/mmd:model&gt;
    &lt;mmd:model target-resource=&quot;docker-node&quot; description=&quot;Define Docker container&quot; &gt;
        &lt;mmd:content&gt;
            &lt;dkp:docker&gt;
               &lt;dkp:container name=&quot;alpha01&quot; &gt;
                   &lt;dkp:image repository=&quot;centos&quot; tag=&quot;latest&quot; /&gt;                    
               &lt;/dkp:container&gt;
            &lt;/dkp:docker&gt;                       
        &lt;/mmd:content&gt;
    &lt;/mmd:model&gt;
&lt;/mmd:models&gt;
</pre></div></div>
<div class="section">
<h3><a name="The_configuration_details"></a>The configuration details</h3>
<div class="section">
<h4><a name="The_model_file"></a>The model file</h4>
<div class="section">
<h5><a name="The_used_schemas"></a>The used schemas</h5>
<p>Two schema are used in the model file. The <tt>http://pineapple.dev.java.net/ns/module_model_1_0</tt> is used to define the namespace <tt>mmd</tt> which defines the general infrastructure for models. The <tt>http://pineapple.dev.java.net/ns/plugin/docker_1_0</tt> schema is used to define the namespace <tt>dkp</tt> which is used to define the model for the Docker plugin. Since multiple schemas are used to define the model file, the elements are qualified.</p></div>
<div class="section">
<h5><a name="The_model_file_contains_two_models"></a>The model file contains two models</h5>
<p>The model file contains two <tt>model</tt> elements each of which defines a model. Both models defines usage of the Docker plugin:</p>
<ul>
<li>The first model defines a <i>centos:latest</i> image.</li>
<li>The second models defines a container using the <i>centos:latest</i> image. </li></ul></div>
<div class="section">
<h5><a name="Targeting_the_models"></a>Targeting the models</h5>
<p>The <tt>target-resource</tt> attribute defined on each <tt>model</tt> element declares a reference to the resource which is targeted when the model executed. In this case, the value <tt>docker-node</tt> is a reference to a resource which defines a Docker daemon at 192.168.34.10:8082.</p></div>
<div class="section">
<h5><a name="The_Docker_root_element"></a>The Docker root element</h5>
<p>The <tt>dkp:docker</tt> element defines the root of model for the Docker plugin. </p></div></div>
<div class="section">
<h4><a name="Definition_of_the_image"></a>Definition of the image </h4>
<p>The first model is defined with <tt>target-operation=&quot;deploy-configuration&quot;</tt> which specifies that the model should only be executed when it is invoked with the <i>deploy-configuration</i> operation. When the model is invoked with another operation then this model is ignored, i.e. the image isn't deleted.</p>
<p>The <tt>dkp:image</tt> element defines a <i>centos:latest</i> image which pulled when the <i>deploy-configuration</i> operation is invoked. </p></div>
<div class="section">
<h4><a name="Definition_of_the_container"></a>Definition of the container </h4>
<p>The second model contains the <tt>dkp:container</tt> element which defines a Docker container. When the model is invoked with the <i>deploy-configuration</i> operation then the container is created. When the model is invoked with the <i>undeploy-configuration</i> operation then the container is deleted.</p>
<div class="section">
<h5><a name="The_container_name"></a>The container name </h5>
<p>The container element has a <tt>name</tt> attribute which is a mandatory in Pineapple. After the container is created by Pineapple then it is renamed to the name specified by the attribute. By default containers are primarily identified by ID in Docker, but since Pineapple is stateless, then there is no way for Pineapple to maintain the container ID across invocation of a model. Usage of a container name solves that problem.</p></div>
<div class="section">
<h5><a name="The_container_base_image"></a>The container base image </h5>
<p>The container element contains a mandatory <tt>image</tt> element. The element defines from which image the container is created. The image used by container, is the container defined in the first model.</p></div></div></div>
<div class="section">
<h3><a name="Invoke_Pineapple_to_execute_model"></a>Invoke Pineapple to execute model </h3>
<p>Start your Pineapple client of choice:</p>
<ul>
<li>Select the module named <b>docker-002-container-centos</b></li>
<li>Select the <b>linux-vagrant</b> model.</li>
<li>Invoke the <b>deploy-configuration</b> to create the container.</li></ul></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
Copyright (C) 2007-2017 Allan Thrane Andersen. All Rights Reserved.
        </div>
      </div>
    </footer>
  </body>
</html>

<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 28 Sep 2016
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Allan Thrane Andersen" />
    <meta name="Date-Revision-yyyymmdd" content="20160928" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Pineapple SSH plugin - How-to: Install latest Docker version in a Vagrant box with CentOS 6.5 using SSH</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Pineapple SSH plugin</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="../../../index.html" title="Pineapple Home">
        Pineapple Home</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="../../" title="Pineapple plugin projects">
        Pineapple plugin projects</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="../" title="Pineapple SSH plugin">
        Pineapple SSH plugin</a>
        </li>
      <li class="divider ">/</li>
        <li class="">How-to: Install latest Docker version in a Vagrant box with CentOS 6.5 using SSH</li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 28 Sep 2016</li> 
            
                            </ul>
      </div>

                  
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Project Overview</li>
                                
      <li>
    
                          <a href="../../../index.html" title="Home">
          <i class="none"></i>
        Home</a>
            </li>
                  
      <li>
    
                          <a href="../../../usage/installation.html" title="Installation">
          <i class="none"></i>
        Installation</a>
            </li>
                  
      <li>
    
                          <a href="../../../usage/index.html" title="For Users">
          <i class="none"></i>
        For Users</a>
            </li>
                  
      <li>
    
                          <a href="../../../development/index.html" title="For Developers">
          <i class="none"></i>
        For Developers</a>
            </li>
                  
      <li>
    
                          <a href="../../../usage/terms.html" title="Terms and Conditions">
          <i class="none"></i>
        Terms and Conditions</a>
            </li>
                              <li class="nav-header">Clients</li>
                                
      <li>
    
                          <a href="../../../pineapple-applications/pineapple-web-application/pineapple-standalone-web-client/index.html" title="Standalone Web Application">
          <i class="none"></i>
        Standalone Web Application</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/index.html" title="Deployable Web Application">
          <i class="none"></i>
        Deployable Web Application</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-applications/pineapple-maven-plugin/index.html" title="Maven Plugin">
          <i class="none"></i>
        Maven Plugin</a>
            </li>
                              <li class="nav-header">Plugins</li>
                                
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-agent-plugin/index.html" title="Agent">
          <i class="none"></i>
        Agent</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-composite-execution-plugin/index.html" title="Composite Execution">
          <i class="none"></i>
        Composite Execution</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-ssh-plugin/index.html" title="SSH">
          <i class="none"></i>
        SSH</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-docker-plugin/index.html" title="Docker">
          <i class="none"></i>
        Docker</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-modules/pineapple-infrastructure-test-plugin/index.html" title="Infrastructure Test">
          <i class="none"></i>
        Infrastructure Test</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-jrockit-installation-plugin/index.html" title="JRockit Installation">
          <i class="none"></i>
        JRockit Installation</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-fusion-middleware-installation-plugin/index.html" title="Fusion Middleware Installation">
          <i class="none"></i>
        Fusion Middleware Installation</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-weblogic-installation-plugin/index.html" title="WebLogic Installation">
          <i class="none"></i>
        WebLogic Installation</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-modules/pineapple-weblogic-deployment-plugin/index.html" title="WebLogic Deployment">
          <i class="none"></i>
        WebLogic Deployment</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-weblogic-scripting-tool-plugin/index.html" title="WebLogic Scripting Tool (WLST)">
          <i class="none"></i>
        WebLogic Scripting Tool (WLST)</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-modules/pineapple-weblogic-jmx-plugin/index.html" title="WebLogic JMX">
          <i class="none"></i>
        WebLogic JMX</a>
            </li>
                              <li class="nav-header">API's</li>
                                
      <li>
    
                          <a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/usage/rest.html" title="REST">
          <i class="none"></i>
        REST</a>
            </li>
                  
      <li>
    
                          <a href="../../../development/plugin-framework.html" title="Plugin Framework">
          <i class="none"></i>
        Plugin Framework</a>
            </li>
                              <li class="nav-header">Additional Information</li>
                                
      <li>
    
                          <a href="http://pineapplesoftware.blogspot.com" class="externalLink" title="The Pineapple Tool Blog">
          <i class="none"></i>
        The Pineapple Tool Blog</a>
            </li>
                  
      <li>
    
                          <a href="http://exceptiontrail.blogspot.com" class="externalLink" title="Pineapple Exception Trail Blog">
          <i class="none"></i>
        Pineapple Exception Trail Blog</a>
            </li>
                              <li class="nav-header">Project Tools</li>
                                
      <li>
    
                          <a href="http://java.net/projects/pineapple/downloads" class="externalLink" title="Downloads">
          <i class="none"></i>
        Downloads</a>
            </li>
                  
      <li>
    
                          <a href="http://java.net/projects/pineapple/sources/svn/show" class="externalLink" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
                  
      <li>
    
                          <a href="http://java.net/jira/browse/PINEAPPLE" class="externalLink" title="Issue Tracker">
          <i class="none"></i>
        Issue Tracker</a>
            </li>
                  
      <li>
    
                          <a href="http://java.net/projects/pineapple/lists" class="externalLink" title="Mailing Lists">
          <i class="none"></i>
        Mailing Lists</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                        
      <li>
    
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="https://pineapple.java.net" data-size="tall" ></div>

                   <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                        
        <div id="bodyColumn"  class="span10" >
                                  
            <!-- NOTE: For help with the syntax of this file, see: --><!-- http://maven.apache.org/guides/mini/guide-apt-format.html --><div class="section">
<h2>How-to: Install latest Docker version in a Vagrant box with CentOS 6.5 using SSH<a name="How-to:_Install_latest_Docker_version_in_a_Vagrant_box_with_CentOS_6.5_using_SSH"></a></h2>
<div class="section">
<h3>Overview<a name="Overview"></a></h3>
<p>This example illustrates how the SSH plugin can be used to install the latest Docker version on CentOS 6.5. The example installs Docker and starts the daemon. </p>
<p>Two steps are required to install Docker:</p>
<ul>
<li>Create a VM which serves as host for Docker. Vagrant is used for this purpose.</li>
<li>Start Pineapple and execute the module.</li>
<li>(When the installation is completed, pull an image.) </li></ul>
<div class="section">
<h4>Part of the default configuration<a name="Part_of_the_default_configuration"></a></h4>
<p>This example named <tt>ssh-011-install-docker-latest-version</tt>, including all configuration files, is included in the <a href="../../../usage/default-configuration.html">default configuration</a> which is created by Pineapple, so there is no need to create it by hand.</p></div></div>
<div class="section">
<h3>The steps<a name="The_steps"></a></h3>
<div class="section">
<h4>Build a Vagrant box<a name="Build_a_Vagrant_box"></a></h4>
<ol style="list-style-type: decimal">
<li>Install VirtualBox and Vagrant.</li>
<li>Create a Vagrant project directory <tt>docker-overpowered-prototype</tt>.</li>
<li>Copy the example Vagrant configuration file from <i>${user.home}/.pineapple/modules/ssh-011-install-docker-latest-version/vagrant/Vagrantfile</i> directory to the Vagrant project directory: 
<div class="source">
<pre># -*- mode: ruby -*-
# vi: set ft=ruby :

BOX_NAME = ENV.fetch(&quot;BOX_NAME&quot;, &quot;pineapple-box&quot;) 
BOX_URI = ENV.fetch(&quot;BOX_URI&quot;, &quot;http://puppet-vagrant-boxes.puppetlabs.com/centos-65-x64-virtualbox-puppet.box&quot;) 
BOX_IP = ENV.fetch(&quot;BOX_IP&quot;, &quot;192.168.34.10&quot;) 
BOX_MEM = ENV.fetch(&quot;BOX_MEM&quot;, &quot;2048&quot;) 
BOX_CPUS = ENV.fetch(&quot;BOX_CPUS&quot;, &quot;2&quot;) 

VAGRANTFILE_API_VERSION = &quot;2&quot;

Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|

        # virtual box provider specific settings
        config.vm.provider :virtualbox do |vb|                                  
                vb.customize [&quot;modifyvm&quot;, :id, &quot;--ioapic&quot;, &quot;on&quot;]    
                vb.customize [&quot;modifyvm&quot;, :id, &quot;--memory&quot;, BOX_MEM]    
                vb.customize [&quot;modifyvm&quot;, :id, &quot;--cpus&quot;, BOX_CPUS]      
        end     

        config.vm.define :pineapple_ci do |ci_config|
                ci_config.vm.box = BOX_NAME    
                ci_config.vm.box_url = BOX_URI    
                ci_config.vm.network &quot;private_network&quot;, ip: BOX_IP      
        end
                
end     
</pre></div></li>
<li>Open a prompt, CD into the Vagrant project directory and create the box with the command: <tt>vagrant up</tt>. It will download a CentOS 6.5 image and start the VM with the IP address 192.168.34.10.</li></ol></div>
<div class="section">
<h4>Invoke Pineapple to install Docker<a name="Invoke_Pineapple_to_install_Docker"></a></h4>
<p>Start your Pineapple client of choice:</p>
<ol style="list-style-type: decimal">
<li>Select the module named <b>ssh-011-install-docker-latest-version</b></li>
<li>Select the <b>linux-vagrant</b> model.</li>
<li>Invoke the <b>deploy-configuration</b> operation to install Docker. </li></ol></div>
<div class="section">
<h4>Create image<a name="Create_image"></a></h4>
<p>With Docker installed it can be used to create containers: </p>
<ol style="list-style-type: decimal">
<li>SSH into the Vagrant box using 192.168.34.10:22 with the default Vagrant credentials: <i>vagrant/vagrant</i></li>
<li>Validate Docker installation: <tt>sudo docker info</tt> (....which should execute with no errors).</li>
<li>Change to the custom docker user: <tt>sudo su docker</tt></li>
<li>Create a Ubuntu image: <tt>docker pull ubuntu</tt></li></ol></div></div>
<div class="section">
<h3>The details<a name="The_details"></a></h3>
<p>The details of the module, model and the Pineapple resources are described in the following sections.</p>
<div class="section">
<h4>The resources<a name="The_resources"></a></h4>
<p>A resource defines a entity in a IT environment which is manageable by Pineapple through some protocol. In this example, the entity is a Linux OS and the used protocol is SSH. One resource is defined for each Linux host where the YUM packages should be installed.</p>
<p>In this example we will use the <tt>linux-vagrant</tt> environment defined as part of the default configuration. The environment defines a network with three hosts: </p>
<ul>
<li><i>Node1</i> with IP Address: 192.168.34.10</li>
<li><i>Node2</i> with IP Address: 192.168.34.11</li>
<li><i>Node3</i> with IP Address: 192.168.34.12</li></ul>
<p>To enable SSH usage for these hosts, three resources are defined within the <tt>linux-vagrant</tt> environment in the resources file located at <tt>${user.home}/.pineapple/conf/resources.xml</tt>: </p>
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration xmlns=&quot;http://pineapple.dev.java.net/ns/environment_1_0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://pineapple.dev.java.net/ns/environment_1_0
    http://pineapple.dev.java.net/ns/environment_1_0.xsd&quot;&gt;
     
    &lt;environments&gt;
        &lt;environment description=&quot;Vagrant multi-machine Linux environment&quot; id=&quot;linux-vagrant&quot;&gt;
            &lt;resources&gt;
                &lt;resource plugin-id=&quot;com.alpha.pineapple.plugin.ssh&quot; credential-id-ref=&quot;ssh-node1&quot; id=&quot;ssh-node1&quot; &gt;
                    &lt;property value=&quot;192.168.34.10&quot; key=&quot;host&quot;/&gt;
                    &lt;property value=&quot;22&quot; key=&quot;port&quot;/&gt;
                    &lt;property value=&quot;1000&quot; key=&quot;timeout&quot;/&gt;
                &lt;/resource&gt;
                &lt;resource plugin-id=&quot;com.alpha.pineapple.plugin.ssh&quot; credential-id-ref=&quot;ssh-node2&quot; id=&quot;ssh-node2&quot; &gt;
                    &lt;property value=&quot;192.168.34.11&quot; key=&quot;host&quot;/&gt;
                    &lt;property value=&quot;22&quot; key=&quot;port&quot;/&gt;
                    &lt;property value=&quot;1000&quot; key=&quot;timeout&quot;/&gt;
                &lt;/resource&gt;
                &lt;resource plugin-id=&quot;com.alpha.pineapple.plugin.ssh&quot; credential-id-ref=&quot;ssh-node3&quot; id=&quot;ssh-node3&quot; &gt;
                    &lt;property value=&quot;192.168.34.12&quot; key=&quot;host&quot;/&gt;
                    &lt;property value=&quot;22&quot; key=&quot;port&quot;/&gt;
                    &lt;property value=&quot;1000&quot; key=&quot;timeout&quot;/&gt;
                &lt;/resource&gt;
            &lt;/resources&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;
&lt;/configuration&gt; 
</pre></div>
<p>Each resource is defined with a different ID and IP address. All other properties are identical. The role of the attribute <tt>plugin-id</tt> is to bind the resource definition to the plugin code at runtime which implements the SSH plugin.</p>
<p><b>Please notice:</b> Only the VM for <tt>ssh-node1</tt> is created by Vagrant. Even though the <tt>linux-vagrant</tt> environment defines three resource, only the <tt>ssh-node1</tt> resource is used in the example. </p></div>
<div class="section">
<h4>The credentials<a name="The_credentials"></a></h4>
<p>Since SSH requires authentication, each resource defines a reference to a credential. A credential defines the user name and password used for authentication when a SSH session is created to a host.</p>
<p>Three credentials are created within the <tt>linux-vagrant</tt> environment to support authentication. The credentials are defined in the credentials file located at <tt>${user.home}/.pineapple/conf/credentials.xml</tt>: </p>
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;configuration xmlns=&quot;http://pineapple.dev.java.net/ns/environment_1_0&quot;&gt;
    &lt;environments&gt;
        &lt;environment description=&quot;Vagrant multi-machine Linux environment&quot; id=&quot;linux-vagrant&quot;&gt;
            &lt;credentials&gt;
                &lt;credential password=&quot;vagrant&quot; user=&quot;vagrant&quot; id=&quot;ssh-node1&quot;/&gt;
                &lt;credential password=&quot;vagrant&quot; user=&quot;vagrant&quot; id=&quot;ssh-node2&quot;/&gt;
                &lt;credential password=&quot;vagrant&quot; user=&quot;vagrant&quot; id=&quot;ssh-node3&quot;/&gt;
            &lt;/credentials&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;     
&lt;/configuration&gt;
</pre></div>
<p><b>Please notice:</b> Only the VM for <tt>ssh-node1</tt> is created by Vagrant. Even though the <tt>linux-vagrant</tt> environment defines three credentials, only the <tt>ssh-node1</tt> credential is used in the example. </p></div>
<div class="section">
<h4>The module <a name="The_module"></a></h4>
<p>A module defines input to Pineapple and consists in its minimal form of a single XML file containing a model:</p><img src="../images/module-directory-layout.jpg" alt="" />
<p>The directory: <tt>${user.home}/.pineapple/modules/ssh-011-install-docker-latest-version</tt> contains the module. The module in this example have the structure:</p>
<div class="source">
<pre>ssh-011-install-docker-latest-version
 |
 +--- bin        
 |     +--- create-docker.sh
 |     +--- docker.config
 +--- models     
 |     +--- linux-vagrant.xml
 +--- vagrant    
 |     +--- Vagrantfile
</pre></div>
<div class="section">
<h5>Module files<a name="Module_files"></a></h5>
<p>The module consists of the these files:</p>
<ul>
<li><tt>linux-vagrant.xml</tt> is the Pineapple model file for the environment <i>linux-vagrant</i> which installs Docker.</li>
<li><tt>Vagrantfile</tt> is a Vagrant file which can build the VM where Docker is installed.</li>
<li><tt>create-docker-user.sh</tt> is a shell script to create a user named <tt>docker</tt> which is added to the sudoers to enable usage of Docker from the command line without the sudo prefix. Change to the <tt>docker</tt> user with: <tt>sudo su docker</tt>.</li>
<li><tt>docker.config</tt> is a Docker configuration file which is installed in <tt>/etc/sysconfig/docker</tt> in the Vagrant box. The file configures Docker to:
<ul>
<li>Listen for local connections by the <tt>root</tt> user.</li>
<li>Listen on 0.0.0.0:8082 to support remote usage of the REST API.</li></ul>
<p>The file contains:</p>
<div class="source">
<pre>other_args=&quot;-H unix:///var/run/docker.sock -H tcp://0.0.0.0:8082&quot; 
</pre></div></li></ul></div></div>
<div class="section">
<h4>The model file<a name="The_model_file"></a></h4>
<p>The model file named <tt>linux-vagrant.xml</tt> has the content:</p>
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;mmd:models xmlns:mmd=&quot;http://pineapple.dev.java.net/ns/module_model_1_0&quot;       
        xmlns:shp=&quot;http://pineapple.dev.java.net/ns/plugin/ssh_1_0&quot; &gt;
    &lt;mmd:variables&gt;
      &lt;mmd:variable key=&quot;tmp-dir&quot; value=&quot;/tmp&quot; /&gt;                   
      &lt;mmd:variable key=&quot;docker-source-config&quot; value=&quot;docker.config&quot; /&gt;    
      &lt;mmd:variable key=&quot;docker-target-config&quot; value=&quot;/etc/sysconfig/docker&quot; /&gt;    
      &lt;mmd:variable key=&quot;create-user-script&quot; value=&quot;create-docker-user.sh&quot; /&gt;          
    &lt;/mmd:variables&gt;
        
      &lt;mmd:model target-resource=&quot;ssh-ci-node&quot; target-operation=&quot;deploy-configuration&quot; description=&quot;Create and add Docker user to sudoers&quot; &gt;
        &lt;mmd:content&gt;
        &lt;shp:ssh&gt;
          &lt;shp:copy-to source=&quot;modulepath:bin/${create-user-script}&quot; destination=&quot;/tmp/${create-user-script}&quot; chmod=&quot;775 &quot;/&gt;
          &lt;shp:execute command=&quot;sudo /tmp/${create-user-script}&quot; /&gt;            
        &lt;/shp:ssh&gt;                      
      &lt;/mmd:content&gt;
    &lt;/mmd:model&gt;

    &lt;mmd:model target-resource=&quot;ssh-ci-node&quot; target-operation=&quot;deploy-configuration&quot; description=&quot;Install EPEL repository&quot; &gt;
      &lt;mmd:content&gt;
        &lt;shp:ssh&gt;
        &lt;shp:execute command=&quot;sudo wget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm&quot; /&gt;
        &lt;shp:execute command=&quot;sudo rpm -ivh epel-release-6-8.noarch.rpm&quot; /&gt;
        &lt;/shp:ssh&gt;                      
      &lt;/mmd:content&gt;
    &lt;/mmd:model&gt;

    &lt;mmd:model target-resource=&quot;ssh-ci-node&quot; target-operation=&quot;deploy-configuration&quot; description=&quot;Update the lib-device-mapper&quot; &gt;
      &lt;mmd:content&gt;
        &lt;shp:ssh&gt;
        &lt;shp:execute command=&quot;sudo yum-config-manager --enable public_ol6_latest&quot; /&gt;
        &lt;shp:execute command=&quot;sudo yum --assumeyes install device-mapper-event-libs&quot; /&gt;
        &lt;/shp:ssh&gt;                      
      &lt;/mmd:content&gt;
    &lt;/mmd:model&gt;

    &lt;mmd:model target-resource=&quot;ssh-ci-node&quot; target-operation=&quot;deploy-configuration&quot; description=&quot;Install Docker&quot; &gt;
      &lt;mmd:content&gt;
        &lt;shp:ssh&gt;        
          &lt;shp:execute command=&quot;sudo yum --enablerepo=epel-testing --assumeyes install docker-io&quot; /&gt; 
          &lt;shp:execute command=&quot;sudo yum -y update docker-io&quot; /&gt; 
          &lt;shp:copy-to source=&quot;modulepath:bin/${docker-source-config}&quot; destination=&quot;${tmp-dir}/${docker-source-config}&quot; chmod=&quot;775&quot; /&gt;
          &lt;shp:execute command=&quot;sudo mv ${tmp-dir}/${docker-source-config} ${docker-target-config}&quot; /&gt;                                                                    
          &lt;shp:execute command=&quot;sudo service docker start&quot; /&gt; 
        &lt;/shp:ssh&gt;                      
      &lt;/mmd:content&gt;
    &lt;/mmd:model&gt;        
&lt;/mmd:models&gt;
</pre></div>
<div class="section">
<h5>The configuration details<a name="The_configuration_details"></a></h5>
<p>Two schema are used in the model file. The <tt>http://pineapple.dev.java.net/ns/module_model_1_0</tt> is used to define the namespace <tt>mmd</tt> which defines the general infrastructure for models. The <tt>http://pineapple.dev.java.net/ns/plugin/ssh_1_0</tt> schema is used to define the namespace <tt>shp</tt> which is used to define the model for the SSH plugin. Since multiple schemas are used to define the model file, the elements are qualified.</p>
<p>Initially in the model a set of variables are defined within the <tt>variables</tt> stanza. The variables are referenced from the remaining part of the model file. </p>
<p>The <tt>target-resource</tt> attribute defines a reference to the resource which is targeted when the model executed. In this case, the value <tt>ssh-node1</tt> targets the model to a single resource. The two other nodes in the <tt>linux-vagrant</tt> environment isn't used in this example. </p>
<p>The model file is divided into two sub-models, which performs the tasks:</p>
<ul>
<li><b>Create Docker user</b>. A custom docker user is created and added to the sudoers file.</li>
<li><b>Install EPEL repository</b>. Docker is available for RHEL (and CentOS) from the Extra Packages for Enterprise Linux (EPEL). The EPEL package is installed which containts the EPEL PGP key and the YUM configuration.</li>
<li><b>Update the lib-device-mapper</b>. Docker version 1.4.0+ requires update of the device-mapper libs to be updated to &gt;= 1.02.90-1 on Centos/RHEL 6.5.</li>
<li><b>Install Docker</b>. Docker is installed and updated. To install the latest version of Docker, the package is installed from the EPEL testing repository. YUM is used to install Docker as an OS service. The Docker configuration file is installed in <tt>/etc/sysconfig/docker</tt>. Docker is started as an OS service.</li></ul>
<p>The <tt>target-operation</tt> attribute is used to restrict that the sub-models are only executed when Pineapple is invoked with the <i>deploy-configuration</i> operation. This allows for the definition of a set of sub-models which only responds to the <i>undeploy-configuration</i> which implements the inverse semantics, e.g. uninstallation of Jenkins from the target server. </p>
<p>Finally, the execute commands in the models is executed using sudo. The requirement for sudo depends on the privileges of the user used by the SSH plugin to connect to a given host. The users was defined in credentials file in the previous section.</p></div></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2016.
          All Rights Reserved.      
                    
      </div>

                          
        
                </div>
    </footer>
  </body>
</html>

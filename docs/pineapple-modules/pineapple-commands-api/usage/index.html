<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 13 Apr 2017
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Allan Thrane Andersen" />
    <meta name="Date-Revision-yyyymmdd" content="20170413" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Pineapple Chain commands API - Guidelines for implementation of commands</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Pineapple Chain commands API</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="../../../index.html" title="Pineapple Home">
        Pineapple Home</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="../../" title="Pineapple modules">
        Pineapple modules</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="../" title="Pineapple Chain commands API">
        Pineapple Chain commands API</a>
        </li>
      <li class="divider ">/</li>
        <li class="">Guidelines for implementation of commands</li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 13 Apr 2017</li> 
            
                            </ul>
      </div>

                  
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Project Overview</li>
                                
      <li>
    
                          <a href="../../../index.html" title="Home">
          <i class="none"></i>
        Home</a>
            </li>
                  
      <li>
    
                          <a href="../../../usage/installation.html" title="Installation">
          <i class="none"></i>
        Installation</a>
            </li>
                  
      <li>
    
                          <a href="../../../usage/index.html" title="For Users">
          <i class="none"></i>
        For Users</a>
            </li>
                  
      <li>
    
                          <a href="../../../development/index.html" title="For Developers">
          <i class="none"></i>
        For Developers</a>
            </li>
                  
      <li>
    
                          <a href="../../../usage/terms.html" title="Terms and Conditions">
          <i class="none"></i>
        Terms and Conditions</a>
            </li>
                              <li class="nav-header">Clients</li>
                                
      <li>
    
                          <a href="../../../pineapple-applications/pineapple-web-application/pineapple-standalone-web-client/index.html" title="Standalone Web Application">
          <i class="none"></i>
        Standalone Web Application</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/index.html" title="Deployable Web Application">
          <i class="none"></i>
        Deployable Web Application</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-applications/pineapple-maven-plugin/index.html" title="Maven Plugin">
          <i class="none"></i>
        Maven Plugin</a>
            </li>
                              <li class="nav-header">Plugins</li>
                                
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-agent-plugin/index.html" title="Agent">
          <i class="none"></i>
        Agent</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-composite-execution-plugin/index.html" title="Composite Execution">
          <i class="none"></i>
        Composite Execution</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-ssh-plugin/index.html" title="SSH">
          <i class="none"></i>
        SSH</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-docker-plugin/index.html" title="Docker">
          <i class="none"></i>
        Docker</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-modules/pineapple-infrastructure-test-plugin/index.html" title="Infrastructure Test">
          <i class="none"></i>
        Infrastructure Test</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-fusion-middleware-installation-plugin/index.html" title="Fusion Middleware Installation">
          <i class="none"></i>
        Fusion Middleware Installation</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-weblogic-installation-plugin/index.html" title="WebLogic Installation">
          <i class="none"></i>
        WebLogic Installation</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-modules/pineapple-weblogic-deployment-plugin/index.html" title="WebLogic Deployment">
          <i class="none"></i>
        WebLogic Deployment</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-weblogic-scripting-tool-plugin/index.html" title="WebLogic Scripting Tool (WLST)">
          <i class="none"></i>
        WebLogic Scripting Tool (WLST)</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-modules/pineapple-weblogic-jmx-plugin/index.html" title="WebLogic JMX">
          <i class="none"></i>
        WebLogic JMX</a>
            </li>
                              <li class="nav-header">API's</li>
                                
      <li>
    
                          <a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/usage/rest.html" title="REST">
          <i class="none"></i>
        REST</a>
            </li>
                  
      <li>
    
                          <a href="../../../development/plugin-framework.html" title="Plugin Framework">
          <i class="none"></i>
        Plugin Framework</a>
            </li>
                              <li class="nav-header">Additional Information</li>
                                
      <li>
    
                          <a href="http://pineapplesoftware.blogspot.com" class="externalLink" title="The Pineapple Project Blog">
          <i class="none"></i>
        The Pineapple Project Blog</a>
            </li>
                  
      <li>
    
                          <a href="http://exceptiontrail.blogspot.com" class="externalLink" title="Pineapple Exception Trail Blog">
          <i class="none"></i>
        Pineapple Exception Trail Blog</a>
            </li>
                              <li class="nav-header">Project Tools</li>
                                
      <li>
    
                          <a href="https://bintray.com/pineapple/maven/com.alpha.pineapple" class="externalLink" title="Downloads">
          <i class="none"></i>
        Downloads</a>
            </li>
                  
      <li>
    
                          <a href="https://github.com/athrane/pineapple" class="externalLink" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
                  
      <li>
    
                          <a href="https://github.com/athrane/pineapple/issues" class="externalLink" title="Issue Tracker">
          <i class="none"></i>
        Issue Tracker</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                        
      <li>
    
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="http://maven.apache.org" data-size="tall" ></div>

                   <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                        
        <div id="bodyColumn"  class="span10" >
                                  
            <!-- NOTE: For help with the syntax of this file, see: --><!-- http://maven.apache.org/guides/mini/guide-apt-format.html --><div class="section">
<h2>Guidelines for implementation of commands<a name="Guidelines_for_implementation_of_commands"></a></h2>
<p>This document describes how Chain commands in Pineapple project should be implemented using the content of the commands API project.</p>
<p>Implementation of commands involves these issues:</p>
<ul>
<li><b>Types:</b> Which interface and classes to implement.</li>
<li><b>Interface contract:</b> Legal outcomes of command execution.</li>
<li><b>Command naming:</b> Which package to place the commands in what to name the command classes. </li>
<li><b>Command initialization:</b> Mapping of context values into commands fields. </li>
<li><b>Context validation:</b> Validation of the command context values. </li>
<li><b>Exposing available commands:</b> How to expose commands to other Maven projects. And to access the commands. </li>
<li><b>Command invocation:</b> How to invoke commands. </li>
<li><b>Documentation:</b> How to write Javadoc for commands. </li></ul>
<div class="section">
<h3>Types<a name="Types"></a></h3>
<p>Two kinds of commands exists in Pineapple:</p>
<ul>
<li><b>Test commands:</b> commands that tests the state of resources. </li>
<li><b>Regular commands:</b> commands that don't tests anything but serves another purpose, e.g. initiating the tool, loading data or executing stuff.</li></ul>
<p>Both kind of commands should implement the command interface from Commons Chain: <tt>org.apache.commons.chain.Command</tt>.</p></div>
<div class="section">
<h3>Interface contract<a name="Interface_contract"></a></h3>
<p>The interface contract defines the legal outcomes of command execution and it is defined by the <tt>org.apache.commons.chain.Command</tt> interface in the Commons Chain project. The definition of <tt>org.apache.commons.chain.Command</tt> interface is:</p>
<div class="source">
<pre>public interface Command {
        
        public boolean execute(Context context) throws Exception
}               
</pre></div>
<p>A command is executed by invoking the <tt>execute(..)</tt> method. There is three legal outcomes for execution of a regular command in Pineapple:</p>
<ol style="list-style-type: decimal">
<li>Command succeeded, continue chain. </li>
<li>Command succeeded, discontinue chain.</li>
<li>Command failed. </li></ol>
<div class="section">
<h4>Command succeeded, continue chain <a name="Command_succeeded_continue_chain"></a></h4>
<p>Successful command execution with continued chain is signaled by:</p>
<ul>
<li>The <tt>execute(..)</tt> method returns <tt>false</tt>.</li></ul>
<p>If the command resides in a chain then returning <tt>false</tt> signals that execution should continue on the next command in the chain. If no command returns true, before reaching the end of the command sequence, the chain is assumed to have completed normally. </p></div>
<div class="section">
<h4>Command succeeded, discontinue chain <a name="Command_succeeded_discontinue_chain"></a></h4>
<p>Successful command execution with discontinued chain is signaled by:</p>
<ul>
<li>The <tt>execute(..)</tt> method returns <tt>true</tt>.</li></ul>
<p>If the command resides in a chain then returning <tt>true</tt> signals that execution shouldn't continue on the next command in the chain. A command should return true if the chain has completely handled the process. This notion is the basis of the Chain of Responsibility. Processing is handed off from command to command, until a command handles the command. </p></div>
<div class="section">
<h4>Command failed <a name="Command_failed"></a></h4>
<p>Failed command execution is signaled by:</p>
<ul>
<li>A command throws a <tt>com.alpha.pineapple.command.CommandException</tt>.</li></ul>
<p>A chain ends abnormally when any exception is thrown by a command. With Commons Chain, if a command throws an exception, the chain is broken. The exception, be it a runtime exception or application exception, will bubble up to the original caller of the chain. </p></div></div>
<div class="section">
<h3>Command naming<a name="Command_naming"></a></h3>
<p>Commands which are implemented as part of a Pineapple plugin should be placed in unique package named: <tt>&lt;unique plugin package&gt;.command</tt>, where <tt>&lt;unique plugin package</tt>&gt; is a unique package name for the plugin. Example: <tt>com.alpha.pineapple.plugin.net.command</tt>.</p>
<p>Classes should be named <tt>&lt;my thing&gt;Command</tt>, where <tt>&lt;my thing</tt>&gt; is description of what the command does. </p></div>
<div class="section">
<h3>Command initialization <a name="Command_initialization"></a></h3>
<p>The command API contains classes which implements support for automatic mapping of context values into commands fields at run time.</p>
<p>A command is invoked with a context which contains the data that the command operates on. Use the class <tt>com.alpha.pineapple.command.initialization.CommandInitializerImpl</tt> to map values from the context into command fields before the command logic is executed.</p>
<p>Initialization can be implemented by inheritance or by delegation.</p>
<div class="section">
<h4>Initialization by inheritance<a name="Initialization_by_inheritance"></a></h4>
<p>This hasn't been designed yet. Until then, please use delegation.</p></div>
<div class="section">
<h4>Initialization by delegation<a name="Initialization_by_delegation"></a></h4>
<p>Example of how to implement initialization in a command:</p>
<div class="source">
<pre>
public class SomeCommand {
        
    // Context key
    public static final String CONTEXT_KEY = &quot;my-key&quot;;

    // Definition of some field.
    @Initialize( CONTEXT_KEY )
    String someField;
                                                
        public boolean execute(Context context) throws Exception
        {

                // initialize command 
                CommandInitializer initializer =  new CommandInitializerImpl();
                initializer.initialize(context, this);

                // remaining command execution here....
                ...      
        }
                        
}
</pre></div>
<p>The example consists of three parts:</p>
<ul>
<li>Definition of key <tt>CONTEXT_KEY</tt> which defines key in the context which contains a value in context.</li>
<li>Definition of annotated field <tt>someField</tt> to whom the context value is mapped.</li>
<li>Execution of <tt>CommandInitializer.initialize(..)</tt> to do the initialization.</li></ul></div>
<div class="section">
<h4>How to implement automatic command initialization<a name="How_to_implement_automatic_command_initialization"></a></h4>
<p>Add these three elements to a command class:</p>
<ol style="list-style-type: decimal">
<li>Definition of annotated fields which should be initialized with value from the context. A field is annotated with <tt>@Initialize( &lt;key&gt; )</tt>. Where &lt;key&gt; is an String constant which is expected by the command to be defined in the context at runtime. </li>
<li>Definition of content keys for the values which should be mapped into command fields. Please notice that the initialization can map value from any context key. </li>
<li>Add execution of <tt>CommandInitializer.initialize(..)</tt> to the beginning of the <tt>execute(..)</tt> method body to trigger the initialization.</li></ol></div>
<div class="section">
<h4>Failing initialization<a name="Failing_initialization"></a></h4>
<p>If an expected context key-value pairs isn't found then a <tt>com.alpha.pineapple.command.initialization.CommandInitializationFailedException</tt> is thrown and command initialization is aborted. </p></div>
<div class="section">
<h4>Value conversion during field initialization<a name="Value_conversion_during_field_initialization"></a></h4>
<p>The strategy for conversion of values used during field initialization, depends on the type and value of the source key in the context and the type of the target field: </p>
<table border="1" class="table table-striped"><caption>Supported value conversions</caption>
<tr class="a">
<td align="center"><b>Source Type</b></td>
<td align="center"><b>Source Value</b></td>
<td align="center"><b>Target Type</b></td>
<td align="center"><b>Result</b></td></tr>
<tr class="b">
<td align="center">any</td>
<td align="center">null</td>
<td align="center">primitive</td>
<td align="center">Value assignment is skipped as null can't be assigned to primitive types.</td></tr>
<tr class="a">
<td align="center">String</td>
<td align="center">any</td>
<td align="center">primitive</td>
<td align="center">Converted from String to primitive value.</td></tr>
<tr class="b">
<td align="center">String</td>
<td align="center">any</td>
<td align="center">String[]</td>
<td align="center">Converted from String to String[].</td></tr></table></div>
<div class="section">
<h4>The benefits of using automatic command initialization<a name="The_benefits_of_using_automatic_command_initialization"></a></h4>
<p>The benefits are:</p>
<ul>
<li>Removes the need for wiring code which map values from context into command fields. </li>
<li>Removes the need to type cast context values to field types. </li>
<li>Context values can be supplied as <tt>String</tt> and be automatically converted to the type declared by a field. </li>
<li>Command execution fails if expected context keys isn't defined in the context at runtime, i.e. the the annotated fields serves to define the precondition for execution of a command. </li></ul></div></div>
<div class="section">
<h3>Context validation<a name="Context_validation"></a></h3>
<p>The command API contains classes which implements support for automatic validation of values mapped from the context into commands during command initialization. </p>
<p>The context is essentially a map with key-value pairs. In addition to mapping value parts of key-values pair from the context, the command initializer also support validation of the values before they are mapped to command fields. </p>
<p>Example of how to implement value validation in a command:</p>
<div class="source">
<pre>
public class SomeCommand {
        
        ...
        
    // Definition of some field.
    @Initialize( SomeCommand.CONTEXT_KEY )
    @ValidateValue( ValidationPolicy.NOT_NULL )
    String someField;
                                                                        
}
</pre></div>
<p>Value validation is implemented by adding a <tt>@ValidateValue( &lt;policy&gt; )</tt> annotation to a field which is already annotated with the <tt>@Initialize( &lt;key&gt; )</tt> annotation. The &lt;policy&gt; part of the validation annotation defines one or more <b>validation policies</b>. A validation policy defines what is legal value for the field.</p>
<div class="section">
<h4>Failing validation <a name="Failing_validation"></a></h4>
<p>If an illegal value is found in the context then a <tt>com.alpha.pineapple.command.initialization.CommandInitializationFailedException</tt> is thrown and command initialization is aborted.</p></div>
<div class="section">
<h4>Supported validation policies<a name="Supported_validation_policies"></a></h4>
<p>Two validation policies is defined:</p>
<ul>
<li>Not Null - validates that the value isn't null.</li>
<li>Not Empty - validates that the content of validated object isn't null and empty. The semantics of depends on the type of the validated object. The &quot;not empty&quot; validation is supported for these types: 
<ul>
<li><tt>java.lang.String</tt></li>
<li><tt>java.util.Map</tt></li>
<li><tt>java.util.Collection</tt></li>
<li><tt>java.lang.Object[]</tt> </li></ul></li></ul></div>
<div class="section">
<h4>Implementation is based on <tt>org.apache.commons.lang.Validate</tt><a name="Implementation_is_based_on_org.apache.commons.lang.Validate"></a></h4>
<p>The validation of the policies is implemented using <tt>org.apache.commons.lang.Validate</tt> so the validation of the supported types corresponds to the behavior that class:</p>
<p>The not-empty policy for <tt>java.lang.String</tt> fails if:</p>
<ul>
<li>The object is null.</li>
<li>The length of the string is zero.</li></ul>
<p>The not-empty policy for <tt>java.util.Map</tt> and <tt>java.util.Collection</tt> fails if:</p>
<ul>
<li>The object is null.</li>
<li>The size of the collection / map is zero.</li></ul>
<p>The not-empty policy for <tt>java.lang.File</tt> fails if:</p>
<ul>
<li>The object is null.</li>
<li>The length of the parent and child is zero.</li>
<li>The length of the file name or the path is zero. </li></ul>
<p>The not-empty policy for <tt>java.lang.Object[]</tt> fails if:</p>
<ul>
<li>The object is null.</li>
<li>The length of the array is zero.</li></ul></div>
<div class="section">
<h4>Examples <a name="Examples"></a></h4>
<p>1) String is not null </p>
<div class="source">
<pre>    // Definition of some field.
    @Initialize( SomeCommand.CONTEXT_KEY )
    @ValidateValue( ValidationPolicy.NOT_NULL )
    String someField;                                                                   
</pre></div>
<p>2) Object is not null </p>
<div class="source">
<pre>    // Definition of some field.
    @Initialize( SomeCommand.CONTEXT_KEY )
    @ValidateValue( ValidationPolicy.NOT_NULL )
    Object someField;                                                                   
</pre></div>
<p>3) String is not empty</p>
<div class="source">
<pre>    // Definition of some field.
    @Initialize( SomeCommand.CONTEXT_KEY )
    @ValidateValue( ValidationPolicy.NOT_EMPTY )
    String someField;                                                                   
</pre></div>
<p>4) Collection is not empty</p>
<div class="source">
<pre>    // Definition of some field.
    @Initialize( SomeCommand.CONTEXT_KEY )
    @ValidateValue( ValidationPolicy.NOT_EMPTY )
    Collection someField;                                                                       
</pre></div>
<p>4) Unnecessary double test using not-null + not-empty</p>
<div class="source">
<pre>    // Definition of some field.
    @Initialize( SomeCommand.CONTEXT_KEY )
    @ValidateValue( {ValidationPolicy.NOT_NULL, ValidationPolicy.NOT_EMPTY})
    Collection someField;                                                                       
</pre></div>
<p>Since the not-empty policy includes a not-null validation before the object is tested for emptiness, there is no need to combine not-null and not-empty on fields. A not-empty policy will do.</p></div></div>
<div class="section">
<h3>Exposing available commands<a name="Exposing_available_commands"></a></h3>
<p>A project which implements Chains commands should expose the commands by defining them as beans in a Spring context configuration file. The commands can then be looked up from within the project or from other projects. </p>
<p>An alternative is to use use a Chain catalog. This was initially used in Pineapple but was left behind because the Spring approach gave more development benefits due to the support for dependency injection. </p>
<p>Example of definition of commands in a spring context from the <tt>pineapple-infrastructure-test-plugin</tt>:</p>
<div class="source">
<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
        xmlns:oxm=&quot;http://www.springframework.org/schema/oxm&quot;
        xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
    
        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans 
                        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                http://www.springframework.org/schema/oxm 
                http://www.springframework.org/schema/oxm/spring-oxm-3.0.xsd
                http://www.springframework.org/schema/context 
                http://www.springframework.org/schema/context/spring-context-3.0.xsd&quot; &gt;
        
        &lt;!-- import pineapple-command-api bean definitions. --&gt;
        &lt;bean id=&quot;commandRunner&quot; class=&quot;com.alpha.pineapple.command.execution.CommandRunnerImpl&quot; scope=&quot;prototype&quot; /&gt;                                                                                                   

        &lt;!-- enable annotation based configuration / dependency injection --&gt;
        &lt;context:annotation-config /&gt;

        &lt;!-- define input unmarshalling --&gt;
        &lt;!-- define message source for internationalization  --&gt;
  
        &lt;!-- define support commands --&gt;
        &lt;bean id=&quot;invokeHttpGetMethodCommand&quot; class=&quot;com.alpha.pineapple.plugin.net.command.InvokeHttpGetMethodCommand&quot; scope=&quot;prototype&quot; /&gt;            
        &lt;bean id=&quot;testResponsePropertiesCommand&quot; class=&quot;com.alpha.pineapple.plugin.net.command.TestResponsePropertiesCommand&quot; scope=&quot;prototype&quot; /&gt;

        &lt;!-- define test commands --&gt;
        &lt;bean id=&quot;testResolveNameToIpAddressCommand&quot; class=&quot;com.alpha.pineapple.plugin.net.command.TestResolveNameToIPAddressCommand&quot; scope=&quot;prototype&quot; /&gt;      
        &lt;bean id=&quot;testStickynessCommand&quot; class=&quot;com.alpha.pineapple.plugin.net.command.TestStickynessCommand&quot; scope=&quot;prototype&quot; /&gt;      
        &lt;bean id=&quot;testLoadBalancingCommand&quot; class=&quot;com.alpha.pineapple.plugin.net.command.TestLoadBalancingCommand&quot; scope=&quot;prototype&quot; /&gt;        
        &lt;bean id=&quot;testHostListenPortCommand&quot; class=&quot;com.alpha.pineapple.plugin.net.command.TestHostListenPortCommand&quot; scope=&quot;prototype&quot; /&gt;      
        &lt;bean id=&quot;testFtpServerActiveCommand&quot; class=&quot;com.alpha.pineapple.plugin.net.command.TestFtpServerActiveCommand&quot; scope=&quot;prototype&quot; /&gt;    
        &lt;bean id=&quot;testFtpServerContainsDirectoryCommand&quot; class=&quot;com.alpha.pineapple.plugin.net.command.TestFtpServerContainsDirectoryCommand&quot; scope=&quot;prototype&quot; /&gt;      
        &lt;bean id=&quot;testFtpServerCanCreateDirectoryCommand&quot; class=&quot;com.alpha.pineapple.plugin.net.command.TestFtpServerCanCreateDirectoryCommand&quot; scope=&quot;prototype&quot; /&gt;    
        &lt;bean id=&quot;testWindowsShareCommand&quot; class=&quot;com.alpha.pineapple.plugin.net.command.TestWindowsShareCommand&quot; scope=&quot;prototype&quot; /&gt;  
        &lt;bean id=&quot;testHttpRedirectCommand&quot; class=&quot;com.alpha.pineapple.plugin.net.command.TestHttpRedirectCommand&quot; scope=&quot;prototype&quot; /&gt;  
        &lt;bean id=&quot;testHttpHeaderCommand&quot; class=&quot;com.alpha.pineapple.plugin.net.command.TestHttpHeaderCommand&quot; scope=&quot;prototype&quot; /&gt;      

        &lt;!-- define model mapper --&gt;
&lt;/beans&gt;
</pre></div></div>
<div class="section">
<h3>Command invocation<a name="Command_invocation"></a></h3>
<p>There are two approaches to invoke commands:</p>
<ul>
<li>Indirectly through a command facade (Recommended). </li>
<li>Directly using a command runner.</li></ul>
<div class="section">
<h4>Invoking commands using a command facade<a name="Invoking_commands_using_a_command_facade"></a></h4>
<p>Invocation of indirectly commands through a command facade requires the implementation of the facade.</p>
<p>The facade should expose the parameter required by a command through the facade interface. Examples of commands facades are the <tt>CommandFacade</tt> in the core component and the <tt>DockerClient</tt> in the docker support project. </p>
<p>The facade should invoke commands using a command as described in the next section.</p>
<p>The usage of a facade is recommended for command which are reused across a project, since the command invocation using a command runner only needs to be implemented once.</p>
<p>A command facade should throw a an exception when the command invocation fails. The exception should be a subclass of the <tt>ExecutionResultException</tt> which can contain an embedded <tt>ExecutionResult</tt>. The exception should contain execution result for the failed command to allow for further inspection by the client.</p></div>
<div class="section">
<h4>Invoking commands using a command runner <a name="Invoking_commands_using_a_command_runner"></a></h4>
<p>Invoking commands using a <b>command runner</b> supports:</p>
<ul>
<li>Execution of a command in a controlled way, i.e. runtime exceptions are caught and collected for analysis.</li>
<li>Information about how the execution went is collected for analysis.</li>
<li>Factory for creation of command context.</li></ul>
<p>The command runner core interface is <tt>com.alpha.pineapple.command.execution.CommandRunner</tt> which provides the interface for execution of commands in Pineapple. The command API contains a standard implementation of the interface which is named <tt>CommandRunnerImpl</tt>. </p>
<p>Example of how to execute a command using the command runner:</p>
<div class="source">
<pre>class SomeClass {

  /**
   * Test response properties command.
   */
  @Resource
  Command testResponsePropertiesCommand;

  /**
   * Command runner
   */
  @Resource
  CommandRunner commandRunner;        

  public void someMethod( ExecutionResult executionResult ) {
            
    // configure command runner with execution result
    commandRunner.setExecutionResult( executionResult );

    // create context
    Context context = commandRunner.createContext();
    
    // setup the context
    context.put(.....);

    // create description
    String description = &quot;description of the command....&quot;;
                                        
    // run command            
    commandRunner.run(testResponsePropertiesCommand, description, context);
  }
}                                
</pre></div>
<p>The example shows the five steps needed to run a command:</p>
<ul>
<li>Get a command runner.</li>
<li>Get the command. </li>
<li>Configure the command runner with a execution result. </li>
<li>Setup the context.</li>
<li>Use the runner to run the command.</li></ul></div>
<div class="section">
<h4>Getting the command runner<a name="Getting_the_command_runner"></a></h4>
<p>A command runner is obtained by dependency injection done by Spring. In the example above the class <tt>SomeClass</tt> is part of some project. The project should define a Spring context configuration file where <tt>SomeClass</tt> and the command runner are defined as beans: </p>
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
        xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
    
        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans 
                        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                http://www.springframework.org/schema/context 
                http://www.springframework.org/schema/context/spring-context-3.0.xsd&quot; &gt;
        
        &lt;!-- import pineapple-command-api bean definitions. --&gt;
        &lt;bean id=&quot;commandRunner&quot; class=&quot;com.alpha.pineapple.command.execution.CommandRunnerImpl&quot; /&gt;                                                                                                     

        &lt;!-- enable annotation based configuration / dependency injection --&gt;
        &lt;context:annotation-config /&gt;

        &lt;!-- define SomeClass bean--&gt;
        &lt;bean id=&quot;someClass&quot; class=&quot;com.alpha.pineapple.example.SomeClass&quot; /&gt;
        
        &lt;!-- define command bean--&gt;     
    &lt;bean id=&quot;testResponsePropertiesCommand&quot; class=&quot;com.alpha.pineapple.plugin.net.command.TestResponsePropertiesCommand&quot; scope=&quot;prototype&quot; /&gt;          
&lt;/beans&gt;
</pre></div>
<p>The configuration file contains:</p>
<ul>
<li>The class <tt>SomeClass</tt> is defined as a bean named <tt>someClass</tt>.</li>
<li>The class <tt>CommandRunnerImpl</tt> is defined as a bean named <tt>commandRunner</tt>.</li>
<li>Annotation based configuration is enabled with the tag <tt>context:annotation-config</tt>.</li></ul>
<p>The configuration file is <i>missing</i> the wiring of the command runner into the <tt>someClass</tt> bean. The dependency injection is instead setup by these two steps:</p>
<ul>
<li><tt>SomeClass</tt> defines a <tt>@Resource</tt> annotated field with a matching of the type <tt>CommandRunner</tt> and matching name of the command runner bean, i.e. <tt>commandRunner</tt>:
<div class="source">
<pre>@Resource
CommandRunner commandRunner;        
</pre></div></li>
<li>The Spring configuration file has annotation based configuration enabled, which trigger the wiring of the command runner into the <tt>someClass</tt> bean when the context is initialized.
<div class="source">
<pre>&lt;!-- enable annotation based configuration / dependency injection --&gt;
&lt;context:annotation-config /&gt;
</pre></div></li></ul>
<p>..so lookup the <tt>SomeClass</tt> bean from the application context (or inject it into another object) and it will be initialized with a command runner instance.</p>
<p>Finally, a few bits about the command runner bean definition:</p>
<ul>
<li>The command runner is defined as a <i>prototype</i> bean. This is not necessary but it ensures that a new command runner instance is injected into each dependent object.</li>
<li>The spring context configuration file shown above will reside in the project where <tt>SomeClass</tt> is defined, and yet there is a bean definition of the command runner which reside in the <tt>pineapple-commands-api</tt> project. This is not an optimal solution as each project is required to (re)define command runner as a bean. </li></ul></div>
<div class="section">
<h4>Getting the command<a name="Getting_the_command"></a></h4>
<p>The command is obtained the same way as the command runner, e.g. by dependency injection. The steps are the same:</p>
<ul>
<li>Define the command in the Spring context configuration file, as shown in the above example:
<div class="source">
<pre>&lt;!-- define command bean--&gt;     
&lt;bean id=&quot;testResponsePropertiesCommand&quot; class=&quot;com.alpha.pineapple.plugin.net.command.TestResponsePropertiesCommand&quot; scope=&quot;prototype&quot; /&gt;              
</pre></div></li>
<li>Define a field of the type <tt>Command</tt> in the class where the command runner is used. Let the field name match the bean ID in the Spring application context (or define the bean ID on the <tt>@Resource</tt> annotation). Here is the field definition in <tt>SomeClass</tt>: 
<div class="source">
<pre> @Resource
 Command testResponsePropertiesCommand;         
</pre></div></li>
<li>The field is initialized where the class is wired by Spring.</li></ul></div>
<div class="section">
<h4>Configure the command runner with a execution result <a name="Configure_the_command_runner_with_a_execution_result"></a></h4>
<p>The command runner should be configured with a execution result object to provide a way to capture the result of the execution of the command. Invoke the <tt>CommandRunner.setExecutionResult( executionResult )</tt> with a root execution result object:</p>
<div class="source">
<pre>// configure command runner with execution result
commandRunner.setExecutionResult( executionResult );
</pre></div>
<p>If the no execution result object is configured before the command runner is used then the command runner will create a new root execution result object when the runner is used to execute commands. This create an new hierarchy of execution objects and this is not recommended. Always tap into an existing hierarchy of execution objects as this will ensure that the results are propagated to the client.</p></div>
<div class="section">
<h4>Setup the context<a name="Setup_the_context"></a></h4>
<p>Create a context for the chain command and populate it with the properties required by the command. Use the command runner to create contexts for commands by invoking the method <tt>CommandRunner.createContext()</tt> which creates e new Chain context;</p>
<div class="source">
<pre>// create context
Context context = commandRunner.createContext();
    
// setup the context
context.put(.....);              
</pre></div></div>
<div class="section">
<h4>Use the runner to run the command<a name="Use_the_runner_to_run_the_command"></a></h4>
<p>Invoke the method <tt>CommandRunner.run(Command command, String description, Context context)</tt> to execute the command:</p>
<div class="source">
<pre>// run command            
commandRunner.run(testResponsePropertiesCommand, description, context);
</pre></div>
<p>When the runner is invoked it will:</p>
<ol style="list-style-type: decimal">
<li>The runner validates whether it has been configured with a root execution result object. If this is not the case, then it will create a new root execution result object.</li>
<li>The runner creates a new child execution result object and stores the supplied description argument with the result object. This result object is used to describe how the execution of the command proceeds.</li>
<li>The child execution result object is added as the child to the root execution result object. </li>
<li>The runner adds the child execution object to the context with the key <b>execution-result</b>.</li>
<li>The runner invokes <tt>Command.execute(Context context)</tt> on the command.</li>
<li>The command executes its business logic. And prior to completion it should update the execution result object which where added to the context. The command should update the state by:
<ul>
<li>Set the execution state to reflect the outcome of the execution, e.g. <i>success</i>, <i>failed</i>, <i>error</i> or <i>computed</i>.</li>
<li>Add a message with the key <i>Message</i> which describes how the execution went.</li>
<li>If the execution completed with an <i>error</i> state, then add a message with the key <i>StackTrace</i> which contains the stack trace for the error. </li></ul></li>
<li>If the command throws an exception, then the runner will catch it and complete the child execution result as failed with an error using the exception as input.</li>
<li>Return the child execution result.</li></ol></div>
<div class="section">
<h4>Invoking command from other commands<a name="Invoking_command_from_other_commands"></a></h4>
<p>The <b>recommended</b> approach to invoke a command from another command is to implemente the invocation in a command facade which enable reused of the invocation plumbing code.</p>
<p>The recipe for invoking other commands from a command is basically the same as invoking a command from any class, which was illustrated by <tt>SomeClass</tt> above. Here is an example of <tt>CommandA</tt> which invokes <tt>CommandB</tt>:</p>
<div class="source">
<pre>
class CommandA implements Command{

 @Resource
 Command commandB;              

 @Resource
 CommandRunner commandRunner;        

 public boolean execute(Context context) throws Exception {

   // get execution result from context
   ExecutionResult result = (execution result) context.get(&quot;execution-result&quot;);

   // configure command runner with execution result
   commandRunner.setExecutionResult( result );

   // create context for CommandB
   Context cmdBcontext = commandRunner.createContext();
    
   // setup the context CommandB
   cmdBcontext.put(.....);

   // run command            
   commandRunner.run(commandB, &quot;description of the command B...&quot;, context);
 
   // other stuff here....  
 }

}

</pre></div>
<p>Be aware of these points: </p>
<ul>
<li><b>Create child execution results from the existing execution result</b>. If <tt>CommandA</tt> is invoked from the class <tt>SomeClass</tt> using the recipe described above, then command context contains a execution result object for <tt>CommandA</tt>. The execution result should be used to configure the command runner which is used to invoke <tt>CommandB</tt>. This will ensure that the execution result for <tt>CommandB</tt> is created as a child for <tt>CommandA</tt> and all of the results are propagated to the Pineapple client: 
<div class="source">
<pre>
class CommandA implements Command{

 @Resource
 Command commandB;              

 @Resource
 CommandRunner commandRunner;        

 public boolean execute(Context context) throws Exception {

   // get execution result from context
   ExecutionResult result = (execution result) context.get(&quot;execution-result&quot;);

   // configure command runner with execution result
   commandRunner.setExecutionResult( result );

   // create context for CommandB
   Context cmdBcontext = commandRunner.createContext();
    
   // setup the context CommandB
   cmdBcontext.put(.....);

   // run command            
   commandRunner.run(commandB, &quot;description of the command B...&quot;, context);
 
   // other stuff here....  
 }

}

</pre></div></li>
<li><b>Create a separate command context</b>. Create a new command context for <tt>CommandB</tt> to avoid overwriting properties that the invoker of <tt>CommandA</tt> expects to be defined in the context.</li></ul>
<p>These principles should be observed even if the commands reside in the same project. </p></div></div>
<div class="section">
<h3>Documentation: How to write Javadoc for commands <a name="Documentation:_How_to_write_Javadoc_for_commands"></a></h3>
<p>Please use the Javadoc for the command <tt>com.alpha.pineapple.plugin.net.command.TestResponsePropertiesCommand</tt> for a template which shows how to JavaDoc should written for a regular command. Including purpose, precondition and postcondition:</p>
<div class="source">
<pre>/**
 * &lt;p&gt;Implementation of the &lt;code&gt;com.alpha.pineapple.command.test.Command&lt;/code&gt; 
 * interface which which asserts a {@link ResponsePropertyInfoSet} against 
 * the content of a {@link HttpInvocationsSet}.&lt;/p&gt;
 * 
 * &lt;p&gt;Each {@link ResponsePropertyInfo} can contains two assertions which
 * are tested against the {@link HttpInvocationResult } objects contained
 * in the {@link HttpInvocationsSet}.
 * 
 * &lt;p&gt;If the HTTP invocation set is empty or contains a single sequence, 
 * then the test is successful by default.&lt;/p&gt;
 *  
 * &lt;p&gt;Precondition for execution of the command is definition of these keys in 
 * the context:
 * 
 * &lt;ul&gt;
 * &lt;li&gt;&lt;code&gt;execution-result&lt;/code&gt; contains execution result object which is used 
 * to report the result of the execution of the test. The type is 
 * &lt;code&gt;com.alpha.pineapple.plugin.execution.ExecutionResult&lt;/code&gt;.&lt;/li&gt; 
 * 
 * &lt;li&gt;&lt;code&gt;invocation-result-set&lt;/code&gt; HTTP invocation 
 * result set which the test is run against. The type is 
 * &lt;code&gt;HttpInvocationsSet&lt;/code&gt;.&lt;/li&gt;
 * 
 * &lt;li&gt;&lt;code&gt;response-property-info-set&lt;/code&gt; defines a collection of
 * response properties which which are asserted against the content 
 * of the {@link HttpInvocationsSet}. The type is 
 * &lt;code&gt;com.alpha.pineapple.plugin.net.http.ResponsePropertyInfoSet&lt;/code&gt;.&lt;/li&gt;
 * &lt;/ul&gt;
 * &lt;/p&gt; 
 *
 * &lt;p&gt;Postcondition after execution of the command is:
 * 
 * &lt;ul&gt; 
 * &lt;li&gt;The the state of the supplied &lt;code&gt;ExecutionResult&lt;/code&gt; is updated
 * with &lt;code&gt;ExecutionState.SUCCESS&lt;/code&gt; if the test succeeded. If the 
 * test failed then the &lt;code&gt;ExecutionState.FAILURE&lt;/code&gt; is returned.&lt;/li&gt;
 * &lt;li&gt;If the test fails due to an exception then the exception isn't caught, 
 * but passed on the the invoker whose responsibility it is to catch it and update 
 * the &lt;code&gt;ExecutionResult&lt;/code&gt; with the state &lt;code&gt;ExecutionState.ERROR&lt;/code&gt;.
 * &lt;/li&gt;
 * &lt;/ul&gt;  
 * &lt;/p&gt;        
 */
</pre></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2017.
          All Rights Reserved.      
                    
      </div>

                          
        
                </div>
    </footer>
  </body>
</html>

<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src\site\apt/examples\use-session-to-execute-external-processes.apt at 22 Dec 2018
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Allan Thrane Andersen" />
    <meta name="Date-Revision-yyyymmdd" content="20181222" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Pineapple process execution support &#x2013; How-to: Use the process execution session to execute external processes</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
    <!-- Google Analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28287414-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Pineapple process execution support</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="../../../index.html" title="Pineapple Home">Pineapple Home</a><span class="divider">/</span></li>
      <li class=""><a href="../../index.html" title="Pineapple support projects">Pineapple support projects</a><span class="divider">/</span></li>
      <li class=""><a href="../index.html" title="Pineapple process execution support">Pineapple process execution support</a><span class="divider">/</span></li>
    <li class="active ">How-to: Use the process execution session to execute external processes</li>
        <li id="publishDate" class="pull-right">Last Published: 22 Dec 2018</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Project Overview</li>
    <li><a href="../../../index.html" title="Home"><span class="none"></span>Home</a></li>
    <li><a href="../../../usage/installation.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li><a href="../../../usage/index.html" title="For Users"><span class="none"></span>For Users</a></li>
    <li><a href="../../../development/index.html" title="For Developers"><span class="none"></span>For Developers</a></li>
    <li><a href="../../../usage/terms.html" title="Terms and Conditions"><span class="none"></span>Terms and Conditions</a></li>
      <li class="nav-header">Clients</li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-standalone-web-client/index.html" title="Standalone Web Application"><span class="none"></span>Standalone Web Application</a></li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/index.html" title="Deployable Web Application"><span class="none"></span>Deployable Web Application</a></li>
    <li><a href="../../../pineapple-applications/pineapple-maven-plugin/index.html" title="Maven Plugin"><span class="none"></span>Maven Plugin</a></li>
      <li class="nav-header">Plugins</li>
    <li><a href="../../../pineapple-plugins/pineapple-agent-plugin/index.html" title="Agent"><span class="none"></span>Agent</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-composite-execution-plugin/index.html" title="Composite Execution"><span class="none"></span>Composite Execution</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-ssh-plugin/index.html" title="SSH"><span class="none"></span>SSH</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-docker-plugin/index.html" title="Docker"><span class="none"></span>Docker</a></li>
    <li><a href="../../../pineapple-modules/pineapple-infrastructure-test-plugin/index.html" title="Infrastructure Test"><span class="none"></span>Infrastructure Test</a></li>
      <li class="nav-header">API's</li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/usage/rest.html" title="REST"><span class="none"></span>REST</a></li>
    <li><a href="../../../development/plugin-framework.html" title="Plugin Framework"><span class="none"></span>Plugin Framework</a></li>
      <li class="nav-header">Additional Information</li>
    <li><a href="http://pineapplesoftware.blogspot.com" class="externalLink" title="The Pineapple Project Blog"><span class="none"></span>The Pineapple Project Blog</a></li>
    <li><a href="http://exceptiontrail.blogspot.com" class="externalLink" title="Pineapple Exception Trail Blog"><span class="none"></span>Pineapple Exception Trail Blog</a></li>
      <li class="nav-header">Project Tools</li>
    <li><a href="https://bintray.com/pineapple/maven/com.alpha.pineapple" class="externalLink" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="https://github.com/athrane/pineapple" class="externalLink" title="Source Code"><span class="none"></span>Source Code</a></li>
    <li><a href="https://github.com/athrane/pineapple/issues" class="externalLink" title="Issue Tracker"><span class="none"></span>Issue Tracker</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
</ul>
          <hr />
          <div id="poweredBy">
    <script type="text/javascript">asyncJs( 'https://apis.google.com/js/plusone.js' )</script>
    <div class="g-plusone" data-href="https://pineapple.dev.java.net" data-size="tall" ></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<div class="section">
<h2><a name="How-to:_Use_the_process_execution_session_to_execute_external_processes"></a>How-to: Use the process execution session to execute external processes</h2>
<div class="section">
<h3><a name="Introduction"></a>Introduction</h3>
<p>This example illustrates how to setup a project to use the <tt>ProcessExecutionSessionImpl</tt> class in a plugin to execute external OS processes and capture the result in execution result objects.</p>
<p>To setup a project to use the asserter follow these steps:</p>
<ul>
<li>Add Maven dependency to the project.</li>
<li>Import the spring configuration file </li>
<li>Subclass <tt>ProcessExecutionSessionImpl</tt> into a plugin specific session class. </li>
<li>Annotate the plugin specific session class. </li>
<li>Use the session object in operations. </li></ul></div>
<div class="section">
<h3><a name="Add_Maven_dependency_to_the_project"></a>Add Maven dependency to the project</h3>
<p>The <tt>ProcessExecutionSessionImpl</tt> class is defined in the <tt>pineapple-process-execution-support</tt> project, so add a Maven dependency to the project POM:</p>
<div class="source"><pre class="prettyprint linenums">  &lt;dependency&gt;
    &lt;groupId&gt;com.alpha.pineapple&lt;/groupId&gt;
    &lt;artifactId&gt;pineapple-process-execution-support&lt;/artifactId&gt;                       
  &lt;/dependency&gt;                         
</pre></div></div>
<div class="section">
<h3><a name="Import_the_spring_configuration_file"></a>Import the spring configuration file</h3>
<p>If the project contain a Spring configuration file for definition of the beans used by the project then add an <tt>import</tt> directive to import the Spring configuration file from the process execution project:</p>
<div class="source"><pre class="prettyprint linenums">        &lt;!-- Configures pineapple-process-execution-plugin-support --&gt;
        &lt;import resource=&quot;classpath:com.alpha.pineapple.process.execution-config.xml&quot; /&gt;
</pre></div>
<p>Now the session class and other command class is available in the project with the bean id's:</p>
<ul>
<li><tt>processExecutionCommand</tt> which is an prototype instance of a process execution command.</li>
<li><tt>processExecutionSession</tt> which is an prototype instance of a process execution session. </li></ul>
<p><b>Please notice:</b> that the purpose isn't to get access to the session class through Spring, but to enable the session class to access the process execution command through Spring. </p></div>
<div class="section">
<h3><a name="Subclass_ProcessExecutionSessionImpl_into_a_plugin_specific_session_class"></a>Subclass <tt>ProcessExecutionSessionImpl</tt> into a plugin specific session class </h3>
<p>Subclass the <tt>ProcessExecutionSessionImpl</tt> into a plugin specific session class to reuse the functionality of the class. </p>
<p>Example: in the JRockit installation plugion the <tt>ProcessExecutionSessionImpl</tt> class is subclasses into <tt>JRockitInstallationSessionImpl</tt> </p>
<div class="source"><pre class="prettyprint linenums">
package com.alpha.pineapple.plugin.jrockit.installation.session;

import com.alpha.pineapple.plugin.PluginSession;
import com.alpha.pineapple.session.ProcessExecutionSessionImpl;

/**
 * Subclass of {@link ProcessExecutionSessionImpl} to reuse it.   
 */
@PluginSession
public class JRockitInstallationSessionImpl extends ProcessExecutionSessionImpl {
}
        
</pre></div></div>
<div class="section">
<h3><a name="Annotate_the_plugin_specific_session_class"></a>Annotate the plugin specific session class </h3>
<p>To enable the usage of the session class at runtime , annotate it with the <tt>@PluginSession</tt> annotation.</p>
<p>Example: From the JRockit installation plugin: </p>
<div class="source"><pre class="prettyprint linenums">
package com.alpha.pineapple.plugin.jrockit.installation.session;

import com.alpha.pineapple.plugin.PluginSession;
import com.alpha.pineapple.session.ProcessExecutionSessionImpl;

/**
 * Subclass of {@link ProcessExecutionSessionImpl} to reuse it.   
 */
@PluginSession
public class JRockitInstallationSessionImpl extends ProcessExecutionSessionImpl {
}
        
</pre></div></div>
<div class="section">
<h3><a name="Use_the_session_object_in_operations"></a>Use the session object in operations</h3>
<p>The session object will now be initialized by Pineapple when an operation is executed. The session object is available to any operation since it is passed as any argument to operations in the plugin. </p>
<p>Example: From the JRockit installation plugin: </p>
<div class="source"><pre class="prettyprint linenums">
@PluginOperation( OperationNames.DEPLOY_CONFIGURATION )
public class DeployConfiguration implements Operation
{

    public void execute( Object content, Session session, ExecutionResult executionResult ) throws PluginExecutionFailedException
    {
        // validate parameters
        Validate.notNull( content, &quot;content is undefined.&quot; );
        Validate.notNull( session, &quot;session is undefined.&quot; );
        Validate.notNull( executionResult, &quot;executionResult is undefined.&quot; );        
        
        // throw exception if required type isn't available
        if ( !( session instanceof ProcessExecutionSession ) )
        {
                Object[] args = { ProcessExecutionSession.class };                      
                String message = messageProvider.getMessage(&quot;dc.session_typecast_failed&quot;, args );
            throw new PluginExecutionFailedException( message );
        }
                
        try
        {               
            // type cast to JRockit installation model object
                JRockitInstallation model = (JRockitInstallation) content;
            
            // type cast to process execution session 
            ProcessExecutionSession externalProcessSession = (ProcessExecutionSession) session; 

                        //.. more code goes here...
                        
                        // execute external process     
                        session.execute(installer , arguments, DEFAULT_PROCESS_TIMEOUT, description2, result);
                        
        }
        catch ( Exception e )
        {
                Object[] args = { e.toString() };                       
                String message = messageProvider.getMessage(&quot;dc.error&quot;, args );
            throw new PluginExecutionFailedException( message, e );
        }                                       
        
        }

}
        
</pre></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
Copyright (C) 2007-2017 Allan Thrane Andersen. All Rights Reserved.
        </div>
      </div>
    </footer>
  </body>
</html>

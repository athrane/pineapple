<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src\site\apt/examples\install-pineapple-agent-linux.apt at 03 Feb 2019
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Allan Thrane Andersen" />
    <meta name="Date-Revision-yyyymmdd" content="20190203" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Pineapple SSH plugin &#x2013; How-to: Install a Pineapple agent on Linux using SSH</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
    <!-- Google Analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28287414-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Pineapple SSH plugin</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="../../../index.html" title="Pineapple Home">Pineapple Home</a><span class="divider">/</span></li>
      <li class=""><a href="../../index.html" title="Pineapple plugin projects">Pineapple plugin projects</a><span class="divider">/</span></li>
      <li class=""><a href="../index.html" title="Pineapple SSH plugin">Pineapple SSH plugin</a><span class="divider">/</span></li>
    <li class="active ">How-to: Install a Pineapple agent on Linux using SSH</li>
        <li id="publishDate" class="pull-right">Last Published: 03 Feb 2019</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Project Overview</li>
    <li><a href="../../../index.html" title="Home"><span class="none"></span>Home</a></li>
    <li><a href="../../../usage/installation.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li><a href="../../../usage/index.html" title="For Users"><span class="none"></span>For Users</a></li>
    <li><a href="../../../development/index.html" title="For Developers"><span class="none"></span>For Developers</a></li>
    <li><a href="../../../usage/terms.html" title="Terms and Conditions"><span class="none"></span>Terms and Conditions</a></li>
      <li class="nav-header">Clients</li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-standalone-web-client/index.html" title="Standalone Web Application"><span class="none"></span>Standalone Web Application</a></li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/index.html" title="Deployable Web Application"><span class="none"></span>Deployable Web Application</a></li>
    <li><a href="../../../pineapple-applications/pineapple-maven-plugin/index.html" title="Maven Plugin"><span class="none"></span>Maven Plugin</a></li>
      <li class="nav-header">Plugins</li>
    <li><a href="../../../pineapple-plugins/pineapple-agent-plugin/index.html" title="Agent"><span class="none"></span>Agent</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-composite-execution-plugin/index.html" title="Composite Execution"><span class="none"></span>Composite Execution</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-ssh-plugin/index.html" title="SSH"><span class="none"></span>SSH</a></li>
    <li><a href="../../../pineapple-plugins/pineapple-docker-plugin/index.html" title="Docker"><span class="none"></span>Docker</a></li>
    <li><a href="../../../pineapple-modules/pineapple-infrastructure-test-plugin/index.html" title="Infrastructure Test"><span class="none"></span>Infrastructure Test</a></li>
      <li class="nav-header">API's</li>
    <li><a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/usage/rest.html" title="REST"><span class="none"></span>REST</a></li>
    <li><a href="../../../development/plugin-framework.html" title="Plugin Framework"><span class="none"></span>Plugin Framework</a></li>
      <li class="nav-header">Additional Information</li>
    <li><a href="http://pineapplesoftware.blogspot.com" class="externalLink" title="The Pineapple Project Blog"><span class="none"></span>The Pineapple Project Blog</a></li>
    <li><a href="http://exceptiontrail.blogspot.com" class="externalLink" title="Pineapple Exception Trail Blog"><span class="none"></span>Pineapple Exception Trail Blog</a></li>
      <li class="nav-header">Project Tools</li>
    <li><a href="https://bintray.com/pineapple/maven/com.alpha.pineapple" class="externalLink" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="https://github.com/athrane/pineapple" class="externalLink" title="Source Code"><span class="none"></span>Source Code</a></li>
    <li><a href="https://github.com/athrane/pineapple/issues" class="externalLink" title="Issue Tracker"><span class="none"></span>Issue Tracker</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
</ul>
          <hr />
          <div id="poweredBy">
    <script type="text/javascript">asyncJs( 'https://apis.google.com/js/plusone.js' )</script>
    <div class="g-plusone" data-href="https://pineapple.java.net" data-size="tall" ></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<div class="section">
<h2><a name="How-to:_Install_a_Pineapple_agent_on_Linux_using_SSH"></a>How-to: Install a Pineapple agent on Linux using SSH</h2>
<div class="section">
<h3><a name="Overview"></a>Overview</h3>
<p>This example illustrates how the SSH plugin can be used to install a Pineapple agent on Linux (specifically the Linux variants Centos and Red Hat).</p>
<div class="section">
<h4><a name="Part_of_the_default_configuration"></a>Part of the default configuration</h4>
<p>This example named <tt>ssh-007-install-pineapple-agent-linux64</tt>, including all configuration files, is included in the <a href="../../../usage/default-configuration.html">default configuration</a> which is created by Pineapple, so there is no need to create it by hand.</p></div></div>
<div class="section">
<h3><a name="Pineapple_agents"></a>Pineapple agents </h3>
<p>Pineapple supports installation of agents on remote hosts. The purpose of agents is to support the all functionality of Pineapple in a distributed setting. The page <a href="../../../usage/agents.html">Pineapple agent architecture overview</a> describes the most important features of the agent architecture:</p>
<ul>
<li>The Pineapple web application (WAR archive) contains the functionality for both agents and the controlling Pineapple instance (e.g. the master).</li>
<li>The <a href="../../../pineapple-applications/pineapple-web-application/pineapple-standalone-web-client/index.html">stand alone web client </a> is recommended to use as a basis for agents. It is easier to distribute and configure because it comes with its own embedded web server (Jetty).</li>
<li>The prerequisite for installation and execution of an agent is the presence of Java on the host where the agent is installed. Pineapple and Jetty are Java applications.</li></ul>
<div class="section">
<h4><a name="The_installation"></a>The installation</h4>
<p>The installation consists of three parts:</p>
<ul>
<li>Distribution of the Pineapple binary (e.g a ZIP archive), Pineapple configuration files and a service script to install the agent as a OS service.</li>
<li>Remote creation of users and directories used for the execution of the agent.</li>
<li>Installation and start of the agent as a OS service.</li></ul><img src="../images/agent-installation.jpg" alt="" />
<p>The installation is implemented in the module <tt>ssh-007-install-pineapple-agent-linux64</tt> which uses the SSH plugin to do the remote installation.</p></div>
<div class="section">
<h4><a name="Requirements_for_installation_of_the_agent"></a>Requirements for installation of the agent </h4>
<p>The requirements for successful installation of the agent are:</p>
<ul>
<li><b>unzip</b> must be installed in the operating system since Pineapple is distributed as a ZIP archive file. Execution of the example module <tt>ssh-002-install-yum-packages</tt> will install unzip amongst other packages.</li>
<li><b>Java</b> must be installed on the host since Pineapple is a Java application. Execution of the example module <tt>ssh-005-install-jvm-rpm-linux64</tt> will install Java.</li>
<li><b>The agent runtime user</b> used to execute the agent must be present on the host. The runtime user is created as part of the installation described in this example.</li>
<li><b>The runtime directory</b> for the agent must be present on the host. The runtime directory is created as of the installation described in this example.</li></ul>
<p>Instead of executing each modules manually, take a look a the example module <tt>composite-execution-003-install-pineapple-agent</tt> which is a composite that installs the three modules in sequence (i.e. <tt>ssh-002-install-yum-packages</tt>, <tt>ssh-005-install-jvm-rpm-linux64</tt> and <tt>ssh-007-install-pineapple-agent-linux64</tt>).</p></div></div>
<div class="section">
<h3><a name="User_and_directory_setup_in_this_example"></a>User and directory setup in this example </h3>
<p>The design of the used directories and users can be implemented in many different forms on Linux, often determined by your security requirements. The setup used in this example has the characteristics:</p>
<div class="section">
<h4><a name="Target_environment"></a>Target environment</h4>
<p>The <i>linux-vagrant</i> environment will be used as target environment. The environment is an example environment included with Pineapple as part of the <a href="../../../usage/default-configuration.html">default configuration</a>. The environment defines a network with three hosts: </p>
<ul>
<li><i>Node1</i> with IP Address: 192.168.34.10</li>
<li><i>Node2</i> with IP Address: 192.168.34.11</li>
<li><i>Node3</i> with IP Address: 192.168.34.12</li></ul>
<p>The environment consist of three server nodes which can fairly easily be configured using Vagrant. Vagrant is used for convenience in the examples, since it is a easy way to create servers. </p></div>
<div class="section">
<h4><a name="SSH_installation_user"></a>SSH installation user</h4>
<p>Pineapple will use SSH to access the three vagrant boxes (e.g. virtual server instances) through usage of the &quot;default&quot; user <tt>vagrant</tt>. The vagrant user is one of the nice conveniences of using Vagrant. The vagrant user is configured to allow for <tt>sudo</tt> without the requirement for entering a password for privileged administrative commands. As a consequence of the privileges of the vagrant user (e.g. sudo with no password) the SSH commands used to install the agent will prefixed with <tt>sudo</tt>. </p></div>
<div class="section">
<h4><a name="Agent_runtime_user"></a>Agent runtime user</h4>
<p>The agent is installed and run as a OS service. The OS service must run under a user and an appropriate one must be selected. Several options are possible:</p>
<ul>
<li><tt>root</tt>. Just mentioned for completion. Not really a good option, since we want to run out software with less than root privileges. </li>
<li><tt>pineapple</tt>. Creation of a dedicated Pineapple user, completed with the required privileges. This choice make sense if Pineapple is used for infrastructure testing. </li></ul>
<p>Installation using the <tt>pineapple</tt> user is implemented in this example.</p></div>
<div class="section">
<h4><a name="Agent_runtime_directories"></a>Agent runtime directories</h4>
<p>The directory setup in this example has the characteristics:</p>
<ul>
<li>The agent binaries will be installed in the <tt>/opt/pineapple</tt> directory.</li>
<li>The agent configuration files will be installed in the <tt>/home/pineapple/</tt> directory where the Pineapple home directory, e.g. <tt>/home/pineapple/.pineapple</tt> will created when the agent is started. </li>
<li>The service script will be installed in the <tt>etc/init.d</tt> directory. </li>
<li>The service script will log its output to <tt>/var/log/pineapple/pineapple-service.out</tt>. The logging is configured in the service script described below.</li></ul>
<p>For the <tt>pineapple</tt> user to be able to run the agent, then directory for the agent binaries and the Pineapple home directory are created with the access mask 775:</p>
<ul>
<li><tt>rwx</tt> for user <tt>pineapple</tt>. </li>
<li><tt>rwx</tt> for group members, e.g. members of the group <tt>pineapple</tt>.</li>
<li><tt>r-x</tt> for others</li></ul></div></div>
<div class="section">
<h3><a name="Master_environment_configuration_for_installation"></a>Master environment configuration for installation</h3>
<p>The agents are installed using Pineapple. To install the agents at the targeted hosts, then Pineapple must be configured to know about the hosts. The knowledge about the target hosts is defined in the Pineapple environment configuration at the Pineapple instance which will used for the installation. The Pineapple instance which is used to install and control the agents play the role of <b>master</b> in the agent architecture. This aspect is illustrated in the figure above, where the environment configuration defined on the master Pineapple instance on the left side of the figure is used as basis for the installation. </p>
<p>The environment configuration at the master consists of definition of resource and credentials. </p>
<div class="section">
<h4><a name="Define_resources"></a>Define resources</h4>
<p>A resource in Pineapple defines the target for some operation. In this case, to be able to distribute the agent to the three hosts defined in the <tt>linux-vagrant</tt> environment, then a resource must be defined for each host. Three resources are defined within the <tt>linux-vagrant</tt> environment in the resources file located at <tt>${user.home}/.pineapple/conf/resources.xml</tt>: </p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration xmlns=&quot;http://pineapple.dev.java.net/ns/environment_1_0&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://pineapple.dev.java.net/ns/environment_1_0
    http://pineapple.dev.java.net/ns/environment_1_0.xsd&quot;&gt;
     
    &lt;environments&gt;
        &lt;environment description=&quot;Vagrant multi-machine Linux environment&quot; id=&quot;linux-vagrant&quot;&gt;
            &lt;resources&gt;
                &lt;resource plugin-id=&quot;com.alpha.pineapple.plugin.ssh&quot; credential-id-ref=&quot;ssh-node1&quot; id=&quot;ssh-node1&quot; &gt;
                    &lt;property value=&quot;192.168.34.10&quot; key=&quot;host&quot;/&gt;
                    &lt;property value=&quot;22&quot; key=&quot;port&quot;/&gt;
                    &lt;property value=&quot;1000&quot; key=&quot;timeout&quot;/&gt;
                &lt;/resource&gt;
                &lt;resource plugin-id=&quot;com.alpha.pineapple.plugin.ssh&quot; credential-id-ref=&quot;ssh-node2&quot; id=&quot;ssh-node2&quot; &gt;
                    &lt;property value=&quot;192.168.34.11&quot; key=&quot;host&quot;/&gt;
                    &lt;property value=&quot;22&quot; key=&quot;port&quot;/&gt;
                    &lt;property value=&quot;1000&quot; key=&quot;timeout&quot;/&gt;
                &lt;/resource&gt;
                &lt;resource plugin-id=&quot;com.alpha.pineapple.plugin.ssh&quot; credential-id-ref=&quot;ssh-node3&quot; id=&quot;ssh-node3&quot; &gt;
                    &lt;property value=&quot;192.168.34.12&quot; key=&quot;host&quot;/&gt;
                    &lt;property value=&quot;22&quot; key=&quot;port&quot;/&gt;
                    &lt;property value=&quot;1000&quot; key=&quot;timeout&quot;/&gt;
                &lt;/resource&gt;
            &lt;/resources&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;
&lt;/configuration&gt; 
</pre></div>
<p>Each resource is defined with a different ID and IP address. All other properties are identical. The role of the attribute <tt>plugin-id</tt> is to bind the resource definition to the plugin code at runtime which implements the SSH plugin.</p></div>
<div class="section">
<h4><a name="Define_credentials"></a>Define credentials</h4>
<p>Next up, is the definition of the <b>SSH installation user</b> which is used for SSH authentication when a session established with a SSH server. Each resource defines a reference to a credential through the <tt>credential-id-ref</tt> attribute. A credential defines the user name and password used for authentication when a SSH session is created to a host. </p>
<p>Three credentials are created within the <tt>linux-vagrant</tt> environment to support authentication. The credentials are defined in the credentials file located at <tt>${user.home}/.pineapple/conf/credentials.xml</tt>:</p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;configuration xmlns=&quot;http://pineapple.dev.java.net/ns/environment_1_0&quot;&gt;
    &lt;environments&gt;
        &lt;environment description=&quot;Vagrant multi-machine Linux environment&quot; id=&quot;linux-vagrant&quot;&gt;
            &lt;credentials&gt;
                &lt;credential password=&quot;vagrant&quot; user=&quot;vagrant&quot; id=&quot;ssh-node1&quot;/&gt;
                &lt;credential password=&quot;vagrant&quot; user=&quot;vagrant&quot; id=&quot;ssh-node2&quot;/&gt;
                &lt;credential password=&quot;vagrant&quot; user=&quot;vagrant&quot; id=&quot;ssh-node3&quot;/&gt;
            &lt;/credentials&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;     
&lt;/configuration&gt;
</pre></div></div></div>
<div class="section">
<h3><a name="Define_module"></a>Define module </h3>
<p>A Pineapple module is defined, which implements the installation. The core elements of a module is the model file and any binary content required for the module:</p><img src="../images/module-directory-layout.jpg" alt="" />
<div class="section">
<h4><a name="The_binary_content"></a>The binary content</h4>
<p>The content directory (named <i>bin</i>) will contain these artifacts to support the installation:</p>
<ul>
<li>The Pinapple binary archive, e.g. <tt>pineapple-standalone-web-client-VERSION.zip</tt></li>
<li>The Pineapple environment configuration files (e.g. <tt>resources.xml</tt> and <tt>credentials.xml</tt>) to be used locally by the Pineapple agent.
<p>The module is located at <tt>${user.home}/.pineapple/modules/ssh-007-install-pineapple-agent-linux64/models</tt> and it has the structure:</p>
<div class="source"><pre class="prettyprint linenums">ssh-007-install-pineapple-agent-linux64
 |
 +--- models     
 |     +--- linux-vagrant.xml
 +--- bin        
       +--- pineapple-standalone-web-client-VERSION.zip.DOWNLOAD-ME
       +--- credentials.xml
       +--- resources.xml
</pre></div></li></ul></div>
<div class="section">
<h4><a name="Used_scripts_from_the_Pineapple_binaries"></a>Used scripts from the Pineapple binaries</h4>
<p>The module uses several scripts from within the main Pineapple binaries:</p>
<ul>
<li>The service script (<tt>PINEAPPLE_INSTALL_DIR/bin/pineapple-service.sh</tt>) is installed as a daemon at <tt>/etc/init.d/pineapple</tt>.</li>
<li>The service installer script (<tt>PINEAPPLE_INSTALL_DIR/bin/install-service.sh</tt>) is used to install the service script </li></ul></div>
<div class="section">
<h4><a name="Add_Pineapple"></a>Add Pineapple</h4>
<p>Add the Pineapple standalone client <tt>pineapple-standalone-web-client-VERSION.zip</tt> to <tt>${user.home}/.pineapple/modules/ssh-007-install-pineapple-agent-linux64/bin</tt> directory.</p></div>
<div class="section">
<h4><a name="Define_model"></a>Define model </h4>
<p>The installation steps are implemented in the model file (please refer to steps 3 to 7 in the <i>Install Pinapple Agent</i> figure above). In the models directory, a model file named <tt>linux-vagrant</tt> is defined with the content:</p>
<div class="source"><pre class="prettyprint linenums">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;mmd:models xmlns:mmd=&quot;http://pineapple.dev.java.net/ns/module_model_1_0&quot;       
    xmlns:shp=&quot;http://pineapple.dev.java.net/ns/plugin/ssh_1_0&quot; 
    continue=&quot;false&quot;&gt;
    &lt;mmd:variables&gt;
        &lt;mmd:variable key=&quot;pineapple.archive&quot; value=&quot;pineapple-standalone-web-client-1.8.0.zip&quot; /&gt;
        &lt;mmd:variable key=&quot;pineapple.tmp.installation.dir&quot; value=&quot;/tmp/pineapple-standalone-web-client-1.8.0&quot; /&gt;
        &lt;mmd:variable key=&quot;pineapple.base.dir&quot; value=&quot;/opt&quot; /&gt;
        &lt;mmd:variable key=&quot;pineapple.installation.dir&quot; value=&quot;/opt/pineapple&quot; /&gt;
        &lt;mmd:variable key=&quot;pineapple.home.dir&quot; value=&quot;/var/pineapple&quot; /&gt;                
        &lt;mmd:variable key=&quot;pineapple.user&quot; value=&quot;pineapple&quot; /&gt;
        &lt;mmd:variable key=&quot;pineapple.group&quot; value=&quot;pineapple&quot; /&gt;                                                                        
    &lt;/mmd:variables&gt;
    &lt;mmd:model target-resource=&quot;regex:ssh-node.*&quot; target-operation=&quot;deploy-configuration&quot; description=&quot;Install binaries&quot; &gt;
        &lt;mmd:content&gt;
            &lt;shp:ssh&gt;                   
                &lt;shp:copy-to source=&quot;modulepath:bin/${pineapple.archive}&quot; destination=&quot;/tmp/${pineapple.archive}&quot; substitute-variables=&quot;false&quot;/&gt;
                &lt;shp:execute command=&quot;sudo unzip /tmp/${pineapple.archive} -d /tmp&quot; /&gt;
                &lt;shp:execute command=&quot;sudo rm -rf /tmp/${pineapple.archive}&quot; /&gt;                                 
                &lt;shp:execute command=&quot;sudo mv -f ${pineapple.tmp.installation.dir} ${pineapple.installation.dir}&quot; /&gt;
                &lt;shp:execute command=&quot;sudo chmod +x ${pineapple.installation.dir}/bin/setup.sh&quot; /&gt;                   
                &lt;shp:execute command=&quot;sudo ${pineapple.installation.dir}/bin/setup.sh&quot; /&gt;
                &lt;shp:execute command=&quot;sudo chown -R ${pineapple.user}:${pineapple.group} ${pineapple.installation.dir}&quot; /&gt;
                &lt;shp:execute command=&quot;sudo chmod -R 775 ${pineapple.installation.dir}&quot; /&gt;
            &lt;/shp:ssh&gt;                  
        &lt;/mmd:content&gt;
    &lt;/mmd:model&gt;
    &lt;mmd:model target-resource=&quot;regex:ssh-node.*&quot; target-operation=&quot;{test,deploy-configuration}&quot; description=&quot;Test binaries installation&quot; &gt;
        &lt;mmd:content&gt;
            &lt;shp:ssh&gt;                   
                &lt;shp:assert-contains command=&quot;getent passwd ${pineapple.group}&quot; expected-value=&quot;pineapple:x&quot; /&gt; &lt;!-- Test user exists --&gt;
                &lt;shp:assert-contains command=&quot;getent group ${pineapple.group}&quot; expected-value=&quot;pineapple:x&quot; /&gt;  &lt;!-- Test group exists --&gt;
                &lt;shp:assert-contains command=&quot;id -gn ${pineapple.user}&quot; expected-value=&quot;${pineapple.group}&quot; /&gt; &lt;!-- Test primary group for pineapple.user --&gt;
                &lt;shp:assert-equals command=&quot;test -d ${pineapple.base.dir} &amp;amp;&amp;amp; echo &amp;quot;Found&amp;quot;|| echo &amp;quot;NotFound&amp;quot;&quot; expected-value=&quot;Found&quot; /&gt; &lt;!-- Test dir exist --&gt;    
                &lt;shp:assert-equals command=&quot;test -d ${pineapple.installation.dir} &amp;amp;&amp;amp; echo &amp;quot;Found&amp;quot;|| echo &amp;quot;NotFound&amp;quot;&quot; expected-value=&quot;Found&quot; /&gt; &lt;!-- Test dir exist --&gt;                                      
                &lt;shp:assert-equals command=&quot;stat --format &amp;quot;%a&amp;quot; ${pineapple.installation.dir}&quot; expected-value=&quot;775&quot;/&gt; &lt;!--test directory permissions --&gt;
            &lt;/shp:ssh&gt;                  
        &lt;/mmd:content&gt;
    &lt;/mmd:model&gt;
    &lt;mmd:model target-resource=&quot;regex:ssh-node.*&quot; target-operation=&quot;deploy-configuration&quot; description=&quot;Install configuration files&quot; &gt;
        &lt;mmd:content&gt;
            &lt;shp:ssh&gt;                   
                &lt;shp:execute command=&quot;sudo ${pineapple.installation.dir}/bin/create-runtime-dirs.sh&quot; /&gt;
                &lt;shp:copy-to source=&quot;modulepath:bin/resources.xml&quot; destination=&quot;/tmp/resources.xml&quot;/&gt;
                &lt;shp:copy-to source=&quot;modulepath:bin/credentials.xml&quot; destination=&quot;/tmp/credentials.xml&quot;/&gt;
                &lt;shp:execute command=&quot;sudo cp /tmp/resources.xml ${pineapple.home.dir}/conf/resources.xml&quot; /&gt;                           
                &lt;shp:execute command=&quot;sudo cp /tmp/credentials.xml ${pineapple.home.dir}/conf/credentials.xml&quot; /&gt;
                &lt;shp:execute command=&quot;sudo chown ${pineapple.group}:${pineapple.user} ${pineapple.home.dir}/conf/resources.xml&quot; /&gt;
                &lt;shp:execute command=&quot;sudo chown ${pineapple.group}:${pineapple.user} ${pineapple.home.dir}/conf/credentials.xml&quot; /&gt;
                &lt;shp:execute command=&quot;sudo chmod 644 ${pineapple.home.dir}/conf/resources.xml&quot; /&gt;
                &lt;shp:execute command=&quot;sudo chmod 644 ${pineapple.home.dir}/conf/credentials.xml&quot; /&gt;
            &lt;/shp:ssh&gt;                  
        &lt;/mmd:content&gt;
    &lt;/mmd:model&gt;    
    &lt;mmd:model target-resource=&quot;regex:ssh-node.*&quot; target-operation=&quot;{test,deploy-configuration}&quot; description=&quot;Test configuration installation&quot; &gt;
        &lt;mmd:content&gt;
            &lt;shp:ssh&gt;           
                &lt;shp:assert-equals command=&quot;test -d ${pineapple.home.dir} &amp;amp;&amp;amp; echo &amp;quot;Found&amp;quot;|| echo &amp;quot;NotFound&amp;quot;&quot; expected-value=&quot;Found&quot; /&gt; &lt;!-- Test dir exist --&gt;                                      
                &lt;shp:assert-equals command=&quot;stat --format &amp;quot;%a&amp;quot; ${pineapple.home.dir}&quot; expected-value=&quot;775&quot;/&gt; &lt;!--test directory permissions --&gt;                
                &lt;shp:assert-equals command=&quot;test -d ${pineapple.home.dir}/conf &amp;amp;&amp;amp; echo &amp;quot;Found&amp;quot;|| echo &amp;quot;NotFound&amp;quot;&quot; expected-value=&quot;Found&quot; /&gt; &lt;!-- Test dir exist --&gt;                                 
                &lt;shp:assert-equals command=&quot;stat --format &amp;quot;%a&amp;quot; ${pineapple.home.dir}/conf&quot; expected-value=&quot;775&quot;/&gt; &lt;!--test directory permissions --&gt;
                &lt;shp:assert-equals command=&quot;test -d ${pineapple.home.dir}/modules &amp;amp;&amp;amp; echo &amp;quot;Found&amp;quot;|| echo &amp;quot;NotFound&amp;quot;&quot; expected-value=&quot;Found&quot; /&gt; &lt;!-- Test dir exist --&gt;                              
                &lt;shp:assert-equals command=&quot;stat --format &amp;quot;%a&amp;quot; ${pineapple.home.dir}/modules&quot; expected-value=&quot;775&quot;/&gt; &lt;!--test directory permissions --&gt;
                &lt;shp:assert-equals command=&quot;test -d ${pineapple.home.dir}/reports &amp;amp;&amp;amp; echo &amp;quot;Found&amp;quot;|| echo &amp;quot;NotFound&amp;quot;&quot; expected-value=&quot;Found&quot; /&gt; &lt;!-- Test dir exist --&gt;                                
                &lt;shp:assert-equals command=&quot;stat --format &amp;quot;%a&amp;quot; ${pineapple.home.dir}/reports&quot; expected-value=&quot;775&quot;/&gt; &lt;!--test directory permissions --&gt;
                &lt;shp:assert-equals command=&quot;test -f ${pineapple.home.dir}/conf/resources.xml &amp;amp;&amp;amp; echo &amp;quot;Found&amp;quot; || echo &amp;quot;NotFound&amp;quot;&quot; expected-value=&quot;Found&quot; /&gt;                          
                &lt;shp:assert-equals command=&quot;stat --format &amp;quot;%a&amp;quot; ${pineapple.home.dir}/conf/resources.xml&quot; expected-value=&quot;644&quot;/&gt; &lt;!--test directory permissions --&gt;
                &lt;shp:assert-equals command=&quot;test -f ${pineapple.home.dir}/conf/credentials.xml &amp;amp;&amp;amp; echo &amp;quot;Found&amp;quot; || echo &amp;quot;NotFound&amp;quot;&quot; expected-value=&quot;Found&quot; /&gt;                        
                &lt;shp:assert-equals command=&quot;stat --format &amp;quot;%a&amp;quot; ${pineapple.home.dir}/conf/resources.xml&quot; expected-value=&quot;644&quot;/&gt; &lt;!--test directory permissions --&gt;
                &lt;shp:assert-equals command=&quot;stat --format &amp;quot;%U&amp;quot; ${pineapple.home.dir}/conf/resources.xml&quot; expected-value=&quot;${pineapple.user}&quot;/&gt; &lt;!--test directory owner --&gt;
                &lt;shp:assert-equals command=&quot;stat --format &amp;quot;%G&amp;quot; ${pineapple.home.dir}/conf/resources.xml&quot; expected-value=&quot;${pineapple.group}&quot;/&gt; &lt;!--test directory group --&gt;
                &lt;shp:assert-equals command=&quot;stat --format &amp;quot;%a&amp;quot; ${pineapple.home.dir}/conf/credentials.xml&quot; expected-value=&quot;644&quot;/&gt; &lt;!--test directory permissions --&gt;
                &lt;shp:assert-equals command=&quot;stat --format &amp;quot;%U&amp;quot; ${pineapple.home.dir}/conf/credentials.xml&quot; expected-value=&quot;${pineapple.user}&quot;/&gt; &lt;!--test directory owner --&gt;
                &lt;shp:assert-equals command=&quot;stat --format &amp;quot;%G&amp;quot; ${pineapple.home.dir}/conf/credentials.xml&quot; expected-value=&quot;${pineapple.group}&quot;/&gt; &lt;!--test directory group --&gt;
            &lt;/shp:ssh&gt;                  
        &lt;/mmd:content&gt;
    &lt;/mmd:model&gt;
    &lt;mmd:model target-resource=&quot;regex:ssh-node.*&quot; target-operation=&quot;deploy-configuration&quot; description=&quot;Install service&quot; &gt;
        &lt;mmd:content&gt;
            &lt;shp:ssh&gt;                   
                &lt;shp:execute command=&quot;sudo ${pineapple.installation.dir}/bin/install-service.sh&quot; /&gt;                             
            &lt;/shp:ssh&gt;                  
        &lt;/mmd:content&gt;
    &lt;/mmd:model&gt;  
    &lt;mmd:model target-resource=&quot;regex:ssh-node.*&quot; target-operation=&quot;{test,deploy-configuration}&quot; description=&quot;Test service intallation&quot; &gt;
        &lt;mmd:content&gt;
            &lt;shp:ssh&gt;                   
                &lt;shp:assert-contains command=&quot;sudo /sbin/service pineapple status&quot; expected-value=&quot;is running&quot; /&gt;
            &lt;/shp:ssh&gt;                  
        &lt;/mmd:content&gt;
    &lt;/mmd:model&gt;  
   
    &lt;mmd:model target-resource=&quot;regex:ssh-node.*&quot; target-operation=&quot;undeploy-configuration&quot; description=&quot;Uninstall Pineapple&quot; &gt;
        &lt;mmd:content&gt;
            &lt;shp:ssh&gt;                   
                &lt;shp:execute command=&quot;sudo ${pineapple.installation.dir}/bin/uninstall-service.sh&quot; /&gt;                                           
                &lt;shp:execute command=&quot;sudo rm -rf /tmp/${pineapple.archive}&quot; /&gt;                                 
                &lt;shp:execute command=&quot;sudo rm -rf ${pineapple.installation.dir}&quot; /&gt;     
                &lt;shp:execute command=&quot;sudo rm -rf ${pineapple.home.dir}&quot; /&gt;    
                &lt;shp:execute command=&quot;sudo userdel ${pineapple.user}&quot; /&gt;               
            &lt;/shp:ssh&gt;                  
        &lt;/mmd:content&gt;
    &lt;/mmd:model&gt;        
&lt;/mmd:models&gt;
</pre></div></div>
<div class="section">
<h4><a name="The_configuration_details"></a>The configuration details</h4>
<p>Two schema are used in the model file. The <tt>http://pineapple.dev.java.net/ns/module_model_1_0</tt> is used to define the namespace <tt>mmd</tt> which defines the general infrastructure for models. The <tt>http://pineapple.dev.java.net/ns/plugin/ssh_1_0</tt> schema is used to define the namespace <tt>shp</tt> which is used to define the model for the SSH plugin. Since multiple schemas are used to define the model file, the elements are qualified.</p>
<p>The <tt>target-resource</tt> attribute defines a reference to the resource which is targeted when the model executed. In this case, the value <tt>regex:ssh-node.*</tt> defines a regular expression for targeting multiple resources, e.g. all the resources starting with <tt>ssh-node</tt>. </p>
<p>The main part of the model consists of sub models, which performs the installation steps:</p>
<ul>
<li>Copy and unzip the Pineapple binaries.</li>
<li>Test the installation of the binaries.</li>
<li>Create the the runtime directories used by Pineapple, copy the environment configuration configuration files into the runtime directory structure.</li>
<li>Test the configuration.</li>
<li>Install the OS service.</li>
<li>Test that the OS service started the Pineapple agent successfully.</li></ul>
<p><b>Please notice:</b> The environment variable <tt>JAVA_HOME</tt> isn't set as a result of the installation.</p></div></div>
<div class="section">
<h3><a name="Invoke_Pineapple_to_execute_model"></a>Invoke Pineapple to execute model </h3>
<p>Start your Pineapple client of choice:</p>
<ul>
<li>Select the modules named <b>ssh-007-install-pineapple-agent-linux64</b></li>
<li>Select the <b>linux-vagrant</b> model.</li>
<li>Invoke the <b>deploy-configuration</b> operation to install the Pineapple agent at the three nodes defined in the <tt>linux-vagrant</tt> environment.</li></ul></div>
<div class="section">
<h3><a name="The_Result"></a>The Result</h3>
<p>The result will be that Pineapple is installs as service on the all targeted servers and listens on 0.0.0.0:7099.</p></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
Copyright (C) 2007-2017 Allan Thrane Andersen. All Rights Reserved.
        </div>
      </div>
    </footer>
  </body>
</html>

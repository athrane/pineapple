<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 30 Mar 2018
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Allan Thrane Andersen" />
    <meta name="Date-Revision-yyyymmdd" content="20180330" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Pineapple core component - Encrypting credential passwords</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Pineapple core component</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="../../../index.html" title="Pineapple Home">
        Pineapple Home</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="../../" title="Pineapple modules">
        Pineapple modules</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="../" title="Pineapple core component">
        Pineapple core component</a>
        </li>
      <li class="divider ">/</li>
        <li class="">Encrypting credential passwords</li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 30 Mar 2018</li> 
            
                            </ul>
      </div>

                  
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Project Overview</li>
                                
      <li>
    
                          <a href="../../../index.html" title="Home">
          <i class="none"></i>
        Home</a>
            </li>
                  
      <li>
    
                          <a href="../../../usage/installation.html" title="Installation">
          <i class="none"></i>
        Installation</a>
            </li>
                  
      <li>
    
                          <a href="../../../usage/index.html" title="For Users">
          <i class="none"></i>
        For Users</a>
            </li>
                  
      <li>
    
                          <a href="../../../development/index.html" title="For Developers">
          <i class="none"></i>
        For Developers</a>
            </li>
                  
      <li>
    
                          <a href="../../../usage/terms.html" title="Terms and Conditions">
          <i class="none"></i>
        Terms and Conditions</a>
            </li>
                              <li class="nav-header">Clients</li>
                                
      <li>
    
                          <a href="../../../pineapple-applications/pineapple-web-application/pineapple-standalone-web-client/index.html" title="Standalone Web Application">
          <i class="none"></i>
        Standalone Web Application</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/index.html" title="Deployable Web Application">
          <i class="none"></i>
        Deployable Web Application</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-applications/pineapple-maven-plugin/index.html" title="Maven Plugin">
          <i class="none"></i>
        Maven Plugin</a>
            </li>
                              <li class="nav-header">Plugins</li>
                                
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-agent-plugin/index.html" title="Agent">
          <i class="none"></i>
        Agent</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-composite-execution-plugin/index.html" title="Composite Execution">
          <i class="none"></i>
        Composite Execution</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-ssh-plugin/index.html" title="SSH">
          <i class="none"></i>
        SSH</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-plugins/pineapple-docker-plugin/index.html" title="Docker">
          <i class="none"></i>
        Docker</a>
            </li>
                  
      <li>
    
                          <a href="../../../pineapple-modules/pineapple-infrastructure-test-plugin/index.html" title="Infrastructure Test">
          <i class="none"></i>
        Infrastructure Test</a>
            </li>
                              <li class="nav-header">API's</li>
                                
      <li>
    
                          <a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/usage/rest.html" title="REST">
          <i class="none"></i>
        REST</a>
            </li>
                  
      <li>
    
                          <a href="../../../development/plugin-framework.html" title="Plugin Framework">
          <i class="none"></i>
        Plugin Framework</a>
            </li>
                              <li class="nav-header">Additional Information</li>
                                
      <li>
    
                          <a href="http://pineapplesoftware.blogspot.com" class="externalLink" title="The Pineapple Project Blog">
          <i class="none"></i>
        The Pineapple Project Blog</a>
            </li>
                  
      <li>
    
                          <a href="http://exceptiontrail.blogspot.com" class="externalLink" title="Pineapple Exception Trail Blog">
          <i class="none"></i>
        Pineapple Exception Trail Blog</a>
            </li>
                              <li class="nav-header">Project Tools</li>
                                
      <li>
    
                          <a href="https://bintray.com/pineapple/maven/com.alpha.pineapple" class="externalLink" title="Downloads">
          <i class="none"></i>
        Downloads</a>
            </li>
                  
      <li>
    
                          <a href="https://github.com/athrane/pineapple" class="externalLink" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
                  
      <li>
    
                          <a href="https://github.com/athrane/pineapple/issues" class="externalLink" title="Issue Tracker">
          <i class="none"></i>
        Issue Tracker</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                        
      <li>
    
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="https://pineapple.dev.java.net" data-size="tall" ></div>

                   <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                        
        <div id="bodyColumn"  class="span10" >
                                  
            <!-- NOTE: For help with the syntax of this file, see: --><!-- http://maven.apache.org/guides/mini/guide-apt-format.html --><div class="section">
<h2>Encrypting credential passwords<a name="Encrypting_credential_passwords"></a></h2>
<div class="section">
<h3>Introduction<a name="Introduction"></a></h3>
<p>Pineapple uses (by default) a file based credential provider to manage the defined set of credentials. Credentials are an integral part of the Pineapple <a href="../../../usage/configuration-environment.html">environment configuration</a> and serves to separate the security configuration from the model of the target IT environment that Pineapple operates on. Pineapple uses credentials for authentication when a session is established to a resource. </p>
<p>The resources are accessed using different protocols, each with their own authentication mechanism. The lowest common denominator is usage of user name and password for authentication. Pineapple currently only supports password based authentication. </p>
<p>The file based credential provider is backed by the configuration file named <tt>credentials.xml</tt>. All passwords in the configuration file are encrypted to avoid storing them in clear text. </p></div>
<div class="section">
<h3>Encryption of credential passwords<a name="Encryption_of_credential_passwords"></a></h3>
<p>The credential configuration file <tt>credentials.xml</tt> is read by the credential provider when Pineapple is initialized. When the file is read then Pineapple inspects whether a password is defined in clear text. A password is considered unencrypted if:</p>
<ul>
<li>The password is stored without the prefix <i>encrypted:</i></li>
<li>The password is stored with the prefix <i>encrypted:</i> and decryption of the password fails.</li></ul>
<p>If a password is determined to be in clear text then the password is encrypted and the configuration file is saved to encrypt the password in the file. The prefix <i>encrypted:</i> will be added to the password in the file to signal that the password have been encrypted.</p>
<p>The purpose for supporting processing of unencrypted password in the configuration file is to support manual editing of the configuration file.</p>
<div class="section">
<h4>Passwords are stored encrypted in memory <a name="Passwords_are_stored_encrypted_in_memory"></a></h4>
<p>All passwords are stored encrypted in memory. A password is only when the password is passed on to a specific API used to establish a session to some resource. </p></div>
<div class="section">
<h4>Symmetric encryption<a name="Symmetric_encryption"></a></h4>
<p>The file based credential provider uses symmetric encryption to support the use cases:</p>
<ul>
<li>Encrypt a password in the configuration file.</li>
<li>Decrypt a password in memory when a session to a resource is established. And the password is used for authentication.</li></ul></div></div>
<div class="section">
<h3>The master password<a name="The_master_password"></a></h3>
<p>The used library for encryption <a class="externalLink" href="http://www.jasypt.org">(Jasypt)</a> uses a master password to encrypt and decrypt passwords. </p>
<p>When Pineapple starts, the master password is read from the file location defined by the value of the system property <tt><a href="../../../usage/system-properties.html">pineapple.credentialprovider.password.file</a></tt>. This is an <b>optional</b> system property. If this property isn't defined then it will be resolved to <tt>${pineapple.home.dir}/conf/credentialprovider.password</tt>.</p>
<div class="section">
<h4>Creation of a default master password<a name="Creation_of_a_default_master_password"></a></h4>
<p>If no password file exists at the location resolved by the system property <tt>pineapple.credentialprovider.password.file</tt> then Pineapple will create a file at the location containing a random generated master password. The random generated password will then be used to encrypt all defined passwords. </p></div>
<div class="section">
<h4>The master password isn't included in a configuration refresh<a name="The_master_password_isnt_included_in_a_configuration_refresh"></a></h4>
<p>When the Pineapple is instructed to perform a configuration refresh then the master password isn't re-read and all passwords re-encrypted. A configuration refresh can either be performed through the GUI or through the <a href="../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/usage/rest.html">REST API (using the operation: Refresh Environment Configuration)</a>.</p>
<p>The master password is excluded because:</p>
<ul>
<li>The master password is intended to be a stable configuration which isn't modified. </li>
<li>To be able to include the master password in the configuration refresh then Pineapple should be able to migrate all encrypted passwords from one master password to a new one if the master password had changed in the password file. This functionality isn't supported.</li></ul></div></div>
<div class="section">
<h3>Setting the master password<a name="Setting_the_master_password"></a></h3>
<p>Two scenarios exists for setting the master password:</p>
<ul>
<li>Pineapple has been started previously. A master password file exist and all passwords are already encrypted.</li>
<li>Pineapple hasn't been started previously. A master password file doesn't exist and all passwords are in clear text in the <tt>credentials.xml</tt> file.</li></ul>
<div class="section">
<h4>Setting the master password when the master password file exist and all passwords are already encrypted<a name="Setting_the_master_password_when_the_master_password_file_exist_and_all_passwords_are_already_encrypted"></a></h4>
<p>Follow these steps:</p>
<ol style="list-style-type: decimal">
<li><b>Kill Pineapple.</b> Kill Pineapple if it is running. </li>
<li><b>Determine the location of master password file.</b> 
<ol style="list-style-type: decimal">
<li>If Pineapple is configured to start with the system property <tt>pineapple.credentialprovider.password.file</tt> defined then the location defined by the system property will be used as the location of the master password file. </li>
<li>Otherwise, the location of the master password file is: <tt>${pineapple.home.dir}/conf/credentialprovider.password</tt>.</li></ol></li>
<li><b>Set the new master password</b>. Open the master password file and modify the password by adding a <i>secure random string</i>, e.g something which is approximately than 36 characters long and consist of upper and lower case characters and numbers. Example: <i>/path/to/pinapple/.pineapple/conf/credentialprovider.password</i>:
<div class="source">
<pre>7af93081-e89d-4005-8e23-5c8070d8d773
</pre></div></li>
<li><b>Reset the passwords</b>. Open <tt>credentials.xml</tt> and replace all encrypted passwords with password in clear text:
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;configuration xmlns=&quot;http://pineapple.dev.java.net/ns/environment_1_0&quot;&gt;
  &lt;environments&gt;
    &lt;environment description=&quot;Environment to support execution of modules on a local Linux host with....&quot; id=&quot;linux-default&quot;&gt;
      &lt;credentials&gt;
        &lt;credential password=&quot;WebLogic99&quot; user=&quot;weblogic&quot; id=&quot;weblogic-edit-jmx&quot;/&gt;
      &lt;/credentials&gt;
  &lt;/environment&gt;
    &lt;environment description=&quot;Environment to support the Pineapple test infrastructure.&quot; id=&quot;linux-pineapple-test-infrastructure&quot;&gt;
      &lt;credentials&gt;
        &lt;credential password=&quot;vagrant&quot; user=&quot;vagrant&quot; id=&quot;ssh-node1&quot;/&gt;
        &lt;credential password=&quot;vagrant&quot; user=&quot;vagrant&quot; id=&quot;ssh-node2&quot;/&gt;
      &lt;/credentials&gt;
    &lt;/environment&gt;
    
    ... 
    
&lt;/configuration&gt;
</pre></div></li>
<li><b>Start Pineapple</b>. Start Pineapple to have all password encrypted again:
<ol style="list-style-type: decimal">
<li>The new master password file will be read from the defined location. </li>
<li>All unencrypted passwords in <tt>credentials.xml</tt> will be read and then encrypted with the master password. The passwords are written back to the configuration with the prefix <i>encrypted:</i> appended: 
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;configuration xmlns=&quot;http://pineapple.dev.java.net/ns/environment_1_0&quot;&gt;
  &lt;environments&gt;
    &lt;environment description=&quot;Environment to support execution of modules on a local Linux host with....&quot; id=&quot;linux-default&quot;&gt;
      &lt;credentials&gt;
        &lt;credential password=&quot;encrypted:cucfJyRm0QR6EaNH7A6GRg==&quot; user=&quot;weblogic&quot; id=&quot;weblogic-edit-jmx&quot;/&gt;
      &lt;/credentials&gt;
  &lt;/environment&gt;
    &lt;environment description=&quot;Environment to support the Pineapple test infrastructure.&quot; id=&quot;linux-pineapple-test-infrastructure&quot;&gt;
      &lt;credentials&gt;
        &lt;credential password=&quot;encrypted:VX1mne9VBLY=&quot; user=&quot;vagrant&quot; id=&quot;ssh-node1&quot;/&gt;
        &lt;credential password=&quot;encrypted:VX1mne9VBLY=&quot; user=&quot;vagrant&quot; id=&quot;ssh-node2&quot;/&gt;
      &lt;/credentials&gt;
    &lt;/environment&gt;
    
    ... 
    
&lt;/configuration&gt;
</pre></div></li></ol></li></ol></div>
<div class="section">
<h4>Setting the master password when the master password file doesn't exist and all passwords are in clear text<a name="Setting_the_master_password_when_the_master_password_file_doesnt_exist_and_all_passwords_are_in_clear_text"></a></h4>
<p>Follow these steps:</p>
<ol style="list-style-type: decimal">
<li><b>Determine the location of master password file.</b> 
<ol style="list-style-type: decimal">
<li>If Pineapple is configured to start with the system property <tt>pineapple.credentialprovider.password.file</tt> defined then the location defined by the system property will be used as the location of the master password file. </li>
<li>Otherwise, the location of the master password file is: <tt>${pineapple.home.dir}/conf/credentialprovider.password</tt>.</li></ol></li>
<li><b>Set the new master password</b>. Create a text file at the location and add a <i>secure random string</i>, e.g something which is approximately than 36 characters long and consist of upper and lower case characters and numbers. Example: <i>/path/to/pinapple/.pineapple/conf/credentialprovider.password</i>:
<div class="source">
<pre>g5f7j89l-e3fr-5678-r6h8-5c8070d8d773
</pre></div></li>
<li><b>Start Pineapple</b>. Start Pineapple to encrypt all passwords:
<ol style="list-style-type: decimal">
<li>The new master password file will be read from the defined location. </li>
<li>All unencrypted passwords in <tt>credentials.xml</tt> will by read.</li>
<li>All passwords will be encrypted with the master password and written back to the configuration with the prefix <i>encrypted:</i> appended: 
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;configuration xmlns=&quot;http://pineapple.dev.java.net/ns/environment_1_0&quot;&gt;
  &lt;environments&gt;
    &lt;environment description=&quot;Environment to support execution of modules on a local Linux host with....&quot; id=&quot;linux-default&quot;&gt;
      &lt;credentials&gt;
        &lt;credential password=&quot;encrypted:cucfJyRm0QR6EaNH7A6GRg==&quot; user=&quot;weblogic&quot; id=&quot;weblogic-edit-jmx&quot;/&gt;
      &lt;/credentials&gt;
  &lt;/environment&gt;
    &lt;environment description=&quot;Environment to support the Pineapple test infrastructure.&quot; id=&quot;linux-pineapple-test-infrastructure&quot;&gt;
      &lt;credentials&gt;
        &lt;credential password=&quot;encrypted:VX1mne9VBLY=&quot; user=&quot;vagrant&quot; id=&quot;ssh-node1&quot;/&gt;
        &lt;credential password=&quot;encrypted:VX1mne9VBLY=&quot; user=&quot;vagrant&quot; id=&quot;ssh-node2&quot;/&gt;
      &lt;/credentials&gt;
    &lt;/environment&gt;
    
    ... 
    
&lt;/configuration&gt;
</pre></div></li></ol></li></ol></div></div>
<div class="section">
<h3>Protect the master password file <a name="Protect_the_master_password_file"></a></h3>
<p>The master password must be protected since it can be used to decrypt all passwords. To protect the password, set the location of the master password file to a location which can be protected using OS level measures by limiting access to the file. </p></div>
<div class="section">
<h3>The master password versus the default configuration<a name="The_master_password_versus_the_default_configuration"></a></h3>
<p>When Pineapple is started with no existing configuration then it will create a <a href="../../../usage/default-configuration.html">default configuration</a> which contains:</p>
<ul>
<li>Runtime directories used by Pineapple (e.g. <tt>.pineapple</tt> and sub directories).</li>
<li>Example modules (e.g. located in <tt>.pineapple/modules</tt>).</li>
<li>Configuration files (e.g. <tt>resources.xml</tt> and <tt>credentials.xml</tt> located in <tt>.pineapple/conf</tt>).</li></ul>
<p>Pineapple's behavior regarding encryption of the passwords defined in <tt>credentials.xml</tt> which is created as part of the default configuration depends on whether the master password file exist. </p>
<div class="section">
<h4>Initialization of the default configuration when the master password file doesn't exist <a name="Initialization_of_the_default_configuration_when_the_master_password_file_doesnt_exist"></a></h4>
<p>If no password file exist at the resolved location and then Pineapple will generate a default master password. The passwords defined in the default configuration will be encrypted using the default master password. </p></div>
<div class="section">
<h4>Initialization of the default configuration when the master password file exist <a name="Initialization_of_the_default_configuration_when_the_master_password_file_exist"></a></h4>
<p>If the password file exist then Pineapple will read the master password. The passwords defined in the default configuration will be encrypted using the read master password. </p></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2018.
          All Rights Reserved.      
                    
      </div>

                          
        
                </div>
    </footer>
  </body>
</html>

<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 17 Apr 2017
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Allan Thrane Andersen" />
    <meta name="Date-Revision-yyyymmdd" content="20170417" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Pineapple web application war - Development documentation</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Pineapple web application war</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="../../../../index.html" title="Pineapple Home">
        Pineapple Home</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="../../../" title="Pineapple applications">
        Pineapple applications</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="../../" title="Pineapple web application">
        Pineapple web application</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="../" title="Pineapple web application war">
        Pineapple web application war</a>
        </li>
      <li class="divider ">/</li>
        <li class="">Development documentation</li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 17 Apr 2017</li> 
            
                            </ul>
      </div>

                  
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Project Overview</li>
                                
      <li>
    
                          <a href="../../../../index.html" title="Home">
          <i class="none"></i>
        Home</a>
            </li>
                  
      <li>
    
                          <a href="../../../../usage/installation.html" title="Installation">
          <i class="none"></i>
        Installation</a>
            </li>
                  
      <li>
    
                          <a href="../../../../usage/index.html" title="For Users">
          <i class="none"></i>
        For Users</a>
            </li>
                  
      <li>
    
                          <a href="../../../../development/index.html" title="For Developers">
          <i class="none"></i>
        For Developers</a>
            </li>
                  
      <li>
    
                          <a href="../../../../usage/terms.html" title="Terms and Conditions">
          <i class="none"></i>
        Terms and Conditions</a>
            </li>
                              <li class="nav-header">Clients</li>
                                
      <li>
    
                          <a href="../../../../pineapple-applications/pineapple-web-application/pineapple-standalone-web-client/index.html" title="Standalone Web Application">
          <i class="none"></i>
        Standalone Web Application</a>
            </li>
                  
      <li>
    
                          <a href="../../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/index.html" title="Deployable Web Application">
          <i class="none"></i>
        Deployable Web Application</a>
            </li>
                  
      <li>
    
                          <a href="../../../../pineapple-applications/pineapple-maven-plugin/index.html" title="Maven Plugin">
          <i class="none"></i>
        Maven Plugin</a>
            </li>
                              <li class="nav-header">Plugins</li>
                                
      <li>
    
                          <a href="../../../../pineapple-plugins/pineapple-agent-plugin/index.html" title="Agent">
          <i class="none"></i>
        Agent</a>
            </li>
                  
      <li>
    
                          <a href="../../../../pineapple-plugins/pineapple-composite-execution-plugin/index.html" title="Composite Execution">
          <i class="none"></i>
        Composite Execution</a>
            </li>
                  
      <li>
    
                          <a href="../../../../pineapple-plugins/pineapple-ssh-plugin/index.html" title="SSH">
          <i class="none"></i>
        SSH</a>
            </li>
                  
      <li>
    
                          <a href="../../../../pineapple-plugins/pineapple-docker-plugin/index.html" title="Docker">
          <i class="none"></i>
        Docker</a>
            </li>
                  
      <li>
    
                          <a href="../../../../pineapple-modules/pineapple-infrastructure-test-plugin/index.html" title="Infrastructure Test">
          <i class="none"></i>
        Infrastructure Test</a>
            </li>
                  
      <li>
    
                          <a href="../../../../pineapple-plugins/pineapple-fusion-middleware-installation-plugin/index.html" title="Fusion Middleware Installation">
          <i class="none"></i>
        Fusion Middleware Installation</a>
            </li>
                  
      <li>
    
                          <a href="../../../../pineapple-plugins/pineapple-weblogic-installation-plugin/index.html" title="WebLogic Installation">
          <i class="none"></i>
        WebLogic Installation</a>
            </li>
                  
      <li>
    
                          <a href="../../../../pineapple-plugins/pineapple-weblogic-scripting-tool-plugin/index.html" title="WebLogic Scripting Tool (WLST)">
          <i class="none"></i>
        WebLogic Scripting Tool (WLST)</a>
            </li>
                  
      <li>
    
                          <a href="../../../../pineapple-modules/pineapple-weblogic-jmx-plugin/index.html" title="WebLogic JMX">
          <i class="none"></i>
        WebLogic JMX</a>
            </li>
                              <li class="nav-header">API's</li>
                                
      <li>
    
                          <a href="../../../../pineapple-applications/pineapple-web-application/pineapple-web-application-war/usage/rest.html" title="REST">
          <i class="none"></i>
        REST</a>
            </li>
                  
      <li>
    
                          <a href="../../../../development/plugin-framework.html" title="Plugin Framework">
          <i class="none"></i>
        Plugin Framework</a>
            </li>
                              <li class="nav-header">Additional Information</li>
                                
      <li>
    
                          <a href="http://pineapplesoftware.blogspot.com" class="externalLink" title="The Pineapple Project Blog">
          <i class="none"></i>
        The Pineapple Project Blog</a>
            </li>
                  
      <li>
    
                          <a href="http://exceptiontrail.blogspot.com" class="externalLink" title="Pineapple Exception Trail Blog">
          <i class="none"></i>
        Pineapple Exception Trail Blog</a>
            </li>
                              <li class="nav-header">Project Tools</li>
                                
      <li>
    
                          <a href="https://bintray.com/pineapple/maven/com.alpha.pineapple" class="externalLink" title="Downloads">
          <i class="none"></i>
        Downloads</a>
            </li>
                  
      <li>
    
                          <a href="https://github.com/athrane/pineapple" class="externalLink" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
                  
      <li>
    
                          <a href="https://github.com/athrane/pineapple/issues" class="externalLink" title="Issue Tracker">
          <i class="none"></i>
        Issue Tracker</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                        
      <li>
    
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="http://pineapple.java.net/pineapple-applications/pineapple-web-application/pineapple-web-application-war/" data-size="tall" ></div>

                   <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                        
        <div id="bodyColumn"  class="span10" >
                                  
            <!-- NOTE: For help with the syntax of this file, see: --><!-- http://maven.apache.org/guides/mini/guide-apt-format.html --><div class="section">
<h2>Development documentation<a name="Development_documentation"></a></h2>
<div class="section">
<h3>Architecture<a name="Architecture"></a></h3>
<p>Overview of the architecture:</p><img src="../images/web-application-architecture.jpg" alt="" /></div>
<div class="section">
<h3>Schema location<a name="Schema_location"></a></h3>
<p>The project defines a schema for future storage of web application state The schema is located in the folder: <tt>src/main/resources.</tt></p>
<div class="section">
<h4>Adding the schemas to the main project web site<a name="Adding_the_schemas_to_the_main_project_web_site"></a></h4>
<p>During the <tt>site</tt> phase the schema is copied to the main site in the <tt>pineapple-project</tt>. The schemas are copied to the directory <tt>/ns/app</tt>.</p>
<p>This is implemented in the <tt>pom.xml</tt> for the project. </p></div></div>
<div class="section">
<h3>Generation of classes from XML schemas<a name="Generation_of_classes_from_XML_schemas"></a></h3>
<p>The project uses JABX through the Maven 2 plugin <tt>maven-jaxb2-plugin</tt> to generate classes from XML schemas. </p>
<div class="section">
<h4>Customized package names<a name="Customized_package_names"></a></h4>
<p>The generated classes are mapping into the package <tt>com.alpha.pineapple.web.model</tt> using the JAXB bindings file at: <tt>src/main/resources/bindings.xjb</tt>.</p></div>
<div class="section">
<h4>Customized type names<a name="Customized_type_names"></a></h4>
<p>The JAXB bindings file also defines mappings of Schema type into Java types. The applied rule is to remove the postfixed <tt>Type</tt> from the Schema type in the corresponding Java types, i.e. from the schema type named <tt>NiceType</tt> a Java type named <tt>Nice</tt> is generated by JAXB. </p></div>
<div class="section">
<h4>JAXB Links<a name="JAXB_Links"></a></h4>
<p>More information about JAXB can be found <a class="externalLink" href="https://jaxb.dev.java.net/">here.</a></p>
<p>More information about <tt>maven-jaxb2-plugin</tt> can be found <a class="externalLink" href="https://maven-jaxb2-plugin.dev.java.net/">here.</a> </p></div></div>
<div class="section">
<h3>Internal configuration<a name="Internal_configuration"></a></h3>
<div class="section">
<h4>WAR Deployment descriptors<a name="WAR_Deployment_descriptors"></a></h4>
<div class="section">
<h5>web.xml<a name="web.xml"></a></h5>
<p>The standard Java enterprise edition deployment descriptor for web applications is located in <tt>src/main/webapp/WEB-INF/web.xml</tt>. The descriptor is defined with the version 3.0 schema, i.e. <i>http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd</i>.</p>
<p>The descriptor defines:</p>
<ul>
<li>A <tt>context-param</tt> element with the name <tt>pineapple.home.dir</tt> which defines the location of the pineapple Home directory.</li>
<li>A <tt>listener</tt> element of the class <tt>PineappleHomeInitializer</tt> which initializes the Pineapple home directory.</li>
<li>A <tt>context-param</tt> element with the name <tt>log4jConfig</tt> which defines the location of the Log4j configuration file.</li>
<li>A <tt>listener</tt> element of the class <tt>LoggingInitializer</tt> which initializes Log4j in the web application.</li>
<li>A <tt>context-param</tt> element with the name <tt>contextConfigLocation</tt> which defines the location of the Spring web application context file.</li>
<li>A <tt>listener</tt> element of the class <tt>org.springframework.web.context.ContextLoaderListener</tt> which loads the root application context of this web application at startup. <b>Please notice:</b> With proper usage of Spring Framework it is the intension that application services should be defined in this application context. View related beans should defined in a child application context which is loaded by the <tt>DispatcherServlet</tt>. The current configuration both types of beans in one go; application services (e.g. <tt>service-config.xml</tt>) and view related beans (e.g. <tt>webapp-config.xml</tt>) are loaded collectively by <tt>ContextLoaderListener</tt> which loads the <tt>webapp-config.xml</tt> which includes the <tt>service-config.xml</tt>. The <tt>DispatcherServlet</tt> is defined with a null parameter is thus loads a null context and inherits all the beans defined root application context. </li>
<li>A <tt>listener</tt> element of the class <tt>org.springframework.web.context.request.RequestContextListener</tt> which is <i>apparently</i> required to resolve the error: <tt>Error creating bean with name 'scopedTarget.sessionState': Scope 'session' is not active for the current thread; consider defining a scoped proxy for this bean if you intend to refer to it from a singleton; nested exception is java.lang.IllegalStateException: No thread-bound request found:</tt> For more information: 
<ul>
<li>http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/beans.html#beans-factory-scopes-other</li>
<li>http://forum.springsource.org/showthread.php?t=50631</li></ul></li>
<li>A <tt>listener</tt> element of the class <tt>org.zkoss.zk.ui.http.HttpSessionListener</tt> which initializes the <i>ZK Session Cleaner</i> whose purpose it is to clean up when a session is destroyed.</li>
<li>A <tt>servlet</tt> element of the class <tt>DispatcherServlet</tt> which configures the Spring web MVC servlet. The servlet is configured load its application context file from <tt>/WEB-INF/spring/webapp-config.xml</tt> </li>
<li>A <tt>servlet-mapping</tt> for the Spring web MVC servlet which handles all requests which matches the pattern <tt>/</tt>. </li>
<li>A <tt>servlet</tt> element of the class <tt>org.zkoss.zk.ui.http.DHtmlLayoutServlet</tt> which configures the ZK loader for ZUML pages.</li>
<li>A <tt>servlet</tt> element of the class <tt>org.zkoss.zk.au.http.DHtmlUpdateServlet</tt> which configures the asynchronous update engine for ZK.</li>
<li>Session time out is set to 60 minutes.</li>
<li>An <tt>welcome-file</tt> which is <tt>/workspace</tt>.</li>
<li>An error page for HTTP 404 and 500.</li></ul></div>
<div class="section">
<h5>weblogic.xml<a name="weblogic.xml"></a></h5>
<p>WebLogic specific deployment descriptor for web applications is located in <tt>src/main/webapp/WEB-INF/weblogic.xml</tt></p>
<p>The descriptor defines:</p>
<ul>
<li>JSP <tt>page-check-seconds</tt> is set to -1, i.e. disabled.</li>
<li><tt>servlet-reload-check-secs</tt> is set to -1, i.e. disabled.</li>
<li><tt>resource-reload-check-secs</tt> is set to -1, i.e. disabled.</li>
<li><tt>prefer-web-inf-classes</tt> is set to true. Setting this element to true subverts the class loader delegation model so that class definitions from the web application are loaded in preference to class definitions in higher-level class loaders. This allows the web application to use its own version of a third-party class, which might also be part of WebLogic Server. </li></ul></div>
<div class="section">
<h5>zk.xml<a name="zk.xml"></a></h5>
<p>ZK specific deployment descriptor for web applications is located in <tt>src/main/webapp/WEB-INF/zk.xml</tt></p>
<p>The descriptor defines:</p>
<ul>
<li><tt>max-upload-size</tt> is set to -1, i.e. disabled.</li>
<li><tt>server-push-class</tt> is set to <tt>org.zkoss.zkex.ui.comet.CometServerPush</tt>. The used server push implementation doesn't use servlet 3 asynchronous processing support. The implementation is choosen over the <tt>org.zkoss.zkmax.ui.comet.CometServerPush</tt> implementation which supports asynchronous processing but doesn't work with Jetty 9.1+ (Please visit: PINEAPPLE-705 &amp; PINEAPPLE-708).</li>
<li><tt>session-timeout</tt> is set to 0 seconds to use the time out value defined in <tt>web.xml</tt>.</li>
<li><tt>timeout-message</tt> is configured with a time out message.</li>
<li>A <tt>listener</tt> element defines a ZK life cycle event listener <tt>LifecycleEventListener</tt> which is used to capture an event when a ZK desktop is destroyed (i.e. when a browser is closed).</li></ul></div></div>
<div class="section">
<h4>Pineapple configuration<a name="Pineapple_configuration"></a></h4>
<p>Pineapple is initialized from the value of the <tt>pineappple.home.dir</tt> system property which defines the <b>Pineapple Home directory</b>. The directory defines the location where Pineapple will look for its configuration files, modules and write reports to.</p>
<p>Initialization of the home directory is done by <tt>PineappleHomeInitializer</tt> context listener as part of the initialization of the web application.</p>
<p>Two use cases for distribution of the web application are supported: </p>
<ul>
<li>Stand alone client. </li>
<li>Deployable web application.</li></ul>
<div class="section">
<h5>Stand alone client <a name="Stand_alone_client"></a></h5>
<p>When the web application is distributed as a stand alone client, then the starter scripts (e.g. <tt>runPineapple.cmd</tt> and <tt>runPineapple.sh</tt>) sets the Pineapple Home directory. In this case the initializer doesn't do any initialization.</p></div>
<div class="section">
<h5>Deployable web application <a name="Deployable_web_application"></a></h5>
<p>When the web application is distributed as a deployable web application, the no assumption regarding the state of the <tt>pineappple.home.dir</tt> system property should be made since it would require the user to set the system property prior to using the web application. In this case the value is read from the <tt>web.xml</tt> and used to the system property. </p></div></div>
<div class="section">
<h4>Logging<a name="Logging"></a></h4>
<p>The web application uses Log4j for logging. The Log4j configuration file is located in <tt>src/main/webapp/WEB-INF/log4j/log4j.properties</tt>.</p>
<p>The Log4j configuration file is read by the <tt>com.alpha.pineapple.web.logging.LoggingInitializer</tt> class which is configured in the <tt>web.xml</tt> deployment descriptor. </p>
<p>The file configures logging for ALL the pineapple components / jars which constitutes the web application. </p>
<p>The configuration file configures Log4j to write log files to:</p>
<ul>
<li><tt>${pineapple.home.dir}/logs/pineapple-web-application.log</tt> </li></ul></div>
<div class="section">
<h4>Spring web application context file<a name="Spring_web_application_context_file"></a></h4>
<p>The main application context file for the application is located at <tt>src/main/webapp/WEB-INF/spring/webapp-config.xml</tt>.</p>
<p>The application context file defines:</p>
<ul>
<li>Configuration of Spring web MVC through the import of the file <tt>mvc-config.xml</tt></li>
<li>Configuration of services through the import of the file <tt>service-config.xml</tt></li>
<li>Component scanning of the <tt>com.alpha.pineapple.web.spring.rest</tt> package for Spring Web MVC controller classes which implements the REST API. </li>
<li>Definition of <tt>messageProvder</tt> bean for I18N.</li>
<li>Definition of <tt>sessionState</tt> bean for definition of the session state for a single user of the web application.</li>
<li>Definition of <tt>debugInfoModel</tt> bean which defines the debug information model which provides debug information to the debug panel.</li>
<li>Definition of <tt>systemInfoModel</tt> bean which defines the system information model which provides system information to the system panel which is embedded into environment configuration tab.</li>
<li>Definition of <tt>treeNodeStateConverter</tt> bean which implements the <tt>org.zkoss.bind.Converter</tt> which is use to convert the state of an execution result into a string for rendering in a tree.</li>
<li>Definition of <tt>treeNodeStartTimeConverter</tt> bean which implements the <tt>org.zkoss.bind.Converter</tt> which is use to convert the start time of an execution result into a string for rendering in a tree.</li>
<li>Definition of <tt>treeNodeDescriptionStyleConverter</tt> bean which implements the <tt>org.zkoss.bind.Converter</tt> which is use to convert the description of an execution result into a string for rendering in a tree.</li>
<li>Definition of <tt>executionStateStyleConverter</tt> bean which implements the <tt>org.zkoss.bind.Converter</tt> which converts a string based <tt>ExecutionState</tt> into a color. </li>
<li>Definition of <tt>executionStateTextConverter</tt> bean which implements the <tt>org.zkoss.bind.Converter</tt> which converts a string based <tt>ExecutionState</tt> into a human readable text. </li>
<li>Definition of <tt>errorMessageBoxHelper</tt> bean which is a helper class for creation of error message boxes in ZK. </li>
<li>Definition of <tt>eventDispatcher</tt> bean which implements the ZK event dispatcher <tt>EventDispatcher</tt> interface which dispatches ZK events to registered ZK desktop's.</li>
<li>Definition of <tt>asyncTaskExecutor</tt> bean which defines a task executor used to handle the asynchronous execution of the asyncOperationTask bean. (DEPRECATED)</li>
<li>Definition of <tt>asyncTaskHelper</tt> bean which is general helper class for asynchronous execution tasks in the ZK framework. (DEPRECATED)</li>
<li>Definition of <tt>unpackModuleTask</tt> bean which is asynchronous task which uploads and unpacks a zipped module and updates the GUI continuously. (DEPRECATED)</li>
<li>Definition of <tt>restResultMapper</tt> bean which is implements mapping from the core component classes to the model classes which are returned by the REST web services.</li></ul></div>
<div class="section">
<h4>Spring web MVC application context file<a name="Spring_web_MVC_application_context_file"></a></h4>
<p>The application context file for Spring web MVC is located at <tt>src/main/webapp/WEB-INF/spring/mvc-config.xml</tt>.</p>
<p>The application context file defines: </p>
<ul>
<li>The <tt>mvc:annotation-driven</tt> element which configures the <tt>@Controller</tt> programming model in Spring web MVC.</li>
<li>A forwarding rule which forward requests to the workspace view:
<div class="source">
<pre>&lt;mvc:view-controller path=&quot;/index&quot; view-name=&quot;workspace&quot;/&gt;
&lt;mvc:view-controller path=&quot;/workspace&quot; view-name=&quot;workspace&quot;/&gt;
&lt;mvc:view-controller path=&quot;/mvc/workspace&quot; view-name=&quot;workspace&quot;/&gt;
&lt;mvc:view-controller path=&quot;/pineapple&quot; view-name=&quot;workspace&quot;/&gt;  
&lt;mvc:view-controller path=&quot;/error&quot; view-name=&quot;error&quot;/&gt;  
</pre></div></li>
<li>A view resolver <tt>InternalResourceViewResolver</tt> which resolves view names to <tt>.zul</tt> resources within the <tt>/WEB-INF/jsp</tt> directory </li>
<li>A resource mapping which maps requests for JavaScript at <tt>/js/**</tt> to the internal location <tt>/js/</tt> at the web root in the web application. </li>
<li>A resource mapping which maps requests for images at <tt>/images/**</tt> to the internal location <tt>/images/</tt> at the web root in the web application.</li>
<li>A multipart resolver to support multipart uploads in the REST API implemented using Spring web MVC.</li></ul></div>
<div class="section">
<h4>Spring services MVC application context file<a name="Spring_services_MVC_application_context_file"></a></h4>
<p>The application context file for services used by the MVC controllers is located at <tt>src/main/webapp/WEB-INF/spring/service-config.xml</tt>.</p>
<p>The application context file defines:</p>
<ul>
<li>Access to the Pineapple core component through the import of the file <tt>com.alpha.pineapple.core-config.xml</tt>.</li>
<li>Access to the Pineapple HTML report generator through the import of the file <tt>com.alpha.pineapple.report.basichtml-config.xml</tt>.</li>
<li>Definition of <tt>webAppCoreFactory</tt> factory bean for creation of core component instances.</li>
<li>Definition of <tt>coreComponent</tt> bean which defines the core component instance created by the <tt>webAppCoreFactory</tt> factory bean. </li>
<li>Definition of <tt>webAppResultListener</tt> bean for definition of a Pineapple result listener. Received events are forwarded to Reactor as events. The events are posted as result notifications. </li>
<li>Definition of <tt>reportRepository</tt> bean for definition of report repository. </li>
<li>Definition of <tt>reportSetMarshaller</tt> bean for definition of reports marshaller which can load and save reports in the report repository. </li>
<li>Definition of <tt>activityRepository</tt> bean for definition of activity repository. </li>
<li>Definition of <tt>configurationModelObjectFactory</tt> for creation for model objects returned by the REST API. The model objects are defined by the <i>Environment configuration schema</i> defined in the Pineapple API project.</li>
<li>Definition of <tt>webAppObjectFactory</tt> for creation for model objects defined by the web application.</li>
<li>Definition of <tt>webAppReactor</tt> bean which implements the Reactor.</li>
<li>Definition of <tt>webAppReactorEnvironment</tt> bean which implements the Reactor environment.</li>
<li>Definition of <tt>createReport</tt> bean for definition of create report Reactor consumer. </li>
<li>Definition of <tt>createdReportNotifier</tt> bean for definition of create report Reactor consumer. </li>
<li>Definition of <tt>openModuleActivityInvoker</tt> bean for definition of open module Reactor consumer. </li>
<li>Definition of <tt>executeOperationActivityInvoker</tt> bean for definition of execute operation Reactor consumer. </li>
<li>Definition of <tt>resultNotificationNotifier</tt> bean for definition of execution result notifier Reactor consumer. </li></ul></div>
<div class="section">
<h4>ZK GUI definition files (.zul)<a name="ZK_GUI_definition_files_.zul"></a></h4>
<p>The GUI widgets are defined by .zul files located in the <tt>src/main/webapp/WEB-INF/jsp</tt> directory.</p>
<p>For each .zul file either a view model (MVVM)class and/or a ZK controller class exists which implements the logic (e.g. event code) of the widgets. The ZK view model classes are located in the package <tt>com.alpha.pineapple.web.zk.viewmodel</tt>. The ZK controller classes are located in the package <tt>com.alpha.pineapple.web.zk.controller</tt>.</p></div>
<div class="section">
<h4>Servlet API configuration <a name="Servlet_API_configuration"></a></h4>
<p>The web application is configured with a Maven dependency to the Servlet API version 3.1.0 (see PINEAPPLE-715/6) with the <i>provided</i> scope:</p>
<div class="source">
<pre>    &lt;dependency&gt;
         &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
         &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
         &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;    
</pre></div>
<p>The version is managed from the main project <i>pom.xml</i>.</p></div>
<div class="section">
<h4>JSP Standard Tag Library (JSTL)<a name="JSP_Standard_Tag_Library_JSTL"></a></h4>
<p>The application doesn't use JSTL and contains no dependencies to JSTL (since resolution of PINEAPPLE-145). </p></div>
<div class="section">
<h4>Internationalization (I18N) configuration file <a name="Internationalization_I18N_configuration_file"></a></h4>
<p>The report generator uses internationalization. Messages used by classes in the project are located in the file <tt>src/main/resources/com.alpha.pineapple.web-messages.properties</tt>. </p></div>
<div class="section">
<h4>Integration of the ACE editor<a name="Integration_of_the_ACE_editor"></a></h4>
<p>The module panel implements integration of the ACE editor to support remote editing of model files.</p>
<div class="section">
<h5>Components used to implement the ACE integration <a name="Components_used_to_implement_the_ACE_integration"></a></h5>
<p>This diagram illustrates the components constitutes the integration between ZK and ACE:</p><img src="../images/ace-integration-save.jpg" alt="" />
<p>The participating files are:</p>
<ul>
<li><b>ZK View</b> - which defines the GUI widgets. The view is implemented in the .zul file named module-panel.zul.</li>
<li><b>ZK View Model</b> - which provides data for the ZK view using the ZK MVVM and implements event handlers. The view model is implemented as a Java POJO named ModulePanel.java.</li>
<li><b>JavaScript #1</b> - which implement functions for creation of the editor instance. The script is implemented in the file named module-panel.js.</li>
<li><b>JavaScript #2</b> - which implements the ACE editor. The editor is implemented in a collection of scripts which are added to the web application. The main script is named ace.js.</li>
<li><b>Application Service</b> - which serves as a backend for the view model. The service is implemented as a Java POJO named SessionState.java. </li></ul></div>
<div class="section">
<h5>Loading a document in ACE<a name="Loading_a_document_in_ACE"></a></h5>
<p>This diagram illustrates the call sequence when a new document is loaded:</p><img src="../images/ace-integration-sequence.jpg" alt="" /></div>
<div class="section">
<h5>Saving a document in ACE<a name="Saving_a_document_in_ACE"></a></h5>
<p>This diagram illustrates the call sequence when a document is saved at the server side:</p><img src="../images/ace-integration-sequence-save.jpg" alt="" /></div>
<div class="section">
<h5>Close a document in ACE<a name="Close_a_document_in_ACE"></a></h5>
<p>The sequence for closing a document (a module model) corresponds to the sequence for openning a document:</p>
<ol style="list-style-type: decimal">
<li>User selects &quot;Close Module&quot; (e.g. on the menu).</li>
<li>The menu bar emits the global command <tt>CloseModule</tt>.</li>
<li>The module panel MVVM receives the command and clears the selected module and model in the module panel and in the session state.</li>
<li>The module panel MVVM invokes the <tt>closeAceEditor</tt> JavaScript.</li>
<li>The <tt>closeAceEditor</tt> JavaScript &quot;closes&quot; the editor by creating a new empty document and hides it.</li>
<li>The workspace panel MVVM receives the command and clears the selected module and model in the workspace header. </li></ol></div></div>
<div class="section">
<h4>The REST API<a name="The_REST_API"></a></h4>
<div class="section">
<h5>Implementation using Spring Web MVC <a name="Implementation_using_Spring_Web_MVC"></a></h5>
<p>The REST API is configured and implemented using Spring Web MVC. </p>
<p>The API is implemented in the package <tt>com.alpha.pineapple.web.spring.rest</tt>. The classes are annotated as Spring <tt>@Controller</tt> classes and picked up by component scan of the package during application context initialization. Furthermore, configuration-wise a multipart resolver has been configured to support multipart file upload by the web services.</p>
<p>The REST web services are implemented using the Spring annotations for request mapping etc. The web services are implemented to return the result using the <tt>@ResponseBody</tt> annotation letting Spring handle the marshalling of the returned model objects by the services.</p></div>
<div class="section">
<h5>Data models used by the REST web services<a name="Data_models_used_by_the_REST_web_services"></a></h5>
<p>The web services are using these schemas:</p>
<ul>
<li>The <i>Environment configuration schema</i> is used to to return configuration information. </li>
<li>The <i>Execution result schema</i> is used to to return execution results. </li></ul>
<p>To more information about the schemas:</p>
<ul>
<li><a href="../../../../pineapple-modules/pineapple-api/index.html">Pineapple API project</a>.</li>
<li><a href="../../../../usage/schemas.html">Schema locations for configuration files</a>. </li></ul></div>
<div class="section">
<h5>Usage of the REST web services in the web application<a name="Usage_of_the_REST_web_services_in_the_web_application"></a></h5>
<p>The REST web services are used internally by the ZK view model and controller classes to access the core component. </p></div></div></div>
<div class="section">
<h3>Implementation<a name="Implementation"></a></h3>
<div class="section">
<h4>Reactor usage <a name="Reactor_usage"></a></h4>
<div class="section">
<h5>Reactor configuration<a name="Reactor_configuration"></a></h5>
<p>Currently the default environment is used.</p>
<p>The default environment is configured to use a <tt>ThreadPoolExecutorDispatcher</tt> which uses a <tt>ThreadPoolExecutor</tt> with an unbounded queue to dispatch events. Reactor in its default configuration implements asynchronous event processing. </p></div>
<div class="section">
<h5>Registration of Reactor consumers<a name="Registration_of_Reactor_consumers"></a></h5>
<p>Registration of Reactor consumers is implemented by the <tt>WebAppCoreFactory</tt>:</p>
<div class="source">
<pre>public PineappleCore createCore() throws CoreException {
        
  webAppReactor.getConsumerRegistry().clear();
  webAppReactor.on($(REACTOR_TOPIC_SERVICE_NOTIFICATION), createReport);
  webAppReactor.on($(REACTOR_TOPIC_SERVICE_NOTIFICATION), resultNotificationNotifier);  
  webAppReactor.on($(REACTOR_TOPIC_SERVICE_CREATED_REPORT), createdReportNotification);
  webAppReactor.on(T(OpenModuleActivity.class), openModuleActivityInvoker);
  webAppReactor.on(T(ExecuteOperationActivity.class), executeOperationActivityInvoker);

  // create core
  ResultListener[] listeners = { webAppResultListener };                
  PineappleCore coreComponent = coreFactory.createCore(listeners);                 
                        
  return coreComponent;
}
</pre></div></div>
<div class="section">
<h5>Reactor topics and events<a name="Reactor_topics_and_events"></a></h5>
<p>These topics are used:</p>
<ul>
<li><i>/webapp/service/execution-result-notification</i></li>
<li><i>/webapp/service/created-report</i></li>
<li><tt>OpenModuleActivity.class</tt></li>
<li><tt>ExecuteOperationActivity.class</tt></li></ul>
<p>The topic <i>/webapp/service/execution-result-notification</i> is used to stream converted Pineapple events as Reactor events. The events posted on this topic are wrapped <tt>ExecutionResultNotification</tt> instances. The events are produced by the result listener <tt>WebAppResultListenerImpl</tt>.</p>
<p>The topic <i>/webapp/service/created-report</i> is used to signal that a report has been generated. The events posted on this topic are wrapped <tt>String</tt> instances. The events are produced by the Reactor consumer / report generator <tt>CreateReportImpl</tt>.</p>
<p>The topic <tt>OpenModuleActivity.class</tt> is used to signal that a open module activity should be performed again. The events posted on this topic are wrapped <tt>OpenModuleActivity</tt> instances. The events are produced by the ZK view model <tt>HomePanel</tt> for the home tab.</p>
<p>The topic <tt>ExecuteOperationActivty.class</tt> is used to signal that a execute operation activity should be performed again. The events posted on this topic are wrapped <tt>ExecuteOperationActivity</tt> instances. The events are produced by the ZK view model <tt>HomePanel</tt> for the home tab.</p></div>
<div class="section">
<h5>Reactor consumers<a name="Reactor_consumers"></a></h5>
<p>These consumers are registered:</p>
<ul>
<li>Reactor-to-ZK event transformer which notifies the GUI that an execution result has been produced by Pineapple core component. If the result is part of any user initiated execution then the execution panel view model should be updated. The transformer is implemented by the class <tt>ResultNotificationNotifierImpl</tt>. The consumer subscribes to events from the <i>/webapp/service/execution-result-notification</i> topic. </li>
<li>Report generator. The generator is implemented by the class <tt>CreateReportImpl</tt> The consumer subscribes to events from the <i>/webapp/service/execution-result-notification</i> topic. </li>
<li>Reactor-to-ZK event transformer which notifies the GUI that a report is generated and the report view should be updated. The transformer is implemented by the class <tt>CreatedReportNotifierImpl</tt>. The consumer subscribes to events from the <i>/webapp/service/created-report</i> topic. </li>
<li>Reactor-to-ZK event transformer which notifies the GUI that an open module activity should be performed again by loading the module and updating the GUI. The transformer is implemented by the class <tt>OpenModuleActivityInvokerImpl</tt>. The consumer subscribes to events from the <tt>OpenModuleActivity.class</tt> topic. </li>
<li>Reactor-to-ZK event transformer which notifies the GUI that an execute operation activity should be performed again by executing an operation on the module and updating the GUI. The transformer is implemented by the class <tt>ExecuteOperationActivityInvokerImpl</tt>. The consumer subscribes to events from the <tt>ExecuteOperationActivity.class</tt> topic. </li></ul></div></div>
<div class="section">
<h4>Dispatching Reactor events as ZK events<a name="Dispatching_Reactor_events_as_ZK_events"></a></h4>
<p>Dispatch of Reactor events as ZK events is implemented to support notification of the GUI of events in the non GUI layer of the web application which should be reflected in the GUI.</p>
<p>A <b>ZK event dispatcher</b> is used by a Reactor consumer who wants to post to a ZK event. A Reactor consumer is by nature non-graphical and has no reference to the GUI. The ZK event dispatcher is a class* which perform a double registration when a ZK desktop is created. The event dispatcher registers itself with the desktop to allow for unregistration when the desktop is destroyed. Furthermore the dispatcher registers the ZK desktop to keep record of all known desktop&#x2019;s (i.e. live GUI&#x2019;s). The purpose is to have a defined end point where ZK events can be posted to. </p>
<p>The event dispatcher will dispatch events to all registered desktops. A registered desktop is unregistered when the desktop is destroyed.</p>
<p>The interface <tt>EventDispatcher</tt> is used to implement an event dispatcher The default implementation of the interface is <tt>EventDispatcherImpl</tt>.</p>
<div class="section">
<h5>Implementing Reactor consumer who dispatch ZK events<a name="Implementing_Reactor_consumer_who_dispatch_ZK_events"></a></h5>
<p>To enable a Reactor consumer to dispatch a ZK events it must implement two interfaces:</p>
<ul>
<li>The ZK interface <tt>EventListener</tt></li>
<li>The Reactor interface <tt>Consumer</tt></li></ul>
<p>The Reactor interface receives a Reactor event in the accept method.</p>
<p>The received Reactor event is transformed into a ZK event which is dispatched to this class as ZK a event listener. The purpose is to shift from the Reactor thread into ZK controlled threads. The received ZK event is posted as global command with the either the ZK <i>application</i> or <i>session</i> scope. The purpose is to notify the target view model (e.g. the reort panel or the execution panel) that something relevant happened and the view should be updated.</p></div></div>
<div class="section">
<h4>Order of initialization of the context listeners <a name="Order_of_initialization_of_the_context_listeners"></a></h4>
<p>The order of initialization is:</p>
<ol style="list-style-type: decimal">
<li><tt>PineappleHomeInitializer</tt></li>
<li><tt>Log4jInitializer</tt> </li>
<li><tt>ContextLoaderListener</tt> </li></ol>
<p>The <tt>PineappleHomeInitializer</tt> is initialized first since it sets the <tt>pineappple.home.dir</tt> system property which is used by log configuration initialized by <tt>Log4jInitializer</tt> and the Pineapple core component defined in the Spring application context initialized by <tt>ContextLoaderListener</tt>. </p></div>
<div class="section">
<h4>Core Factory Classes<a name="Core_Factory_Classes"></a></h4>
<p>The package <tt>com.alpha.pineapple.web</tt> contains a factory for creation of the core component: </p>
<ul>
<li><tt>WebAppCoreFactory</tt> which registers Reactor consumers, and creates a core component instance with the a Pineapple-to-Reactor event listener <tt>WebAppResultListenerImpl</tt> configured.</li></ul></div>
<div class="section">
<h4>Context Listeners<a name="Context_Listeners"></a></h4>
<p>The package <tt>com.alpha.pineapple.web.context</tt> contains servlet context listeners which is used to initialize the web application:</p>
<ul>
<li><tt>LoggingInitializer</tt> which initializes Log4j when the application is started.</li>
<li><tt>PineappleHomeInitializer</tt> which initializes the Pineapple Home directory.</li></ul>
<div class="section">
<h5>PineappleHomeInitializer<a name="PineappleHomeInitializer"></a></h5>
<p>The purpose of the initializer is to support the two use cases for distribution of the web application mentioned above. </p>
<p>The directory is initialized using the algorithm:</p>
<ol style="list-style-type: decimal">
<li>If the system property <tt>pineappple.home.dir</tt> is already defined then exit.</li>
<li>Read the parameter <tt>pineappple.home.dir</tt> from the <tt>web.xml</tt>.</li>
<li>if the read value is null, then use the default value <tt>${user.home}/.pineapple</tt>. </li>
<li>Substitute any variables defined with <tt>${xxxxx}</tt> with system properties in the value from step 3). </li>
<li>Set the system property <tt>pineappple.home.dir</tt> with the value from step 4) </li></ol></div></div>
<div class="section">
<h4>Model classes<a name="Model_classes"></a></h4>
<p>The package <tt>com.alpha.pineapple.web.model</tt> contains:</p>
<ul>
<li><tt>RestResultMapper</tt> defines interface for model mapper which can map object used by core component to model objects returned by the REST API.</li>
<li><tt>RestResultMapperImpl</tt> implementation of the <tt>RestResultMapper</tt> interface. </li>
<li><tt>DebugInfoModel</tt> Creates model of a available debug information. Is used to provide content to the <tt>DebugPanel</tt>. </li>
<li><tt>SystemInfoModel</tt> Creates model of a available system information. Is used to provide content to the <tt>systemInfoPanel</tt>. </li>
<li><tt>ReportRepository</tt> defines interface for a report repository</li>
<li><tt>ReportRepositoryImpl</tt> Implementation of the <tt>ReportRepository</tt> interface. The repository contains information about reports stored on disk. The location of the reports is resolved form the <tt>RuntimeDirectoryProvider</tt>. </li>
<li><tt>SessionState</tt> defines interface for the web application session state for a single user.</li>
<li><tt>SessionStateImpl</tt> is an implementation of the <tt>SessionState</tt> interface.</li>
<li><tt>UnpackedEntry</tt> is a data object which is used to describe a unpacked ZIP file entry during the execution of the asynchronous task <tt>unpackModuleTask</tt>.</li>
<li><tt>Model</tt> defines interface for a simple data object which is used to render a model in the module panel. The model object is introduced to avoid the issue PINEAPPLE-269: Loading a new module results in a class cast exception from the execution panel. </li>
<li><tt>ModelImpl</tt> is an implementation of the <tt>Model</tt> interface.</li>
<li><tt>ExecutionResultProperty</tt> class for rendering detail about a selected execution result in the execution panel.</li></ul></div>
<div class="section">
<h4>Accounts classes<a name="Accounts_classes"></a></h4>
<p>The package <tt>com.alpha.pineapple.web.account</tt> contains interfaces and classes for user account management:</p>
<ul>
<li><tt>Account</tt> defines interface for user accounts.</li>
<li><tt>AccountImpl</tt> implements <tt>Account</tt> interface. </li></ul></div>
<div class="section">
<h4>Reactor event support<a name="Reactor_event_support"></a></h4>
<p>The package <tt>com.alpha.pineapple.web.event</tt> contains interfaces and classes to support usage of Spring Reactor and mapping to ZK events:</p>
<ul>
<li><tt>EventDispatcher</tt> defines the interface event dispatcher which supports dispatch of ZK events from Reactor consumers (i.e. non-GUI code).</li>
<li><tt>EventDispatcherImpl</tt> implements the <tt>EventDispatcher</tt> interface.</li>
<li><tt>WebAppResultListenerImpl</tt> implements the Pineapple <tt>EventListener</tt> interface which forwards Pineapple events of the type <tt>ExecutionResultNotification</tt> as Reactor events.</li></ul>
<div class="section">
<h5>EventDispatcherImpl<a name="EventDispatcherImpl"></a></h5>
<p>The event dispatcher serves to maintain a set of live ZK desktop's which can be used by the the non GUI parts of the web application (e.g. Reactor consumers) as defined endpoints for posting notifications to the GUI.</p>
<p>The event dispatcher is used by ZK desktop's to register themselves (using the <tt>register(Desktop d)</tt> method) upon creation as a live GUI which allows the dispatcher to forward ZK events to it. The <tt>unregister(Desktop d)</tt> method is used upon destruction by the desktop to unregister itself and thus no longer serve as an end point for posting ZK events. </p>
<p>Finally the <tt>dispatchZkEvent(Event zkEvent, EventListener&lt;Event&gt; eventListener)</tt> method is used by Reactor consumers and other non GUI parts of the application to post ZK events to the GUI.</p></div>
<div class="section">
<h5>WebAppResultListenerImpl<a name="WebAppResultListenerImpl"></a></h5>
<p>The class implements the Pineapple <tt>EventListener</tt> interface. The class is registered as a result listener with the Pineapple core component. The class is registered by the <tt>WebAppCoreFactory</tt> as part of the core component initialization. The class wraps received <tt>ExecutionResultNotification</tt> events as Reactor events, an event is posted as <tt>ExecutionResultNotification</tt> in Reactor. The Reactor events are sent to the web application Reactor instance. </p></div></div>
<div class="section">
<h4>Reactor consumers <a name="Reactor_consumers"></a></h4>
<p>The package <tt>com.alpha.pineapple.web.event.consumer</tt> contains classes which implements the Reactor <tt>Consumer</tt> interface:</p>
<ul>
<li><tt>ResultNotificationNotifierImpl</tt> implements a Reactor-to-ZK event transformer which notifies the GUI that an execution result has been produced by Pineapple core component. If the result is part of any user initiated execution then the execution panel view model should be updated.</li>
<li><tt>CreateReportImpl</tt> implements a report generator. </li>
<li><tt>CreatedReportNotifierImpl</tt> implements a Reactor-to-ZK event transformer which notifies the GUI that a report is generated and the report view should be updated. </li>
<li><tt>OpenModuleActivityInvokerImpl</tt> implements a Reactor-to-ZK event transformer which notifies the GUI that an open module activity should should performed again and that the GUI should be updated.</li>
<li><tt>ExecuteOperationActivityInvokerImpl</tt> implements a Reactor-to-ZK event transformer which notifies the GUI that an execute operation activity should should performed again and that the GUI should be updated.</li></ul>
<div class="section">
<h5>ResultNotificationNotifierImpl<a name="ResultNotificationNotifierImpl"></a></h5>
<p>The purpose of this class is to notify the GUI that an execution result has been produced by Pineapple core component. If the result is part of any user initiated execution then the execution panel view model should be updated.</p>
<p>The class Implements the ZK <tt>EventListener</tt> and the Reactor <tt>Consumer</tt> interfaces. The consumer subscribes to events from the <i>/webapp/service/execution-result-notification</i> topic. When a Reactor event is received then the <tt>EventDispatcher</tt> is invoked with the class as ZK a event listener.</p>
<p>The event dispatcher schedules the event listener as an asynchronous event if any ZK desktop exists. The purpose is to shift from the Reactor thread into ZK controlled threads.</p>
<p>When the event listener method is invoked with a ZK event then a global command is posted with the <i>session</i> scope to notify the execution panel view model that execution result is produced and that the view should be updated if the result is part of any user initiated execution. </p></div>
<div class="section">
<h5>CreateReportImpl<a name="CreateReportImpl"></a></h5>
<p>The consumer subscribes to events from the <i>/webapp/service/execution-result-notification</i> topic. </p>
<p>If a received <tt>ExecutionResultNotification</tt> signals the conclusion of an operation then a report is generated using the HTML report generator which is feed the received <tt>ExecutionResultNotification</tt> as input. </p>
<p>When the report is generated then a <i>created-report</i> event is posted on the <i>/webapp/service/created-report</i> topic.</p></div>
<div class="section">
<h5>CreatedReportNotifierImpl<a name="CreatedReportNotifierImpl"></a></h5>
<p>The purpose of this class is to notify the GUI that a new report has been generated and that all active GUI&#x2019;s (for all users) should be updated to reflect the change.</p>
<p>The class Implements the ZK <tt>EventListener</tt> and the Reactor <tt>Consumer</tt> interfaces. The consumer subscribes to events from the <i>/webapp/service/created-report</i> topic. When a Reactor event is received then the <tt>EventDispatcher</tt> is invoked with the class as ZK a event listener.</p>
<p>The event dispatcher schedules the event listener as an asynchronous event if any ZK desktop exists. The purpose is to shift from the Reactor thread into ZK controlled threads.</p>
<p>When the event listener method is invoked with a ZK event then a global command is posted with the <i>application</i> scope to notify the report panel view model that report creation is completed and that the view should be updated. </p></div>
<div class="section">
<h5>OpenModuleActivityInvokerImpl<a name="OpenModuleActivityInvokerImpl"></a></h5>
<p>The purpose of this class is to notify the GUI that an user activity should be performed again and that the GUI for the current user should be updated to reflect the change.</p>
<p>The class Implements the ZK <tt>EventListener</tt> and the Reactor <tt>Consumer</tt> interfaces. The consumer subscribes to events from the <tt>OpenModuleActivity.class</tt> topic. When a Reactor event is received then the <tt>EventDispatcher</tt> is invoked with the class as ZK a event listener.</p>
<p>The event dispatcher schedules the event listener as an asynchronous event if any ZK desktop exists. The purpose is to shift from the Reactor thread into ZK controlled threads.</p>
<p>When the event listener method is invoked with a ZK event then a global command is posted with the <i>session</i> scope to notify the module panel view model that it should load the selected module and that the view should be updated. </p></div>
<div class="section">
<h5>ExecuteOperationActivityInvokerImpl<a name="ExecuteOperationActivityInvokerImpl"></a></h5>
<p>The purpose of this class is to notify the GUI that an user activity should be performed again and that the GUI for the current user should be updated to reflect the change.</p>
<p>The class Implements the ZK <tt>EventListener</tt> and the Reactor <tt>Consumer</tt> interfaces. The consumer subscribes to events from the <tt>ExecuteOperationActivity.class</tt> topic. When a Reactor event is received then the <tt>EventDispatcher</tt> is invoked with the class as ZK a event listener.</p>
<p>The event dispatcher schedules the event listener as an asynchronous event if any ZK desktop exists. The purpose is to shift from the Reactor thread into ZK controlled threads.</p>
<p>When the event listener method is invoked with a ZK event then a global command is posted with the <i>session</i> scope to notify the execute panel view model that it should execute the targeted module and environment with an operation and that the view should be updated. </p></div></div>
<div class="section">
<h4>ZK View Models<a name="ZK_View_Models"></a></h4>
<p>The package <tt>com.alpha.pineapple.web.zk.viewmodel</tt> contains ZK view model classes which backs views implemented in .zul files:</p>
<ul>
<li><tt>DebugPanel</tt> - provides data for the Debug view.</li>
<li><tt>FooterPanel</tt> - provides data for the Footer view.</li>
<li><tt>ExecutionPanel</tt> - provides data for the Execution view.</li>
<li><tt>ScheduledOperationPanel</tt> - provides data for the Scheduled operation view.</li>
<li><tt>ActivityPanelPopup</tt> - provides data for the Activity popup view.</li>
<li><tt>ModulePanel</tt> - provides data for the Module view.</li>
<li><tt>OpenModuleModalPanel</tt> - provides data for the Open module modal view.</li>
<li><tt>DeleteModuleModalPanel</tt> - provides data for the Delete module modal view.</li>
<li><tt>ReportPanel</tt> - provides data for the Report view.</li>
<li><tt>UploadModuleModalPanel</tt> - provides data for the Upload module modal view.</li>
<li><tt>WorkspacePanel</tt> - provides data for the main Workspace view.</li>
<li><tt>EnvironmentConfigurationPanel</tt> - provides data for the main Configuration view. </li>
<li><tt>ResetCredentialPasswordModelPanel</tt> - provides data for the reset credential password modal view. </li>
<li><tt>CreateResourcePropertyModalPanel</tt> - provides data for the create resource property modal view. </li>
<li><tt>CreateModelModalPanel</tt> - provides data for the create model modal view. </li></ul>
<div class="section">
<h5>ReportPanel<a name="ReportPanel"></a></h5>
<p>The .zul file for the report panel, i.e. <i>report-panel.zul</i> is configured with a ZK Binder with <i>application</i> scope:</p>
<div class="source">
<pre>&lt;window apply=&quot;org.zkoss.bind.BindComposer&quot; 
        binder=&quot;@init(queueName='pineapple-queue',queueScope='application')&quot;
        viewModel=&quot;@id('vm') @init('com.alpha.pineapple.web.zk.viewmodel.ReportPanel')&quot; 
        hflex=&quot;1&quot; vflex=&quot;1&quot; border=&quot;none&quot; &gt;
</pre></div>
<p>The application scope is use to update all desktops when a report is created and the &quot;completedReportCreation&quot; global command is posted.</p></div>
<div class="section">
<h5>ActivityPanelPopup<a name="ActivityPanelPopup"></a></h5>
<p>The .zul file for the activity panel, i.e. <i>activities-panel-popup</i> is configured with a ZK Binder with <i>application</i> scope:</p>
<div class="source">
<pre>&lt;window apply=&quot;org.zkoss.bind.BindComposer&quot; 
        binder=&quot;@init(queueName='pineapple-queue',queueScope='application')&quot;
        viewModel=&quot;@id('vm') @init('com.alpha.pineapple.web.zk.viewmodel.ActivityPanelPopup')&quot; 
        hflex=&quot;1&quot; vflex=&quot;1&quot; border=&quot;none&quot; &gt;
</pre></div>
<p>The application scope is use to update all desktops when an activity is created and the &quot;completedActivityCreation&quot; global command is posted.</p></div></div>
<div class="section">
<h4>ZK View Controllers<a name="ZK_View_Controllers"></a></h4>
<p>The package <tt>com.alpha.pineapple.web.zk.controller</tt> contains ZK composer classes for views which requires additional functionality that can be provided by a view model. If a view requires data then a view model is implemented. As result the composer shouldn't store any data in them:</p>
<ul>
<li><tt>ExecutionPanel</tt> - implements controller functionality for the Execution view.</li>
<li><tt>Menu</tt> - implements controller functionality for the Menu bar..</li>
<li><tt>ModulePanel</tt> - implements controller functionality for the Model view.</li>
<li><tt>UploadModuleModalPanel</tt> - implements controller functionality for the Upload module modal view. The controller handles the upload of a zipped module into the module repository. The actual upload is implemented by ZK. The unpacking of the uploaded zipped module is handled by the asynchronous task <tt>UnpackModuleTask</tt> which unpacks the module archive into the module repository while updating the ZK view by sending <tt>UnpackedEntryEvent</tt> and <tt>UnpackModuleTaskEvent</tt> events. </li>
<li><tt>WorkspacePanel</tt> - implements controller functionality for the main Workspace view.</li></ul>
<div class="section">
<h5>WorkspacePanel<a name="WorkspacePanel"></a></h5>
<p>Implements controller functionality for the main Workspace view.</p>
<p>When the controller is created the <tt>doAfterCompose(..)</tt> method is overwritten and the ZK event dispatcher is invoked to register the desktop. </p></div></div>
<div class="section">
<h4>Asynchronous Tasks<a name="Asynchronous_Tasks"></a></h4>
<p>The package <tt>com.alpha.pineapple.web.zk.asynctask</tt> contains asynchronous tasks which supports execution of long running processes while updating the ZK GUI by scheduling ZK events.</p>
<ul>
<li><tt>AsyncTask</tt> - interface for asynchronous tasks. DEPRECATED.</li>
<li><tt>AsyncTaskHelper</tt> - Helper class for execution of asynchronous tasks and scheduling of ZK GUI events. DEPRECATED.</li>
<li><tt>UnpackModuleTask</tt> - Implementation of the <tt>AsyncTask</tt> interface which implement upload of a zipped and module unpacking it into the module repository.</li></ul></div>
<div class="section">
<h4>ZK Events<a name="ZK_Events"></a></h4>
<p>The package <tt>com.alpha.pineapple.web.zk.asynctask.event</tt> contains ZK event classes which is used by asynchronous tasks to communicate updates to the ZK controllers.</p>
<ul>
<li><tt>UnpackedEntryEvent</tt> - ZK event used by the <tt>UnpackModuleTask</tt> task to communicate that it have unpacked an entry (file or directory). </li>
<li><tt>UnpackModuleTaskEvent</tt> - ZK event used by the <tt>UnpackModuleTask</tt> task to communicate its progress in unpacking a file.</li>
<li><tt>ResultNotificationEvent</tt> - ZK event used by the <tt>ResultNotificationNotifierImpl</tt> consumer to dispatch a result notification event to an event handler.</li>
<li><tt>GenericEvent</tt> - ZK event used by the <tt>EventDispatcherImpl</tt> task to dispatch a generic event with no arguments to an event handler.</li></ul></div>
<div class="section">
<h4>Asynchronous task visitors<a name="Asynchronous_task_visitors"></a></h4>
<p>The package <tt>com.alpha.pineapple.web.zk.asynctask.event.visitor</tt> contains interfaces for visitors which can receive events from asynchronous tasks: </p>
<ul>
<li><tt>UnpackModuleTaskEventVisitor</tt> - interface for visitor which can receive task for the <tt>UnpackModuleTask</tt> task.</li></ul></div>
<div class="section">
<h4>ZK lifecycle event listeners<a name="ZK_lifecycle_event_listeners"></a></h4>
<p>The package <tt>com.alpha.pineapple.web.zk.lifecycle</tt> contains classes which implements the ZK lifecycle event listener interfaces:</p>
<ul>
<li><tt>LifecycleEventListener</tt> - implements the ZK <tt>DesktopCleanup</tt> interface whose method is invoked when a ZK desktop is destroyed.</li></ul>
<div class="section">
<h5>LifecycleEventListener<a name="LifecycleEventListener"></a></h5>
<p>The class is registered as ZK event listener in <tt>zk.xml</tt>. The class implements a single method <tt>cleanup(Desktop desktop)</tt> which is invoked when a ZK desktop is destroyed. The listener performs the actions:</p>
<ul>
<li>Invalidates the ZK session.</li>
<li>Unregisters the ZK desktop from the event dispatcher.</li>
<li>Removes the event dispatcher as an attribute from the desktop. </li></ul></div></div>
<div class="section">
<h4>ZK converters<a name="ZK_converters"></a></h4>
<p>The package <tt>com.alpha.pineapple.web.zk.converter</tt> contains ZK converters which can convert data object into formats which can be rendered by views.</p></div>
<div class="section">
<h4>REST web service controllers<a name="REST_web_service_controllers"></a></h4>
<p>The package <tt>com.alpha.pineapple.web.spring.rest</tt> implements the REST web services:</p>
<ul>
<li><tt>ConfigurationController</tt> - implements web services for configuration of Pineapple, e.g. CRUD on environment configuration entities.</li>
<li><tt>ExecuteController</tt> - implements web services for execution of operations in Pineapple.</li>
<li><tt>ModuleController</tt> - implements web services for management of modules in Pineapple.</li>
<li><tt>SystemController</tt> - implements web services for system information about Pineapple.</li></ul></div>
<div class="section">
<h4>Utilities<a name="Utilities"></a></h4>
<p>The package <tt>com.alpha.pineapple.web.zk.utils</tt> contains utility classes:</p>
<ul>
<li><tt>DetachConverter</tt> is an implementation of the <b>Converter</b> interface to detach a modal window.</li>
<li><tt>ErrorMessageBoxHelper</tt> is a helper class for showing a modal error message with details about an exception. </li></ul></div></div>
<div class="section">
<h3>Using the Jetty-maven-plugin for development and testing <a name="Using_the_Jetty-maven-plugin_for_development_and_testing"></a></h3>
<p>The project is set up to use the Jetty-Maven-plugin for rapid development and testing. To run the application in Jetty invoke, the Maven command: </p>
<div class="source">
<pre>mvn jetty:run   
</pre></div>
<p>The plugin will start the Jetty server with the application deployed with these parameters:</p>
<ul>
<li>host = localhost</li>
<li>port = 8080</li></ul>
<p>The application URL is: <b><a class="externalLink" href="http://localhost:8080">http://localhost:8080</a></b></p>
<p>For more info about the Jetty Maven Plugin, visit: http://wiki.eclipse.org/Jetty/Feature/Jetty_Maven_Plugin</p>
<div class="section">
<h4>Pineapple Home directory configuration<a name="Pineapple_Home_directory_configuration"></a></h4>
<p>The Pineapple Home directory will be set to the value of the <tt>pineapple.home.dir</tt> parameter in the <tt>web.xml</tt> whose default value is <tt>${user.home}/.pineapple</tt>.</p></div>
<div class="section">
<h4>Logging configuration for Jetty<a name="Logging_configuration_for_Jetty"></a></h4>
<p>The plugin is configured to use Log4j for logging. The Log4j configuration file is located in <tt>src/test/resources/log4j.properties</tt>.</p>
<p>The Log4j configuration file is read by the Commons Logging bridge in Jetty which is configured by the plugin to use Log4j as logging implementation. </p>
<p>The file configures logging for ALL the pineapple components / jars which constitutes the web application, including log output from Jetty.</p>
<p>The configuration file configures Log4j to write log files to:</p>
<ul>
<li><tt>${pineapple.home.dir}/logs/pineapple-web-application-jettymavenplugin.log</tt></li></ul>
<p>The plugin is configured to set the System properties:</p>
<div class="source">
<pre>slf4j = false
log4j.configuration= file:./target/classes/log4j.properties
</pre></div>
<p>..which disables logging to slf4j and configures where the plugin will look for a Log4j configuration. Furthermore, the plugin requires the dependencies to commons-logging, slf4j-jcl and log4j for the Log4j based logging to work. </p></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2017.
          All Rights Reserved.      
                    
      </div>

                          
        
                </div>
    </footer>
  </body>
</html>
